import{q as v,r as l,j as t,$ as Q,m as x}from"./app--8tztu9u.js";import{A as _}from"./action-modal-BWf1VBOb.js";import{P as B}from"./pagination-BEkVmKuy.js";import{T as G}from"./table-B_Lvd2Bk.js";import{A as J}from"./app-layout-cdbmaNQy.js";import{t as g,T as V}from"./index-CAEQJ3gJ.js";import X from"./form-DAk5dKlk.js";/* empty css            */import"./proxy-BUtDjAM8.js";import"./app-logo-icon-D82enWnp.js";import"./button-CANVr8nS.js";import"./index-CHt9rkk6.js";import"./index-Cl3x8yBZ.js";import"./index-COSppDxn.js";import"./form-modal-BrNj-cLe.js";import"./searchable-select-ZjCYQHUf.js";const z=[{title:"Students",href:"/students"}];function pe(){const{students:u,classrooms:D,sexes:O,statuses:E,religions:$,filters:i}=v().props,{flash:r}=v().props;l.useEffect(()=>{r!=null&&r.success&&g.success(r.success),r!=null&&r.error&&g.error(r.error)},[r]);const[A,y]=l.useState(!1),[F,P]=l.useState(null),[c,j]=l.useState([]),[d,m]=l.useState(null),[R,h]=l.useState(!1),[b,k]=l.useState(null),[T,w]=l.useState(""),[L,S]=l.useState(""),N=(e=null)=>{P(e),y(!0)},U=async e=>{x.delete(`/students/${e}`,{onSuccess:()=>{x.reload()}})},q=e=>{j(s=>s.includes(e)?s.filter(o=>o!==e):[...s,e])},I=()=>{const e=u.data.filter(a=>c.includes(a.id)),s=`Full name,Classroom,Entry year,Gender,Religion,Status
`,o=e.map(a=>{var C;return`${a.full_name},${(C=a.classroom)==null?void 0:C.name},${a.entry_year},${a.gender},${a.religion},${a.status}`}).join(`
`),p=new Blob([s,o],{type:"text/csv"}),n=URL.createObjectURL(p),f=document.createElement("a");f.href=n,f.download="students.csv",f.click()},M=e=>{x.get(route("students.index"),{sort:e,direction:i.direction==="asc"?"desc":"asc"},{preserveState:!0})},H=async()=>{var e;if(c.length!==0)try{const s=await fetch("/bulk-kartu-siswa",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.content)||""},body:JSON.stringify({student_ids:c})});if(!s.ok)throw new Error("Failed to download PDF");const o=await s.blob(),p=window.URL.createObjectURL(o),n=document.createElement("a");n.href=p,n.download="kumpulan-kartu-siswa.pdf",n.click()}catch{g.error("Gagal download kartu siswa.")}},K=[{key:"full_name",label:"Name",sortable:!0},{key:"parent.full_name",label:"Parent Name",sortable:!1},{key:"classroom.name",label:"Classroom",sortable:!1},{key:"code",label:"Code",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"entry_year",label:"Entry year",sortable:!0},{key:"gender",label:"Gender",sortable:!0},{key:"religion",label:"Religion",sortable:!0},{key:"date_of_birth",label:"Day of birth",sortable:!0},{key:"address",label:"Address",sortable:!1},{key:"actions",label:"Actions",sortable:!1}];return t.jsxs(J,{breadcrumbs:z,children:[t.jsx(Q,{title:"Students"}),t.jsx(V,{position:"top-right",richColors:!0}),t.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",placeholder:"Search students...",defaultValue:i.search||"",onChange:e=>x.get(route("students.index"),{search:e.target.value},{preserveState:!0}),className:"w-64 rounded border px-3 py-1"}),t.jsx("button",{onClick:I,className:"rounded bg-indigo-600 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Export Selected"}),t.jsx("button",{disabled:c.length===0,onClick:H,className:"rounded bg-indigo-700 px-3 py-1 text-sm font-medium text-white disabled:opacity-50 disabled:cursor-not-allowed",children:"Bulk Print Kartu Siswa"})]}),t.jsx("button",{onClick:()=>N(null),className:"rounded bg-green-600 px-3 py-1 text-sm font-medium text-white transition hover:cursor-pointer hover:bg-green-700",children:"Add Student"})]}),t.jsx(G,{headers:K,data:u.data,sortColumn:i.sort??"",sortDirection:i.direction==="asc"||i.direction==="desc"?i.direction:"asc",onSort:M,onSelectAll:e=>j(e?u.data.map(s=>s.id):[]),selectedIds:c,rowRender:e=>{var s,o;return t.jsxs("tr",{className:"border-b",children:[t.jsx("td",{className:"w-[10px] p-3 text-sm",children:t.jsx("input",{type:"checkbox",checked:c.includes(e.id),onChange:()=>q(e.id)})}),t.jsx("td",{className:"p-3 text-sm",children:e.full_name}),t.jsx("td",{className:"p-3 text-sm",children:((s=e.parent)==null?void 0:s.full_name)||"-"}),t.jsx("td",{className:"p-3 text-sm",children:((o=e.classroom)==null?void 0:o.name)||"-"}),t.jsx("td",{className:"p-3 text-sm",children:e.code||"-"}),t.jsx("td",{className:"p-3 text-sm",children:e.status}),t.jsx("td",{className:"p-3 text-sm",children:e.entry_year}),t.jsx("td",{className:"p-3 text-sm",children:e.gender}),t.jsx("td",{className:"p-3 text-sm",children:e.religion}),t.jsxs("td",{className:"p-3 text-sm",children:[e.birth_place,", ",e.date_of_birth]}),t.jsx("td",{className:"p-3 text-sm",children:e.address}),t.jsxs("td",{className:"flex justify-center gap-2 p-3",children:[t.jsx("button",{onClick:()=>N(e),className:"rounded bg-blue-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Edit"}),t.jsx("button",{onClick:()=>m(e),className:"rounded bg-red-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Delete"}),t.jsx("button",{onClick:async()=>{k(e),h(!0);const n=await(await fetch(route("student.qrcode.preview",{student:e.id}))).text();S(n),w(route("kartu-siswa",{student_id:e.id}))},className:"rounded bg-purple-600 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Kartu"})]})]},e.id)}}),t.jsx(B,{links:u.links}),t.jsx(X,{isOpen:A,onClose:()=>y(!1),student:F,classrooms:D,sexes:O,statuses:E,religions:$}),t.jsx(_,{isOpen:!!d,onClose:()=>m(null),title:"Confirm Deletion",message:t.jsxs("span",{children:["Are you sure you want to delete student ",t.jsx("strong",{children:d==null?void 0:d.full_name}),"?"]}),buttons:[{label:"Cancel",onClick:()=>m(null),variant:"neutral"},{label:"Delete",onClick:()=>{d&&(U(d.id),m(null))},variant:"danger"}]}),t.jsx(_,{isOpen:R,onClose:()=>{h(!1),k(null),S(""),w("")},title:`Kartu Pelajar - ${b==null?void 0:b.full_name}`,message:t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx("div",{dangerouslySetInnerHTML:{__html:L},className:"w-[200px] h-[200px]"}),t.jsx("a",{href:T,download:!0,className:"mt-2 rounded bg-blue-600 px-4 py-2 text-sm text-white hover:bg-blue-700",children:"Download PDF"})]}),buttons:[{label:"Close",onClick:()=>h(!1),variant:"neutral"}]})]})]})}export{pe as default};
