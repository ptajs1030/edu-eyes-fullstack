import{u as k,r as x,j as t,H as E,a as u,L as b}from"./app-CwyQrVac.js";import{A as j}from"./action-modal-CmQfjfRO.js";import{P as H}from"./pagination-y6kwTbXb.js";import{T as P}from"./table-DSnOtHrT.js";import{A as B}from"./app-layout-QY1rCKqJ.js";import{t as f,T as L}from"./index-B_Nm099u.js";import{f as $,p as I}from"./parseISO-C9VBp7jN.js";import{i as M}from"./id-PlgGTalb.js";import"./proxy-Hzq67W2Z.js";import"./createLucideIcon-B4PcBYcm.js";import"./button-DogZJNaI.js";import"./index-DAj_xx8d.js";import"./index-DVzIl63c.js";import"./index-D8yP9zJX.js";import"./app-logo-icon-CHi8gTh8.js";const R=[{title:"Tagihan",href:"/payments"}];function te(){const{payments:m,filters:d}=k().props,{flash:s}=k().props,[n,y]=x.useState([]),[i,p]=x.useState(null),[l,h]=x.useState(null);x.useEffect(()=>{s!=null&&s.success&&f.success(s.success),s!=null&&s.error&&f.error(s.error)},[s]);const v=e=>{u.delete(`payments/${e}`,{onSuccess:()=>{p(null),u.reload()}})},w=e=>{y(a=>a.includes(e)?a.filter(r=>r!==e):[...a,e])},N=()=>{if(n.length===0)return;const e=m.data.filter(o=>n.includes(o.id)),a=["Judul","Nominal","Batas Waktu"],r=o=>`"${String(o).replace(/"/g,'""')}"`,T=e.map(o=>[r(o.title),r(o.nominal),r(o.due_date)]),A=a.map(r).join(",")+`\r
`+T.map(o=>o.join(",")).join(`\r
`),_=new Blob([A],{type:"text/csv"}),D=URL.createObjectURL(_),c=document.createElement("a");c.href=D,c.download="payments.csv",document.body.appendChild(c),c.click(),document.body.removeChild(c),f.success(`Berhasil mengekspor ${e.length} data pembayaran`,{description:"File CSV telah didownload otomatis"})},C=e=>{u.get(route("payments.index"),{sort:e,direction:d.direction==="asc"?"desc":"asc"},{preserveState:!0})},g=e=>{const a=new Date,r=new Date(e.due_date);return r.setHours(23,59,59,999),a>r},S=[{key:"title",label:"Tagihan",sortable:!0},{key:"academic_year.title",label:"Tahun Ajaran",sortable:!1},{key:"nominal",label:"Nominal",sortable:!0},{key:"due_date",label:"Batas Waktu",sortable:!0},{key:"actions",label:"Aksi",sortable:!1}];return t.jsxs(B,{breadcrumbs:R,children:[t.jsx(E,{title:"Tagihan"}),t.jsx(L,{position:"top-right",richColors:!0}),t.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",placeholder:"Cari tagihan...",defaultValue:d.search||"",onChange:e=>u.get(route("payments.index"),{search:e.target.value},{preserveState:!0}),className:"w-64 rounded border px-3 py-1"}),t.jsx("button",{disabled:n.length===0,onClick:N,className:`rounded bg-indigo-600 px-3 py-1 text-sm font-medium text-white hover:bg-indigo-700 ${n.length===0?"cursor-not-allowed opacity-50":"hover:cursor-pointer"}`,children:"Ekspor data yang dipilih"})]}),t.jsx(b,{href:route("payments.create"),className:"rounded bg-green-600 px-3 py-1 text-sm font-medium text-white transition hover:cursor-pointer hover:bg-green-700",children:"Buat Tagihan"})]}),t.jsx(P,{headers:S,data:m.data,sortColumn:d.direction==="asc"||d.direction==="desc"?d.direction:"asc",onSort:C,onSelectAll:e=>y(e?m.data.map(a=>a.id):[]),selectedIds:n,rowRender:e=>t.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[t.jsx("td",{className:"w-[10px] p-3 text-sm",children:t.jsx("input",{type:"checkbox",checked:n.includes(e.id),onChange:()=>w(e.id)})}),t.jsx("td",{className:"p-3 text-sm",children:e.title}),t.jsx("td",{className:"p-3 text-sm",children:e.academic_year.title}),t.jsxs("td",{className:"p-3 text-sm",children:["Rp ",e.nominal.toLocaleString("id-ID")]}),t.jsxs("td",{className:"p-3 text-sm",children:[" ",$(I(e.due_date),"dd MMM yyyy",{locale:M})]}),t.jsxs("td",{className:"flex gap-2 p-3",children:[t.jsx(b,{href:route("payments.edit",e.id),className:"rounded bg-blue-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer hover:bg-blue-600",children:"Edit"}),t.jsx(b,{href:route("payments.show",e.id),className:"rounded bg-sky-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer hover:bg-sky-600",children:"Detail"}),t.jsx("button",{onClick:()=>h(e),disabled:g(e),className:`rounded px-3 py-1 text-sm font-medium text-white ${g(e)?"cursor-not-allowed bg-sky-300":"bg-sky-500 hover:cursor-pointer"}`,title:g(e)?"Tagihan sudah melewati deadline":"Kirim notifikasi",children:"Kirim Notif"}),t.jsx("button",{onClick:()=>p(e),className:"rounded bg-red-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer hover:bg-red-600",children:"Hapus"})]})]},e.id),emptyMessage:"Tidak ada event yang ditemukan"}),t.jsx(H,{links:m.links}),t.jsx(j,{isOpen:!!i,onClose:()=>p(null),title:"Konfirmasi Hapus",message:`Apakah Anda yakin ingin menghapus event "${i==null?void 0:i.title}"?`,buttons:[{label:"Batal",onClick:()=>p(null),variant:"neutral"},{label:"Hapus",onClick:()=>i&&v(i.id),variant:"danger"}]}),t.jsx(j,{isOpen:!!l,onClose:()=>h(null),title:"Confirm Notification",message:t.jsxs("span",{children:["Are you sure you want to send notification for payment ",t.jsx("strong",{children:l==null?void 0:l.title}),"?",t.jsx("br",{}),t.jsx("small",{className:"text-gray-500",children:"Notifikasi akan dikirim ke orang tua siswa yang belum melakukan pembayaran."})]}),buttons:[{label:"Cancel",onClick:()=>h(null),variant:"neutral"},{label:"Send Notification",onClick:()=>{l&&(u.post(route("payments.resend-notification",l.id)),h(null))},variant:"primary"}]})]})]})}export{te as default};
