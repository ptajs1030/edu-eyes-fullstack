import{u as C,r as n,j as e,H as M,a as u}from"./app-BAPB98s5.js";import{F as O}from"./form-modal-B8rRjeBb.js";import{S as D}from"./searchable-select-L0RMlWy2.js";import{A as E}from"./app-layout-DDRi8pf_.js";import{t as F}from"./index-DXmNrHBV.js";import{f as h,p as b}from"./parseISO-C9VBp7jN.js";import{i as A}from"./id-PlgGTalb.js";/* empty css            */import"./proxy-UzE8AFBl.js";import"./button-BoLw_LAS.js";import"./index-C2AIOuuF.js";import"./index-BrNQt190.js";import"./index-BEZTdwTo.js";import"./createLucideIcon-Dff4Dkwf.js";import"./app-logo-icon-KurThtPT.js";const H=(l,o)=>[{title:"Students",href:"/students"},{title:l,href:`/students/${o}/history`},{title:"Attendance History"}];function V({student:l,attendances:o,academicYears:g,filters:c,statistics:f,dayOffOptions:y}){const{flash:d}=C().props,[j,m]=n.useState(!1),[a,v]=n.useState(null),[r,p]=n.useState({}),N=[{value:"present",label:"Present"},{value:"present_in_tolerance",label:"Present in Tolerance"},{value:"alpha",label:"Alpha"},{value:"late",label:"Late"},{value:"leave",label:"Leave"},{value:"sick_leave",label:"Sick Leave"},{value:"day_off",label:"Day Off"}],_=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}];n.useEffect(()=>{d!=null&&d.success&&F.success(d.success)},[d]);const x=(s,t)=>{u.get(route("students.attendance",l.id),{...c,[s]:t},{preserveState:!0})},w=s=>{v(s),p({...s,day_off_reason:s.day_off_reason}),m(!0)},i=(s,t)=>{p(S=>({...S,[s]:t}))},k=s=>{s.preventDefault(),u.patch(`/attendances/${a==null?void 0:a.id}`,r,{preserveScroll:!0,onSuccess:()=>{m(!1),u.reload()},onError:t=>{console.error("Error updating attendance:",t)}})};return e.jsxs(E,{breadcrumbs:H(l.full_name,l.id),children:[e.jsx(M,{title:`Attendance History - ${l.full_name}`}),e.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:"Student Information"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Name"}),e.jsx("p",{children:l.full_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Class"}),e.jsx("p",{children:l.classroom.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Homeroom Teacher"}),e.jsx("p",{children:l.classroom.main_teacher.full_name})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:"Filters"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Academic Year"}),e.jsxs("select",{value:c.academic_year_id,onChange:s=>x("academic_year_id",s.target.value),className:"w-full rounded border p-2",children:[e.jsx("option",{value:"",children:"Select Academic Year"}),g.map(s=>e.jsx("option",{value:s.id,children:s.title},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Month"}),e.jsx("select",{value:c.month,onChange:s=>x("month",s.target.value),className:"w-full rounded border p-2",children:_.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Year"}),e.jsx("input",{type:"number",value:c.year,onChange:s=>x("year",s.target.value),className:"w-full rounded border p-2"})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:"Attendance Statistics (This Month)"}),e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-7",children:Object.entries(f).map(([s,t])=>e.jsxs("div",{className:"rounded bg-gray-100 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold",children:t}),e.jsx("p",{className:"capitalize",children:s.replace(/_/g," ")})]},s))})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Academic Year"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Shifting"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 bg-white",children:[o.map(s=>{var t;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:h(b(s.submit_date),"dd MMM yyyy",{locale:A})}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:(t=s.academic_year)==null?void 0:t.title}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:s.shifting_name}),e.jsxs("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:[s.shifting_start_hour," - ",s.shifting_end_hour]}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:s.clock_in_hour||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:s.clock_out_hour||"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm whitespace-nowrap capitalize",children:[s.status.replace(/_/g," "),s.day_off_reason&&e.jsxs("div",{className:"text-xs text-gray-500",children:["(",s.day_off_reason,")"]})]}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:e.jsx("button",{onClick:()=>w(s),className:"rounded bg-blue-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Edit"})})]},s.id)}),o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-4 text-center text-sm text-gray-500",children:"No attendance records found for this month"})})]})]})}),e.jsxs(O,{isOpen:j,onClose:()=>m(!1),title:"Edit Attendance Record",onSubmit:k,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date"}),e.jsx("input",{type:"text",value:a!=null&&a.submit_date?h(b(a.submit_date),"dd MMM yyyy"):"",disabled:!0,className:"mt-1 block w-full rounded-md border-gray-300 bg-gray-100 p-2 shadow-sm"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Shifting"}),e.jsx("input",{type:"text",value:`${a==null?void 0:a.shifting_name} (${a==null?void 0:a.shifting_start_hour} - ${a==null?void 0:a.shifting_end_hour})`,disabled:!0,className:"mt-1 block w-full rounded-md border-gray-300 bg-gray-100 p-2 shadow-sm"})]}),e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Clock In"}),e.jsx("input",{type:"time",value:r.clock_in_hour||"",onChange:s=>i("clock_in_hour",s.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Clock Out"}),e.jsx("input",{type:"time",value:r.clock_out_hour||"",onChange:s=>i("clock_out_hour",s.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("select",{value:r.status||"",onChange:s=>i("status",s.target.value),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",children:N.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),r.status==="day_off"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Day Off Reason"}),e.jsx(D,{value:r.day_off_reason,onChange:s=>i("day_off_reason",s),placeholder:"Select reason...",options:y.map(s=>({value:s.id.toString(),label:s.description}))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Minutes of Late"}),e.jsx("input",{type:"number",min:"0",value:r.minutes_of_late||"",onChange:s=>i("minutes_of_late",parseInt(s.target.value)||0),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Note"}),e.jsx("textarea",{value:r.note||"",onChange:s=>i("note",s.target.value),rows:3,className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm"})]}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"mr-2 rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700",children:"Update"})]})]})]})]})}export{V as default};
