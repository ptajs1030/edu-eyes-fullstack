import{u as _,r as i,j as t,H as B,a as h,L as Q}from"./app-ClU9h5R4.js";import{A as C}from"./action-modal-DIoEb2B2.js";import{P as G}from"./pagination-BIu63AzN.js";import{T as J}from"./table-C16M18W-.js";import{A as V}from"./app-layout-Cb4w8-Lw.js";import{t as b,T as X}from"./index-BfaWPc7L.js";import z from"./form-DMvUHQnA.js";/* empty css            */import"./proxy-C2Qx7iZF.js";import"./createLucideIcon-B7bNeN9m.js";import"./button-BMoLxgk-.js";import"./index-PJZ04w-J.js";import"./index-BEikCMaC.js";import"./index-4MD-2fZI.js";import"./app-logo-icon-1z5bNqj5.js";import"./form-modal-C1BdXaVW.js";import"./searchable-select-CkgjFOWc.js";const W=[{title:"Siswa",href:"/students"}];function he(){const{students:p,classrooms:O,sexes:T,statuses:$,religions:D,filters:c}=_().props,{flash:l}=_().props;i.useEffect(()=>{l!=null&&l.success&&b.success(l.success),l!=null&&l.error&&b.error(l.error)},[l]);const[L,k]=i.useState(!1),[A,F]=i.useState(null),[o,j]=i.useState([]),[d,x]=i.useState(null),[R,f]=i.useState(!1),[g,y]=i.useState(null),[E,w]=i.useState(""),[P,S]=i.useState(""),N=(e=null)=>{F(e),k(!0)},U=async e=>{h.delete(`/students/${e}`,{onSuccess:()=>{h.reload()}})},H=e=>{j(s=>s.includes(e)?s.filter(r=>r!==e):[...s,e])},I=()=>{if(o.length===0)return;const e=p.data.filter(a=>o.includes(a.id)),s=`Nama,Kelas,Tahun masuk,Jenis kelamin,Agama,Status
`,r=e.map(a=>{var v;return`${a.full_name},${(v=a.classroom)==null?void 0:v.name},${a.entry_year},${a.gender},${a.religion},${a.status}`}).join(`
`),m=new Blob([s,r],{type:"text/csv"}),n=URL.createObjectURL(m),u=document.createElement("a");u.href=n,u.download="students.csv",u.click(),b.success(`Berhasil mengekspor ${e.length} data siswa`,{description:"File CSV telah didownload otomatis"}),URL.revokeObjectURL(n)},K=e=>{const s=c.direction==="asc"?"desc":"asc";let r=e;e==="classroom.name"&&(r="class_name"),h.get(route("students.index"),{sort:r,direction:s},{preserveState:!0})},M=async()=>{var e;if(o.length!==0)try{const s=await fetch("/bulk-kartu-siswa",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.content)||""},body:JSON.stringify({student_ids:o})});if(!s.ok)throw new Error("Failed to download PDF");const r=await s.blob(),m=window.URL.createObjectURL(r),n=document.createElement("a");n.href=m,n.download="kumpulan-kartu-siswa.pdf",n.click()}catch{b.error("Gagal download kartu siswa.")}},q=[{key:"profile_picture",label:"Foto",sortable:!1},{key:"full_name",label:"Nama Siswa",sortable:!0},{key:"parent.full_name",label:"Nama Orang Tua/wali",sortable:!1},{key:"classroom.name",label:"Kelas",sortable:!0},{key:"nis",label:"NIS",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"entry_year",label:"Tahun Masuk",sortable:!0},{key:"gender",label:"Gender",sortable:!0},{key:"religion",label:"Agama",sortable:!0},{key:"date_of_birth",label:"Tanggal Lahir",sortable:!0},{key:"address",label:"Alamat",sortable:!1},{key:"actions",label:"Aksi",sortable:!1}];return t.jsxs(V,{breadcrumbs:W,children:[t.jsx(B,{title:"Siswa"}),t.jsx(X,{position:"top-right",richColors:!0}),t.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",placeholder:"Cari siswa...",defaultValue:c.search||"",onChange:e=>h.get(route("students.index"),{search:e.target.value},{preserveState:!0}),className:"w-64 rounded border px-3 py-1"}),t.jsx("button",{disabled:o.length===0,onClick:I,className:`rounded bg-indigo-600 px-3 py-1 text-sm font-medium text-white hover:bg-indigo-700 ${o.length===0?"opacity-50 cursor-not-allowed":"hover:cursor-pointer"}`,children:"Ekspor data yang dipilih"}),t.jsx("button",{disabled:o.length===0,onClick:M,className:"rounded bg-indigo-700 px-3 py-1 text-sm font-medium text-white hover:bg-indigo-700 disabled:cursor-not-allowed disabled:opacity-50",children:"Bulk Print Kartu Siswa"})]}),t.jsx("button",{onClick:()=>N(null),className:"rounded bg-green-600 px-3 py-1 text-sm font-medium text-white transition hover:cursor-pointer hover:bg-green-700",children:"Tambah Siswa"})]}),t.jsx(J,{headers:q,data:p.data,sortColumn:c.sort??"",sortDirection:c.direction==="asc"||c.direction==="desc"?c.direction:"asc",onSort:K,onSelectAll:e=>j(e?p.data.map(s=>s.id):[]),selectedIds:o,rowRender:e=>{var s,r,m,n;return t.jsxs("tr",{className:"border-b",children:[t.jsx("td",{className:"w-[10px] p-3 text-sm",children:t.jsx("input",{type:"checkbox",checked:o.includes(e.id),onChange:()=>H(e.id)})}),t.jsx("td",{className:"p-3",children:t.jsx("div",{className:"flex justify-center",children:e.profile_picture?t.jsx("img",{src:`/storage/${e.profile_picture}`,alt:e.full_name,className:"h-10 w-10 rounded-full border border-gray-300 object-cover"}):t.jsx("img",{src:`https://api.dicebear.com/9.x/initials/svg?seed=${encodeURIComponent(e.full_name)}`,alt:e.full_name,className:"h-10 w-10 rounded-full border border-gray-300 object-cover"})})}),t.jsx("td",{className:"p-3 text-sm",children:e.full_name}),t.jsx("td",{className:"p-3 text-sm",children:((s=e.parent)==null?void 0:s.full_name)||"-"}),t.jsx("td",{className:"p-3 text-sm",children:((r=e.classroom)==null?void 0:r.name)||"-"}),t.jsx("td",{className:"p-3 text-sm",children:e.nis||"-"}),t.jsx("td",{className:"p-3 text-sm",children:e.status}),t.jsx("td",{className:"p-3 text-sm",children:e.entry_year}),t.jsx("td",{className:"p-3 text-sm",children:e.gender}),t.jsx("td",{className:"p-3 text-sm",children:e.religion}),t.jsxs("td",{className:"p-3 text-sm",children:[e.birth_place,", ",e.date_of_birth]}),t.jsx("td",{className:"p-3 text-sm",children:e.address?e.address.length>70?e.address.substring(0,70)+"...":e.address:"-"}),t.jsxs("td",{className:"flex justify-center gap-2 p-3",children:[t.jsx("button",{onClick:()=>N(e),className:"rounded bg-blue-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Edit"}),t.jsx(Q,{href:route("students.attendance",e.id),className:`rounded px-3 py-1 text-sm font-medium text-white ${(m=e.classroom)!=null&&m.name?"bg-sky-500 hover:bg-sky-600 hover:cursor-pointer":"bg-sky-300 cursor-not-allowed"}`,onClick:u=>{var a;(a=e.classroom)!=null&&a.name||u.preventDefault()},title:(n=e.classroom)!=null&&n.name?"":"Siswa harus memiliki kelas untuk melihat kehadiran",children:"Kehadiran"}),t.jsx("button",{onClick:async()=>{y(e),f(!0);const a=await(await fetch(route("student.qrcode.preview",{student:e.id}))).text();S(a),w(route("kartu-siswa",{student_id:e.id}))},className:"rounded bg-sky-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Kartu"}),t.jsx("button",{onClick:()=>x(e),className:"rounded bg-red-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Hapus"})]})]},e.id)}}),t.jsx(G,{links:p.links}),t.jsx(z,{isOpen:L,onClose:()=>k(!1),student:A,classrooms:O,sexes:T,statuses:$,religions:D}),t.jsx(C,{isOpen:!!d,onClose:()=>x(null),title:"Confirm Deletion",message:t.jsxs("span",{children:["Are you sure you want to delete student ",t.jsx("strong",{children:d==null?void 0:d.full_name}),"?"]}),buttons:[{label:"Cancel",onClick:()=>x(null),variant:"neutral"},{label:"Delete",onClick:()=>{d&&(U(d.id),x(null))},variant:"danger"}]}),t.jsx(C,{isOpen:R,onClose:()=>{f(!1),y(null),S(""),w("")},title:`Kartu Pelajar - ${g==null?void 0:g.full_name}`,message:t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx("div",{dangerouslySetInnerHTML:{__html:P},className:"h-[200px] w-[200px]"}),t.jsx("a",{href:E,download:!0,className:"mt-2 rounded bg-blue-600 px-4 py-2 text-sm text-white hover:bg-blue-700",children:"Download PDF"})]}),buttons:[{label:"Close",onClick:()=>f(!1),variant:"neutral"}]})]})]})}export{he as default};
