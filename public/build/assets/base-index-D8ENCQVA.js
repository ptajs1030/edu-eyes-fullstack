import{r as l,j as e,a as v,u as Z,H as ee}from"./app-DbxBr_WT.js";import{A as K}from"./action-modal-CwSGfu9x.js";import{F as te}from"./form-modal-BsoJLtaP.js";import{t as k,T as se}from"./index-DPUTuqkb.js";import{r as ae,u as ne}from"./xlsx-BUW7exb-.js";import{P as re}from"./pagination-XS-uLa5H.js";import{T as le}from"./table-D94bGRmy.js";import{A as oe}from"./app-layout-BeU5Dg__.js";import ie from"./base-form-BMj95vOx.js";/* empty css            */import"./proxy-CNGh_iPB.js";import"./index-DK2coJeE.js";import"./createLucideIcon-CjJOy3if.js";import"./button-BRBq7opn.js";import"./index-D1f6Z3gr.js";import"./index-DPup30Fu.js";import"./app-logo-icon-BUM04f4c.js";const ce=d=>{switch(d){case"parent":return["full_name","username","email","phone","address","password","status","job"];case"teacher":return["full_name","username","email","phone","address","password","status","nip","position"];default:return["parent","classroom","full_name","nis","entry_year","gender","status","religion","birth_place","date_of_birth","address"]}},de=d=>{switch(d){case"parent":return["full_name","username","email","phone","address","password","status","job"];case"teacher":return["full_name","username","email","phone","address","password","status","nip","position"];default:return["parent","classroom","full_name","nis","entry_year","gender","status","religion","birth_place","date_of_birth","address"]}},J=d=>d.replace(/\*/g,"").trim().toLowerCase().replace(/\s+/g,"_");function ue({isOpen:d,onClose:L,role:a,routePrefix:O}){const[_,s]=l.useState(null),[u,j]=l.useState(""),[R,S]=l.useState(!1),[m,p]=l.useState(!1),U=()=>{s(null),j(""),S(!1),p(!1)},x=()=>{m||(U(),L())},w=b=>{var o;j("");const r=((o=b.target.files)==null?void 0:o[0])??null;if(!r){s(null);return}const N=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"];if(r.type&&!N.includes(r.type)){j("Tipe file tidak didukung. Harap upload .xlsx / .xls"),s(null);return}S(!0);const f=new FileReader;f.onload=E=>{var g;try{const $=(g=E.target)==null?void 0:g.result,F=ae($,{type:"array"}),h=F.SheetNames[0],T=F.Sheets[h],A=(ne.sheet_to_json(T,{header:1})[0]||[]).map(M=>J(String(M??""))),I=ce(a.value).map(J);A.length===I.length&&I.every((M,D)=>M===A[D])?(s(r),k.success("File valid. Siap di-import.")):(j("Header file tidak sesuai template. Gunakan template terbaru."),s(null))}catch{j("Gagal membaca file. Pastikan format Excel valid."),s(null)}finally{S(!1)}},f.readAsArrayBuffer(r)},y=async()=>{var b;try{const r=await fetch(route("users.template",a.value),{method:"GET"});if(!r.ok){const g=((b=await r.json().catch(()=>null))==null?void 0:b.message)||"Gagal mengunduh template";k.error(g);return}const N=await r.blob(),f=window.URL.createObjectURL(N),o=document.createElement("a"),E=r.headers.get("X-File-Name")||`template-import-${a.value}.xlsx`;o.href=f,o.download=E,document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(f),k.success(`Template ${a.name} berhasil diunduh`)}catch{k.error("Terjadi kesalahan saat mengunduh template")}},C=()=>{if(!_){j("Pilih file terlebih dahulu");return}p(!0);const b=new FormData;b.append("file",_),v.post(route(`${O}.import`),b,{onStart:()=>p(!0),onSuccess:()=>{p(!1),x(),v.reload()},onError:r=>{const N=(r==null?void 0:r.file)||"Import gagal. Periksa isi file.";k.error(N),p(!1)},onFinish:()=>p(!1),headers:{"Content-Type":"multipart/form-data"},preserveScroll:!0})};return e.jsxs(te,{isOpen:d,onClose:x,title:`Import Data ${a.name}`,onSubmit:b=>{b.preventDefault(),C()},children:[e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"rounded-lg border border-dashed border-gray-300 p-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Upload File (.xlsx / .xls)"}),e.jsx("div",{className:"relative mt-1",children:e.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:w,disabled:m,className:"block w-full text-sm text-gray-500 file:mr-4 file:rounded-md file:border-0 file:bg-blue-50 file:px-4 file:py-2.5 file:text-sm file:font-medium file:text-blue-700 hover:file:bg-blue-100"})}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Gunakan template agar header sesuai. Maks 2MB."}),u&&e.jsx("div",{className:"mt-2 text-xs text-red-600",children:u}),R&&e.jsxs("div",{className:"mt-2 inline-flex items-center text-xs text-gray-600",children:[e.jsxs("svg",{className:"mr-1.5 h-3.5 w-3.5 animate-spin",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor"}),e.jsx("path",{className:"opacity-75",d:"M4 12a8 8 0 018-8v8z",fill:"currentColor"})]}),"Memvalidasi header..."]})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("button",{type:"button",onClick:y,className:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:cursor-pointer hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none",disabled:m,children:[e.jsx("svg",{className:"mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5m0 0l5-5m-5 5V3"})}),"Template"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Header: ",de(a.value).join(", ")]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx("button",{type:"button",onClick:x,disabled:m,className:"mr-2 rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:cursor-pointer hover:bg-gray-50",children:"Batal"}),e.jsxs("button",{type:"submit",disabled:m||!_||!!u||R,className:`inline-flex items-center rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm ${m?"cursor-not-allowed bg-blue-400":"bg-blue-600 hover:cursor-pointer hover:bg-blue-700"}`,children:[m&&e.jsxs("svg",{className:"mr-2 h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor"}),e.jsx("path",{className:"opacity-75",d:"M4 12a8 8 0 018-8v8z",fill:"currentColor"})]}),m?"Memproses...":"Impor"]})]})]})}function Ee({users:d,statuses:L,filters:a,breadcrumbs:O,title:_,role:s,routePrefix:u}){const[j,R]=l.useState(!1),[S,m]=l.useState(!1),[p,U]=l.useState(null),[x,w]=l.useState([]),[y,C]=l.useState(null),[b,r]=l.useState(null),[N,f]=l.useState(!1),[o,E]=l.useState(a.show||"10"),[g,$]=l.useState(a.status||"");l.useEffect(()=>{w([])},[o,g,a.search,a.sort,a.direction]);const F=async t=>{if(!t.phone){r(t),f(!0);return}v.put(route(`${u}.reset-password`,t.id),{},{onSuccess:()=>{var B;const n=encodeURIComponent("Password akun EduEyes Anda telah direset. Password baru: eduEyes123");let i=((B=t.phone)==null?void 0:B.replace(/[^0-9]/g,""))||"";i.startsWith("08")&&(i="628"+i.slice(2));const H=`https://wa.me/${i}?text=${n}`;window.open(H,"_blank")},onError:n=>{console.log(n)}})},{flash:h}=Z().props;l.useEffect(()=>{h!=null&&h.success&&k.success(h.success),h!=null&&h.error&&k.error(h.error)},[h]);const T=(t=null)=>{U(t),R(!0)},G=t=>{v.delete(route(`${u}.destroy`,t),{onSuccess:()=>{v.reload()}})},A=t=>{w(n=>n.includes(t)?n.filter(i=>i!==t):[...n,t])},I=()=>{if(x.length===0)return;const t=d.data.filter(c=>x.includes(c.id)),n=`Name,Username,Role,Phone,Email,Status
`,i=c=>c==null||c===""?"-":c,H=t.map(c=>{var W;return[i(c.full_name),i(c.username),i((W=c.role)==null?void 0:W.name),i(c.phone),i(c.email),i(c.status)].join(",")}).join(`
`),B=new Blob([n,H],{type:"text/csv"}),Q=URL.createObjectURL(B),P=document.createElement("a");P.href=Q,P.download=`${s.value}-users.csv`,P.click(),k.success(`Berhasil mengekspor ${t.length} data ${z(s.name)}`,{description:"File CSV telah didownload otomatis"})},V=t=>{v.get(route(`${u}.index`),{sort:t,direction:a.direction==="asc"?"desc":"asc"},{preserveState:!0})},M=t=>{const n=t.target.value;E(n),w([]),v.get(route(`${u}.index`),{...a,show:n,status:g||void 0},{preserveState:!0,replace:!0})},D=t=>{const n=t.target.value;$(n),w([]),v.get(route(`${u}.index`),{...a,status:n||void 0,show:o},{preserveState:!0,replace:!0})},X=[...s.value==="admin"||s.value==="teacher"?[{key:"profile_picture",label:"Foto",sortable:!1}]:[],{key:"full_name",label:"Nama",sortable:!0},...s.value==="admin"||s.value==="teacher"?[{key:"nip",label:"NIP",sortable:!0}]:[],{key:"username",label:"Username",sortable:!0},...s.value==="admin"||s.value==="teacher"?[{key:"position",label:"Jabatan",sortable:!0}]:[{key:"job",label:"Pekerjaan",sortable:!0}],{key:"phone",label:"Nomor Telepon",sortable:!0},{key:"email",label:"Email",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"address",label:"Alamat",sortable:!0},{key:"actions",label:"Aksi",sortable:!1}],Y=t=>{switch(t){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},q=t=>{switch(t){case"active":return"Active";case"inactive":return"Inactive";default:return t}},z=t=>({Admin:"Admin",Teacher:"Guru",Parent:"Orang Tua"})[t]||t;return e.jsxs(oe,{breadcrumbs:O,children:[e.jsx(ee,{title:_}),e.jsx(se,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"flex items-center gap-3 px-6 pt-6 pb-1",children:[e.jsx("input",{type:"text",placeholder:"Cari pengguna...",defaultValue:a.search||"",onChange:t=>{w([]),v.get(route(`${u}.index`),{...a,search:t.target.value,show:o,status:g},{preserveState:!0})},className:"w-64 rounded border px-3 py-1 text-sm bg-white"}),e.jsxs("select",{value:o,onChange:M,className:"rounded border px-2 py-1 text-sm min-w-[100px] bg-white",children:[e.jsx("option",{value:"10",children:"Show 10 data"}),e.jsx("option",{value:"20",children:"Show 20 data"}),e.jsx("option",{value:"all",children:"Show All"})]}),e.jsxs("select",{value:g,onChange:D,className:"rounded border px-2 py-1 text-sm min-w-[120px] bg-white",children:[e.jsx("option",{value:"",children:"Semua Status"}),e.jsx("option",{value:"active",children:"Aktif"}),e.jsx("option",{value:"inactive",children:"Nonaktif"})]}),e.jsx("button",{disabled:x.length===0,onClick:I,className:`rounded bg-indigo-600 px-3 py-1 text-sm font-medium text-white hover:bg-indigo-700 ${x.length===0?"cursor-not-allowed opacity-50":"hover:cursor-pointer"}`,children:"Ekspor Data"}),e.jsxs("button",{onClick:()=>m(!0),className:"inline-flex items-center rounded bg-blue-600 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer hover:bg-indigo-700",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5-5 5 5M12 5v14"})}),"Impor Data"]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:()=>T(null),className:"rounded bg-green-600 px-3 py-1 text-sm font-medium text-white transition hover:cursor-pointer hover:bg-green-700 ml-2",children:["Tambah ",z(s.name)]})]}),e.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[e.jsx(le,{headers:X,data:d.data,sortColumn:a.sort??"",sortDirection:a.direction==="asc"||a.direction==="desc"?a.direction:"asc",onSort:V,onSelectAll:t=>w(t?d.data.map(n=>n.id):[]),selectedIds:x,rowRender:t=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"w-[10px] p-3 text-sm",children:e.jsx("input",{type:"checkbox",checked:x.includes(t.id),onChange:()=>A(t.id)})}),(s.value==="admin"||s.value==="teacher")&&e.jsx("td",{className:"w-[50px] p-3 text-sm",children:e.jsx("div",{className:"h-10 w-10 overflow-hidden rounded-full border shadow-sm",children:e.jsx("img",{src:t.profile_picture?`/storage/${t.profile_picture}`:`https://api.dicebear.com/9.x/initials/svg?seed=${encodeURIComponent(t.full_name)}`,alt:t.full_name,className:"h-full w-full object-cover"})})}),e.jsx("td",{className:"p-3 text-sm",children:t.full_name}),(s.value==="admin"||s.value==="teacher")&&e.jsx("td",{className:"p-3 text-sm",children:t.nip||"-"}),e.jsx("td",{className:"p-3 text-sm",children:t.username}),(s.value==="admin"||s.value==="teacher")&&e.jsx("td",{className:"p-3 text-sm",children:t.position||"-"}),s.value==="parent"&&e.jsx("td",{className:"p-3 text-sm",children:t.job||"-"}),e.jsx("td",{className:"p-3 text-sm",children:t.phone||"-"}),e.jsx("td",{className:"p-3 text-sm",children:t.email||"-"}),e.jsx("td",{className:"p-3 text-sm",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${Y(t.status)}`,children:q(t.status)})}),e.jsx("td",{className:"p-3 text-sm",children:t.address?t.address.length>70?t.address.substring(0,70)+"...":t.address:"-"}),e.jsx("td",{className:"p-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>T(t),className:"rounded bg-blue-500 px-3 py-1 font-medium text-white hover:cursor-pointer",children:"Edit"}),e.jsx("button",{onClick:()=>C(t),className:"rounded bg-red-500 px-3 py-1 font-medium text-white hover:cursor-pointer",children:"Hapus"}),e.jsx("button",{onClick:()=>F(t),className:"rounded bg-yellow-500 px-5 py-1 font-medium whitespace-nowrap text-white hover:cursor-pointer",children:"Reset Password"})]})})]},t.id)}),e.jsx(re,{links:d.links}),e.jsx(ie,{isOpen:j,onClose:()=>R(!1),user:p,statuses:L,role:s,routePrefix:u},(p==null?void 0:p.id)||"new"),e.jsx(K,{isOpen:!!y,onClose:()=>C(null),title:"Konfirmasi Penghapusan",message:e.jsxs("span",{children:["Apakah Anda yakin ingin menghapus user ",e.jsx("strong",{children:y==null?void 0:y.full_name}),"?"]}),buttons:[{label:"Batal",onClick:()=>C(null),variant:"neutral"},{label:"Ya, Hapus",onClick:()=>{y&&(G(y.id),C(null))},variant:"danger"}]}),e.jsx(K,{isOpen:N,onClose:()=>f(!1),title:"Reset Password Error",message:e.jsx("span",{children:"Phone is not set for this user"}),buttons:[{label:"OK",onClick:()=>f(!1),variant:"neutral"}]}),S&&e.jsx(ue,{isOpen:S,onClose:()=>m(!1),role:s,routePrefix:u})]})]})}export{Ee as default};
