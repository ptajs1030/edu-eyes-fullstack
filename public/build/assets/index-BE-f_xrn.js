import{u as $,r as l,j as s,H as X,a as x,L as W}from"./app-D8XG0Rmg.js";import{A as T}from"./action-modal-D8opk60U.js";import{P as Y}from"./pagination-CUeqAuHY.js";import{T as Z}from"./table-D70Gaer_.js";import{A as ee}from"./app-layout-CGQ0l1vE.js";import{t as g,T as se}from"./index-CEvaMyb9.js";import te from"./form-Ch73lUM-.js";/* empty css            */import"./proxy-C7xXScaA.js";import"./createLucideIcon-BPgAGPHC.js";import"./button-CTsKmUot.js";import"./index-jsT1uCmf.js";import"./index-BPtrcz-m.js";import"./index-BeS7fM6n.js";import"./app-logo-icon-qRSlk0Tl.js";import"./form-modal-4VBxfOhC.js";import"./searchable-select-BWS4HuGL.js";const ae=[{title:"Siswa",href:"/students"}];function ke(){const{students:h,classrooms:y,sexes:D,statuses:L,religions:A,filters:n}=$().props,{flash:i}=$().props;l.useEffect(()=>{i!=null&&i.success&&g.success(i.success),i!=null&&i.error&&g.error(i.error)},[i]);const[R,k]=l.useState(!1),[E,K]=l.useState(null),[o,w]=l.useState([]),[m,b]=l.useState(null),[P,f]=l.useState(!1),[j,N]=l.useState(null),[U,S]=l.useState(""),[H,v]=l.useState(""),[d,C]=l.useState(n.classrooms||[]),[_,M]=l.useState(!1),I=e=>{const t=d.includes(e)?d.filter(a=>a!==e):[...d,e];C(t),x.get(route("students.index"),{...n,classrooms:t.length>0?t:null},{preserveState:!0})},q=()=>{C([]),x.get(route("students.index"),{...n,classrooms:null},{preserveState:!0})},F=(e=null)=>{K(e),k(!0)},B=async e=>{x.delete(`/students/${e}`,{onSuccess:()=>{x.reload()}})},Q=e=>{w(t=>t.includes(e)?t.filter(a=>a!==e):[...t,e])},G=()=>{if(o.length===0)return;const e=h.data.filter(r=>o.includes(r.id)),t=`Nama,Kelas,Tahun masuk,Jenis kelamin,Agama,Status
`,a=e.map(r=>{var O;return`${r.full_name},${(O=r.classroom)==null?void 0:O.name},${r.entry_year},${r.gender},${r.religion},${r.status}`}).join(`
`),u=new Blob([t,a],{type:"text/csv"}),c=URL.createObjectURL(u),p=document.createElement("a");p.href=c,p.download="students.csv",p.click(),g.success(`Berhasil mengekspor ${o.length} data siswa`,{description:"File CSV telah didownload otomatis"}),URL.revokeObjectURL(c)},J=e=>{const t=n.direction==="asc"?"desc":"asc";let a=e;e==="classroom.name"&&(a="class_name"),x.get(route("students.index"),{sort:a,direction:t},{preserveState:!0})},V=async()=>{var e;if(o.length!==0)try{const t=await fetch("/bulk-kartu-siswa",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.content)||""},body:JSON.stringify({student_ids:o})});if(!t.ok)throw new Error("Failed to download PDF");const a=await t.blob(),u=window.URL.createObjectURL(a),c=document.createElement("a");c.href=u,c.download="kumpulan-kartu-siswa.pdf",c.click()}catch{g.error("Gagal download kartu siswa.")}},z=[{key:"profile_picture",label:"Foto",sortable:!1},{key:"full_name",label:"Nama Siswa",sortable:!0},{key:"parent.full_name",label:"Nama Orang Tua/wali",sortable:!1},{key:"classroom.name",label:"Kelas",sortable:!0},{key:"nis",label:"NIS",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"entry_year",label:"Tahun Masuk",sortable:!0},{key:"gender",label:"Gender",sortable:!0},{key:"religion",label:"Agama",sortable:!0},{key:"date_of_birth",label:"Tanggal Lahir",sortable:!0},{key:"address",label:"Alamat",sortable:!1},{key:"actions",label:"Aksi",sortable:!1}];return s.jsxs(ee,{breadcrumbs:ae,children:[s.jsx(X,{title:"Siswa"}),s.jsx(se,{position:"top-right",richColors:!0}),s.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"text",placeholder:"Cari siswa...",defaultValue:n.search||"",onChange:e=>x.get(route("students.index"),{search:e.target.value},{preserveState:!0}),className:"w-64 rounded border px-3 py-1"}),s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:()=>M(!_),className:"rounded bg-gray-200 px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-300",children:["Filter Kelas ",d.length>0?`(${d.length})`:""]}),_&&s.jsxs("div",{className:"absolute top-full left-0 z-10 mt-1 w-64 rounded-md border border-gray-200 bg-white p-3 shadow-lg",children:[s.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[s.jsx("span",{className:"text-sm font-medium",children:"Filter by Kelas"}),d.length>0&&s.jsx("button",{onClick:q,className:"text-xs text-blue-600 hover:text-blue-800",children:"Clear"})]}),s.jsx("div",{className:"max-h-48 overflow-y-auto",children:y.map(e=>s.jsxs("label",{className:"flex items-center space-x-2 py-1",children:[s.jsx("input",{type:"checkbox",checked:d.includes(e.id),onChange:()=>I(e.id),className:"rounded border-gray-300"}),s.jsx("span",{className:"text-sm",children:e.name})]},e.id))})]})]}),s.jsx("button",{disabled:o.length===0,onClick:G,className:`rounded bg-indigo-600 px-3 py-1 text-sm font-medium text-white hover:bg-indigo-700 ${o.length===0?"cursor-not-allowed opacity-50":"hover:cursor-pointer"}`,children:"Ekspor data yang dipilih"}),s.jsx("button",{disabled:o.length===0,onClick:V,className:"rounded bg-indigo-700 px-3 py-1 text-sm font-medium text-white hover:bg-indigo-700 disabled:cursor-not-allowed disabled:opacity-50",children:"Bulk Print Kartu Siswa"})]}),s.jsx("button",{onClick:()=>F(null),className:"rounded bg-green-600 px-3 py-1 text-sm font-medium text-white transition hover:cursor-pointer hover:bg-green-700",children:"Tambah Siswa"})]}),s.jsx(Z,{headers:z,data:h.data,sortColumn:n.sort??"",sortDirection:n.direction==="asc"||n.direction==="desc"?n.direction:"asc",onSort:J,onSelectAll:e=>w(e?h.data.map(t=>t.id):[]),selectedIds:o,rowRender:e=>{var t,a,u,c;return s.jsxs("tr",{className:"border-b",children:[s.jsx("td",{className:"w-[10px] p-3 text-sm",children:s.jsx("input",{type:"checkbox",checked:o.includes(e.id),onChange:()=>Q(e.id)})}),s.jsx("td",{className:"p-3",children:s.jsx("div",{className:"flex justify-center",children:e.profile_picture?s.jsx("img",{src:`/storage/${e.profile_picture}`,alt:e.full_name,className:"h-10 w-10 rounded-full border border-gray-300 object-cover"}):s.jsx("img",{src:`https://api.dicebear.com/9.x/initials/svg?seed=${encodeURIComponent(e.full_name)}`,alt:e.full_name,className:"h-10 w-10 rounded-full border border-gray-300 object-cover"})})}),s.jsx("td",{className:"p-3 text-sm",children:e.full_name}),s.jsx("td",{className:"p-3 text-sm",children:((t=e.parent)==null?void 0:t.full_name)||"-"}),s.jsx("td",{className:"p-3 text-sm",children:((a=e.classroom)==null?void 0:a.name)||"-"}),s.jsx("td",{className:"p-3 text-sm",children:e.nis||"-"}),s.jsx("td",{className:"p-3 text-sm",children:e.status}),s.jsx("td",{className:"p-3 text-sm",children:e.entry_year}),s.jsx("td",{className:"p-3 text-sm",children:e.gender}),s.jsx("td",{className:"p-3 text-sm",children:e.religion}),s.jsxs("td",{className:"p-3 text-sm",children:[e.birth_place,", ",e.date_of_birth]}),s.jsx("td",{className:"p-3 text-sm",children:e.address?e.address.length>70?e.address.substring(0,70)+"...":e.address:"-"}),s.jsxs("td",{className:"flex justify-center gap-2 p-3",children:[s.jsx("button",{onClick:()=>F(e),className:"rounded bg-blue-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Edit"}),s.jsx(W,{href:route("students.attendance",e.id),className:`rounded px-3 py-1 text-sm font-medium text-white ${(u=e.classroom)!=null&&u.name?"bg-sky-500 hover:cursor-pointer hover:bg-sky-600":"cursor-not-allowed bg-sky-300"}`,onClick:p=>{var r;(r=e.classroom)!=null&&r.name||p.preventDefault()},title:(c=e.classroom)!=null&&c.name?"":"Siswa harus memiliki kelas untuk melihat kehadiran",children:"Kehadiran"}),s.jsx("button",{onClick:async()=>{N(e),f(!0);const r=await(await fetch(route("student.qrcode.preview",{student:e.id}))).text();v(r),S(route("kartu-siswa",{student_id:e.id}))},className:"rounded bg-sky-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Kartu"}),s.jsx("button",{onClick:()=>b(e),className:"rounded bg-red-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Hapus"})]})]},e.id)}}),s.jsx(Y,{links:h.links}),s.jsx(te,{isOpen:R,onClose:()=>k(!1),student:E,classrooms:y,sexes:D,statuses:L,religions:A}),s.jsx(T,{isOpen:!!m,onClose:()=>b(null),title:"Confirm Deletion",message:s.jsxs("span",{children:["Are you sure you want to delete student ",s.jsx("strong",{children:m==null?void 0:m.full_name}),"?"]}),buttons:[{label:"Cancel",onClick:()=>b(null),variant:"neutral"},{label:"Delete",onClick:()=>{m&&(B(m.id),b(null))},variant:"danger"}]}),s.jsx(T,{isOpen:P,onClose:()=>{f(!1),N(null),v(""),S("")},title:`Kartu Pelajar - ${j==null?void 0:j.full_name}`,message:s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsx("div",{dangerouslySetInnerHTML:{__html:H},className:"h-[200px] w-[200px]"}),s.jsx("a",{href:U,download:!0,className:"mt-2 rounded bg-blue-600 px-4 py-2 text-sm text-white hover:bg-blue-700",children:"Download PDF"})]}),buttons:[{label:"Close",onClick:()=>f(!1),variant:"neutral"}]})]})]})}export{ke as default};
