import{C as D,r as u,u as H,j as e,H as P,a as I}from"./app-CHTUFyr0.js";import{C as O}from"./confirmation-modal-d5QLtdIX.js";import{S as R}from"./student-assignment-modal-HCt1Neog.js";import{A as q}from"./app-layout-D7Ta6QFg.js";import{t as a,T as W}from"./index-CyZ4iFcC.js";import"./proxy-DgdGFLcQ.js";import"./button-B8vJXQw0.js";import"./index-B-kDJwHj.js";import"./index-DFoE8YP6.js";import"./index-D_k-w4wp.js";import"./createLucideIcon-CjmOqhRx.js";import"./app-logo-icon-CGWo6Ep7.js";const $=[{title:"Tugas",href:"/tasks"},{title:"Edit Tugas",href:""}];function se({task:i,subjects:f,academicYears:j,classrooms:y}){const{data:t,setData:o,put:_,processing:p}=D({subject_id:i.subject_id,title:i.title,description:i.description||"",due_date:i.due_date,due_time:i.due_time,student_assignments:(i.student_assignments||[]).map(s=>({student_id:s.student_id,student_name:s.student_name,class_name:s.class_name,class_id:s.class_id,score:s.score,is_scored:s.is_scored}))}),[N,c]=u.useState(!1),[v,w]=u.useState(i.title.length),{errors:n,flash:l}=H().props;u.useEffect(()=>{l!=null&&l.success&&a.success(l.success),l!=null&&l.error&&a.error(l.error),n&&Object.keys(n).length>0&&Object.values(n).forEach(s=>{a.error(s)})},[l,n]);const k=s=>{if(s.preventDefault(),!Array.isArray(t.student_assignments)||t.student_assignments.length===0){a.error("Minimal harus memilih 1 siswa untuk tugas ini");return}const r=a.loading("Memperbarui tugas...");_(`/tasks/${i.id}`,{onSuccess:()=>{a.dismiss(r)},onError:m=>{a.dismiss(r),m.student_assignments?a.error("Terjadi kesalahan pada data siswa yang dipilih"):m.title?a.error("Nama tugas tidak valid"):m.subject_id?a.error("Mata pelajaran harus dipilih"):a.error("Terjadi kesalahan validasi data")},onFinish:()=>{a.dismiss(r)}})},S=s=>{const r=s.target.value;r.length<=70&&(o("title",r),w(r.length))},C=s=>{const r=t.student_assignments.map(d=>d.student_id),m=s.filter(d=>!r.includes(d.student_id));o("student_assignments",[...t.student_assignments,...m.map(d=>({student_id:d.student_id,student_name:d.student_name,class_name:d.class_name,class_id:d.class_id,score:d.score??null,is_scored:d.is_scored??!1}))]),c(!1),a.success(`${m.length} siswa berhasil ditambahkan`)},[M,x]=u.useState(!1),[b,g]=u.useState(null),T=(s,r)=>{if(r){g(s),x(!0);return}o("student_assignments",t.student_assignments.filter(m=>m.student_id!==s)),a.success("Siswa berhasil dihapus dari Tugas")},A=()=>{b!==null&&(o("student_assignments",t.student_assignments.filter(s=>s.student_id!==b)),a.success("Siswa berhasil dihapus dari Tugas")),x(!1),g(null)},L=()=>{x(!1),g(null)},h=j.find(s=>s.id===i.academic_year_id)||i.academic_year,E=t.student_assignments.filter(s=>s.is_scored).length,B=t.student_assignments.length;return e.jsxs(q,{breadcrumbs:$,children:[e.jsx(P,{title:`Edit Tugas - ${i.title}`}),e.jsx(W,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsxs("h2",{className:"mb-6 text-2xl font-semibold text-gray-900",children:["Edit Exam: ",i.title]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Tahun Ajaran"}),e.jsx("input",{type:"text",value:(h==null?void 0:h.title)||"Loading...",disabled:!0,className:"w-full cursor-not-allowed rounded-lg border border-gray-300 bg-gray-100 px-4 py-2 text-gray-600",readOnly:!0}),e.jsx("p",{className:"mt-1 text-xs text-amber-600",children:"Tahun ajaran tidak dapat diperbarui setelah ujian ditambahkan"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Mata Pelajaran *"}),e.jsxs("select",{value:t.subject_id,onChange:s=>o("subject_id",parseInt(s.target.value)),className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Pilih mata pelajaran"}),f.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),n.subject_id&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:n.subject_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Nama *"}),e.jsx("input",{type:"text",value:t.title,onChange:S,className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"Masukkan nama exam",required:!0}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["String, max 70 char (",v,"/70)"]}),n.title&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:n.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Deskripsi"}),e.jsx("input",{type:"text",value:t.description,onChange:s=>o("description",s.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"Deskripsi tugas..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Batas Pengumpulan *"}),e.jsx("input",{type:"date",value:t.due_date,onChange:s=>o("due_date",s.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",required:!0}),n.due_date&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:n.due_date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Batas Pengumpulan (Jam)*"}),e.jsx("input",{type:"time",value:t.due_time,onChange:s=>o("due_time",s.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",required:!0}),n.due_time&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:n.due_time})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Student Assignments"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:[E," dari ",B," siswa sudah dinilai"]})]}),e.jsx("p",{className:"max-w-md text-right text-sm text-red-600",children:"⚠️ Warning: Menghapus siswa yang sudah dinilai akan menghilangkan data skor mereka!"})]}),t.student_assignments.length>0?e.jsx("div",{className:"mb-4 overflow-hidden rounded-lg border border-gray-200",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"Status Nilai"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Action"})]})}),e.jsx("tbody",{children:t.student_assignments.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.student_name,s.is_scored&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-800",children:[e.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Sudah Dinilai"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:s.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:s.class_name}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.is_scored?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"inline-flex rounded-full bg-green-100 px-2 py-1 text-xs font-semibold text-green-800",children:"Sudah Dinilai"}),e.jsxs("span",{className:"mt-1 text-xs text-gray-600",children:["Nilai: ",s.score]})]}):e.jsx("span",{className:"inline-flex rounded-full bg-gray-100 px-2 py-1 text-xs font-semibold text-gray-800",children:"Belum Dinilai"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("button",{type:"button",onClick:()=>T(s.student_id,s.is_scored),className:"flex items-center gap-1 rounded bg-red-500 px-2 py-1 text-xs text-white hover:bg-red-600 hover:opacity-90",title:s.is_scored?"Hati-hati: Siswa ini sudah memiliki nilai!":"Hapus siswa dari exam",children:[e.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Remove"]})})]},s.student_id))})]})}):e.jsx("div",{className:"mb-4 rounded-lg border-2 border-dashed border-gray-300 p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Belum ada siswa yang di-assign ke exam ini"})}),e.jsxs("button",{type:"button",onClick:()=>c(!0),className:"flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Tambah Siswa"]})]}),e.jsxs("div",{className:"flex justify-end gap-4 border-t pt-6",children:[e.jsx("button",{type:"button",onClick:()=>I.get("/tasks"),className:"rounded-lg border border-gray-300 bg-white px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:p,className:"rounded-lg bg-blue-600 px-6 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",children:p?"Memperbarui...":"Ubah"})]})]})]}),e.jsx(R,{isOpen:N,onClose:()=>c(!1),onSubmit:C,classrooms:y,assignedStudentIds:t.student_assignments.map(s=>s.student_id)}),e.jsx(O,{isOpen:M,title:"Konfirmasi Hapus",message:"Siswa ini sudah memiliki nilai. Menghapus siswa akan menghilangkan data nilai tersebut. Apakah Anda yakin ingin melanjutkan?",onConfirm:A,onCancel:L})]})}export{se as default};
