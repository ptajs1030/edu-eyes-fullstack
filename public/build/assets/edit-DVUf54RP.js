import{b as P,r as c,u as I,j as e,H as O,a as q}from"./app-RtmSSgIt.js";import{C as W}from"./confirmation-modal-De1BJra0.js";import{S as $}from"./student-assignment-modal-BMTWi3Xa.js";import{A as F}from"./app-layout-DmT0hxPZ.js";import{R as K}from"./rich-text-editor-DaHQjbpH.js";import{t as n,T as J}from"./index-CEaZY_xi.js";/* empty css            */import"./proxy-C_JX7idc.js";import"./button-Dn8o4koa.js";import"./index-UIP8aiHW.js";import"./createLucideIcon-RggCplLh.js";import"./index-BfNfS4iZ.js";import"./app-logo-icon-CL7od90h.js";const V=[{title:"Tugas",href:"/tasks"},{title:"Edit Tugas",href:""}];function re({task:i,subjects:f,academicYears:j,classrooms:y}){const{data:s,setData:l,put:_,processing:g}=P({subject_id:i.subject_id,title:i.title,description:i.description||"",due_date:i.due_date,due_time:i.due_time,student_assignments:(i.student_assignments||[]).map(t=>({student_id:t.student_id,student_name:t.student_name,class_name:t.class_name,class_id:t.class_id,score:t.score,is_scored:t.is_scored})),attachments:(i.attachments||[]).map(t=>({url:t.url}))}),[N,u]=c.useState(!1),[v,w]=c.useState(i.title.length),{errors:d,flash:o}=I().props;c.useEffect(()=>{o!=null&&o.success&&n.success(o.success),o!=null&&o.error&&n.error(o.error),d&&Object.keys(d).length>0&&Object.values(d).forEach(t=>{n.error(t)})},[o,d]);const k=t=>{if(t.preventDefault(),!Array.isArray(s.student_assignments)||s.student_assignments.length===0){n.error("Minimal harus memilih 1 siswa untuk tugas ini");return}const a=n.loading("Memperbarui tugas...");_(`/tasks/${i.id}`,{onSuccess:()=>{n.dismiss(a)},onError:r=>{n.dismiss(a),r.student_assignments?n.error("Terjadi kesalahan pada data siswa yang dipilih"):r.title?n.error("Nama tugas tidak valid"):r.subject_id?n.error("Mata pelajaran harus dipilih"):n.error("Terjadi kesalahan validasi data")},onFinish:()=>{n.dismiss(a)}})},S=t=>{const a=t.target.value;a.length<=70&&(l("title",a),w(a.length))},C=()=>{l("attachments",[...s.attachments,{url:""}])},A=t=>{const a=[...s.attachments];a.splice(t,1),l("attachments",a)},T=(t,a)=>{const r=[...s.attachments];r[t].url=a,l("attachments",r)},M=t=>{const a=s.student_assignments.map(m=>m.student_id),r=t.filter(m=>!a.includes(m.student_id));l("student_assignments",[...s.student_assignments,...r.map(m=>({student_id:m.student_id,student_name:m.student_name,class_name:m.class_name,class_id:m.class_id,score:m.score??null,is_scored:m.is_scored??!1}))]),u(!1),n.success(`${r.length} siswa berhasil ditambahkan`)},[L,x]=c.useState(!1),[b,h]=c.useState(null),E=(t,a)=>{if(a){h(t),x(!0);return}l("student_assignments",s.student_assignments.filter(r=>r.student_id!==t)),n.success("Siswa berhasil dihapus dari Tugas")},H=()=>{b!==null&&(l("student_assignments",s.student_assignments.filter(t=>t.student_id!==b)),n.success("Siswa berhasil dihapus dari Tugas")),x(!1),h(null)},B=()=>{x(!1),h(null)},p=j.find(t=>t.id===i.academic_year_id)||i.academic_year,D=s.student_assignments.filter(t=>t.is_scored).length,R=s.student_assignments.length;return e.jsxs(F,{breadcrumbs:V,children:[e.jsx(O,{title:`Edit Tugas - ${i.title}`}),e.jsx(J,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsxs("h2",{className:"mb-6 text-2xl font-semibold text-gray-900",children:["Edit Exam: ",i.title]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Tahun Ajaran"}),e.jsx("input",{type:"text",value:(p==null?void 0:p.title)||"Loading...",disabled:!0,className:"w-full cursor-not-allowed rounded-lg border border-gray-300 bg-gray-100 px-4 py-2 text-gray-600",readOnly:!0}),e.jsx("p",{className:"mt-1 text-xs text-amber-600",children:"Tahun ajaran tidak dapat diperbarui setelah ujian ditambahkan"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Mata Pelajaran *"}),e.jsxs("select",{value:s.subject_id,onChange:t=>l("subject_id",parseInt(t.target.value)),className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Pilih mata pelajaran"}),f.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),d.subject_id&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:d.subject_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Nama *"}),e.jsx("input",{type:"text",value:s.title,onChange:S,className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"Masukkan nama exam",required:!0}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["String, max 70 char (",v,"/70)"]}),d.title&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:d.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Deskripsi"}),e.jsx(K,{value:s.description,onChange:t=>l("description",t),placeholder:"Deskripsi tugas..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Lampiran"}),s.attachments.map((t,a)=>e.jsxs("div",{className:"mb-2 flex items-center",children:[e.jsx("input",{type:"url",value:t.url,onChange:r=>T(a,r.target.value),placeholder:"https://example.com/file.pdf",className:"block w-full flex-1 rounded-md border border-gray-300 p-2 shadow-sm"}),e.jsx("button",{type:"button",onClick:()=>A(a),className:"ml-2 rounded-md bg-red-100 px-3 py-2 text-sm font-medium text-red-700 hover:bg-red-200",children:"Hapus"})]},a)),e.jsx("button",{type:"button",onClick:C,className:"rounded-md bg-sky-500 px-3 py-2 text-sm font-medium text-white hover:bg-sky-600",children:"Tambah Lampiran"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Batas Pengumpulan *"}),e.jsx("input",{type:"date",value:s.due_date,onChange:t=>l("due_date",t.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",required:!0}),d.due_date&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:d.due_date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Batas Pengumpulan (Jam)*"}),e.jsx("input",{type:"time",value:s.due_time,onChange:t=>l("due_time",t.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",required:!0}),d.due_time&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:d.due_time})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Student Assignments"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:[D," dari ",R," siswa sudah dinilai"]})]}),e.jsx("p",{className:"max-w-md text-right text-sm text-red-600",children:"⚠️ Warning: Menghapus siswa yang sudah dinilai akan menghilangkan data skor mereka!"})]}),s.student_assignments.length>0?e.jsx("div",{className:"mb-4 overflow-hidden rounded-lg border border-gray-200",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"Status Nilai"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Aksi"})]})}),e.jsx("tbody",{children:s.student_assignments.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.student_name,t.is_scored&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-800",children:[e.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Sudah Dinilai"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.class_name}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.is_scored?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"inline-flex rounded-full bg-green-100 px-2 py-1 text-xs font-semibold text-green-800",children:"Sudah Dinilai"}),e.jsxs("span",{className:"mt-1 text-xs text-gray-600",children:["Nilai: ",t.score]})]}):e.jsx("span",{className:"inline-flex rounded-full bg-gray-100 px-2 py-1 text-xs font-semibold text-gray-800",children:"Belum Dinilai"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("button",{type:"button",onClick:()=>E(t.student_id,t.is_scored),className:"flex items-center gap-1 rounded bg-red-500 px-2 py-1 text-xs text-white hover:bg-red-600 hover:opacity-90",title:t.is_scored?"Hati-hati: Siswa ini sudah memiliki nilai!":"Hapus siswa dari exam",children:[e.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Hapus"]})})]},t.student_id))})]})}):e.jsx("div",{className:"mb-4 rounded-lg border-2 border-dashed border-gray-300 p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Belum ada siswa yang di-assign ke exam ini"})}),e.jsxs("button",{type:"button",onClick:()=>u(!0),className:"flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Tambah Siswa"]})]}),e.jsxs("div",{className:"flex justify-end gap-4 border-t pt-6",children:[e.jsx("button",{type:"button",onClick:()=>q.get("/tasks"),className:"rounded-lg border border-gray-300 bg-white px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:g,className:"rounded-lg bg-blue-600 px-6 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",children:g?"Memperbarui...":"Simpan"})]})]})]}),e.jsx($,{isOpen:N,onClose:()=>u(!1),onSubmit:M,classrooms:y,assignedStudentIds:s.student_assignments.map(t=>t.student_id)}),e.jsx(W,{isOpen:L,title:"Konfirmasi Hapus",message:"Siswa ini sudah memiliki nilai. Menghapus siswa akan menghilangkan data nilai tersebut. Apakah Anda yakin ingin melanjutkan?",onConfirm:H,onCancel:B})]})}export{re as default};
