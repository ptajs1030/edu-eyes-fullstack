import{r as m,u as F,j as e,H as B,a as N}from"./app-CskFeF_N.js";import{A as K}from"./app-layout-6n_kX9hZ.js";import{g as S,i as R}from"./academic-year-utils-Dz9eUY6J.js";import{t as l,T as I}from"./index-B3DqKyLo.js";/* empty css            */import"./button-FJAJ220G.js";import"./index-B7MxsTzw.js";import"./index-fVSEGvmQ.js";import"./index-DWVKtcaN.js";import"./createLucideIcon-DOsS10E8.js";import"./app-logo-icon-Cy2OCdRY.js";function Z({exam:n,academicYears:g}){const[b,y]=m.useState({}),[x,u]=m.useState({}),[j,v]=m.useState({}),{flash:o}=F().props,w=(t,s)=>{const r=S(s);return!R(t,r)},h=g.find(t=>t.id===n.academic_year_id),p=w(h,g),f=S(g),E=[{title:"Ujian",href:"/exams"},{title:"Penilaian",href:""}];m.useEffect(()=>{o!=null&&o.success&&l.success(o.success),o!=null&&o.error&&l.error(o.error)},[o]),m.useEffect(()=>{const t={};n.student_assignments.forEach(s=>{var r;t[s.id]=((r=s.score)==null?void 0:r.toString())||""}),y(t)},[n.student_assignments]);const _=(t,s)=>{(s===""||/^\d*\.?\d*$/.test(s))&&y(r=>({...r,[t]:s}))},C=t=>{u(s=>({...s,[t]:!0}))},k=t=>{var r;const s=(r=n.student_assignments.find(a=>a.id===t))==null?void 0:r.score;y(a=>({...a,[t]:(s==null?void 0:s.toString())||""})),u(a=>({...a,[t]:!1}))},L=async t=>{const s=b[t];if(s===""){l.error("Nilai tidak boleh kosong");return}const r=parseFloat(s);if(isNaN(r)||r<0||r>100){l.error("Nilai harus antara 0-100");return}v(a=>({...a,[t]:!0})),N.put(`/exams/${n.id}/assignments/${t}/score`,{score:r},{onSuccess:()=>{u(i=>({...i,[t]:!1}));const a=n.student_assignments.findIndex(i=>i.id===t);a!==-1&&(n.student_assignments[a].score=r)},onError:a=>{console.error("Error saving score:",a),l.error("Gagal menyimpan nilai"),k(t)},onFinish:()=>{v(a=>({...a,[t]:!1}))}})},A=async()=>{const t=Object.entries(b).filter(([r,a])=>{const i=parseFloat(a);return!isNaN(i)&&i>=0&&i<=100}).map(([r,a])=>({assignment_id:parseInt(r),score:parseFloat(a)}));if(t.length===0){l.error("Tidak ada nilai valid untuk disimpan");return}const s=l.loading("Menyimpan semua nilai...");N.put(`/exams/${n.id}/scores/bulk`,{scores:t},{onSuccess:r=>{l.dismiss(s),u({}),t.forEach(({assignment_id:a,score:i})=>{const c=n.student_assignments.findIndex(d=>d.id===a);c!==-1&&(n.student_assignments[c].score=i)})},onError:r=>{l.dismiss(s),console.error("Error saving bulk scores:",r),l.error("Gagal menyimpan nilai")},onFinish:()=>{l.dismiss(s)}})},T=()=>{const t=["Nama","NIS","Kelas","Nilai"],s=n.student_assignments.map(d=>[d.student_name,d.nis||"-",d.class_name||"-",d.score!==null&&d.score!==void 0?d.score:"-"]),r=[t,...s].map(d=>d.map(D=>`"${String(D).replace(/"/g,'""')}"`).join(",")).join(`
`),a=new Blob([r],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(a),c=document.createElement("a");c.href=i,c.setAttribute("download",`exam_${n.id}_scores.csv`),document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(i),l.success("Data berhasil diekspor ke CSV!")},$=t=>t===null?"text-gray-400":t>=80?"text-green-600":t>=60?"text-yellow-600":"text-red-600",P=t=>t===null?"Belum dinilai":"Sudah Dinilai",U=Object.keys(x).some(t=>x[parseInt(t)]);return e.jsxs(K,{breadcrumbs:E,children:[e.jsx(B,{title:`Penilaian - ${n.name}`}),e.jsx(I,{position:"top-right",richColors:!0}),!p&&e.jsx("div",{className:"m-6 mb-4 rounded-lg border border-yellow-200 bg-yellow-50 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"mr-2 h-5 w-5 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.99-.833-2.46 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium text-yellow-800",children:["Tahun ajaran ",h==null?void 0:h.title," sudah lewat dari tahun ajaran aktif (",f==null?void 0:f.title,")."]}),e.jsx("p",{className:"mt-1 text-sm text-yellow-700",children:"Penilaian hanya dapat dilihat dan tidak dapat diperbarui."})]})]})}),e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-6 border-b pb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:n.name}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tahun Ajaran"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:n.academic_year.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Mata Pelajaran"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:n.subject.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tipe"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:n.type||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tanggal Pelaksanaan"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:new Date(n.date).toLocaleDateString("id-ID")})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"mb-4 flex items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Student Assignments"}),e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Total: ",e.jsx("span",{className:"font-semibold",children:n.student_assignments.length})," siswa"]}),e.jsx("button",{onClick:T,className:"rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:"Ekspor CSV"}),p&&U&&e.jsx("button",{onClick:A,className:"rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:"Simpan Semua Nilai"})]})]})}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-200",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"NILAI"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"Action"})]})}),e.jsx("tbody",{children:n.student_assignments.map(t=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.student_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.class_name}),e.jsx("td",{className:"px-4 py-3 text-center",children:x[t.id]?e.jsx("input",{type:"text",value:b[t.id]||"",onChange:s=>_(t.id,s.target.value),className:"w-16 rounded border border-gray-300 px-2 py-1 text-center text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none",placeholder:"0-100",autoFocus:!0}):e.jsx("span",{className:`text-sm font-medium ${$(t.score)}`,children:t.score!==null?t.score:"-"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${t.score===null?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800"}`,children:P(t.score)})}),e.jsx("td",{className:"px-4 py-3 text-center",children:x[t.id]?e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsx("button",{onClick:()=>L(t.id),disabled:j[t.id],className:"rounded bg-blue-500 px-2 py-1 text-xs text-white hover:bg-blue-600 disabled:opacity-50",children:j[t.id]?"...":"Simpan"}),e.jsx("button",{onClick:()=>k(t.id),disabled:j[t.id],className:"rounded bg-gray-500 px-2 py-1 text-xs text-white hover:bg-gray-600 disabled:opacity-50",children:"Batal"})]}):e.jsx("button",{onClick:()=>C(t.id),className:`rounded px-3 py-1 text-xs text-white ${p?"bg-yellow-500 hover:bg-yellow-600":"bg-yellow-500 disabled:opacity-50 cursor-not-allowed"}`,disabled:!p,children:"Edit"})})]},t.id))})]})})]}),e.jsxs("div",{className:"rounded-lg bg-blue-50 p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900",children:"Petunjuk:"}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-800",children:[e.jsx("li",{children:'• Klik tombol "Edit" untuk memperbarui nilai siswa'}),e.jsx("li",{children:"• Nilai harus antara 0-100"}),e.jsx("li",{children:'• Klik "Simpan" untuk menyimpan nilai atau "Batal" untuk membatalkan'}),e.jsx("li",{children:'• Jika ada beberapa perubahan, gunakan tombol "Simpan Semua Nilai" untuk menyimpan sekaligus'})]})]}),e.jsx("div",{className:"mt-6 flex justify-end border-t pt-6",children:e.jsx("button",{onClick:()=>N.get("/exams"),className:"rounded-lg border border-gray-300 bg-white px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Kembali ke Daftar Exam"})})]})]})}export{Z as default};
