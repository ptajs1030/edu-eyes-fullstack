import{u as T,r as l,j as t,H as se,a as p,L as ae}from"./app-CXjnGY1y.js";import{A as D}from"./action-modal-DTYfV3cN.js";import{P as re}from"./pagination-8p_vfrJW.js";import{T as le}from"./table-65sw97fQ.js";import{A as ne}from"./app-layout-CZdpRmWi.js";import{t as g,T as oe}from"./index-BsFn9WJI.js";import ie from"./form-BKQRVbnE.js";/* empty css            */import"./proxy-DfX2SLbh.js";import"./createLucideIcon-BUO8JAkU.js";import"./button-BhRgJXol.js";import"./index-D3gTFYiZ.js";import"./index-B_zmWCvd.js";import"./index-BgVB6EE3.js";import"./app-logo-icon-BfdDZpV3.js";import"./form-modal-uscH8-Gi.js";import"./searchable-select-B-aZqSvx.js";const ce=[{title:"Siswa",href:"/students"}];function _e(){const{students:h,classrooms:j,sexes:L,statuses:A,religions:K,filters:o}=T().props,{flash:i}=T().props;l.useEffect(()=>{i!=null&&i.success&&g.success(i.success),i!=null&&i.error&&g.error(i.error)},[i]);const[R,w]=l.useState(!1),[E,P]=l.useState(null),[n,k]=l.useState([]),[u,b]=l.useState(null),[U,f]=l.useState(!1),[y,S]=l.useState(null),[I,N]=l.useState(""),[H,v]=l.useState(""),[d,C]=l.useState(o.classrooms||[]),[_,M]=l.useState(!1),B=e=>{const a=d.includes(e)?d.filter(r=>r!==e):[...d,e];C(a),p.get(route("students.index"),{...o,classrooms:a.length>0?a:null},{preserveState:!0})},q=()=>{C([]),p.get(route("students.index"),{...o,classrooms:null},{preserveState:!0})},$=(e=null)=>{P(e),w(!0)},Q=async e=>{p.delete(`/students/${e}`,{onSuccess:()=>{p.reload()}})},J=e=>{k(a=>a.includes(e)?a.filter(r=>r!==e):[...a,e])},G=()=>{if(n.length===0)return;const e=h.data.filter(s=>n.includes(s.id)),a=`Nama Siswa,Nama Orang Tua/Wali,Kelas,NIS,Tahun Masuk,Jenis Kelamin,Agama,Tanggal Lahir,Alamat,Status
`,r=e.map(s=>{var O,F;const Z=s.address?`"${s.address.replace(/[\r\n\u2028\u2029\u0085]+/g," ").replace(/"/g,'""')}"`:'""',ee=s.date_of_birth?new Date(s.date_of_birth).toISOString().slice(0,10):"",te=s.nis?s.nis:"-";return`${s.full_name},${(O=s.parent)==null?void 0:O.full_name},${(F=s.classroom)==null?void 0:F.name},${te},${s.entry_year},${s.gender},${s.religion},${ee},${Z},${s.status}`}).join(`
`),m=new Blob([a,r],{type:"text/csv"}),c=URL.createObjectURL(m),x=document.createElement("a");x.href=c,x.download="students.csv",x.click(),g.success(`Berhasil mengekspor ${n.length} data siswa`,{description:"File CSV telah didownload otomatis"}),URL.revokeObjectURL(c)},V=e=>{const a=o.direction==="asc"?"desc":"asc";let r=e;e==="classroom.name"&&(r="class_name"),p.get(route("students.index"),{sort:r,direction:a},{preserveState:!0})},z=async()=>{var e;if(n.length!==0)try{const a=await fetch("/bulk-kartu-siswa",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.content)||""},body:JSON.stringify({student_ids:n})});if(!a.ok)throw new Error("Failed to download PDF");const r=await a.blob(),m=window.URL.createObjectURL(r),c=document.createElement("a");c.href=m,c.download="kumpulan-kartu-siswa.pdf",c.click()}catch{g.error("Gagal download kartu siswa.")}},W=[{key:"profile_picture",label:"Foto",sortable:!1},{key:"full_name",label:"Nama Siswa",sortable:!0},{key:"parent.full_name",label:"Nama Orang Tua/wali",sortable:!1},{key:"classroom.name",label:"Kelas",sortable:!0},{key:"nis",label:"NIS",sortable:!0},{key:"entry_year",label:"Tahun Masuk",sortable:!0},{key:"gender",label:"Jenis Kelamin",sortable:!0},{key:"religion",label:"Agama",sortable:!0},{key:"date_of_birth",label:"Tanggal Lahir",sortable:!0},{key:"address",label:"Alamat",sortable:!1},{key:"status",label:"Status",sortable:!0},{key:"actions",label:"Aksi",sortable:!1}],X=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-red-100 text-red-800";case"graduated":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},Y=e=>{switch(e){case"active":return"Active";case"inactive":return"Inactive";case"graduated":return"Graduated";default:return e}};return t.jsxs(ne,{breadcrumbs:ce,children:[t.jsx(se,{title:"Siswa"}),t.jsx(oe,{position:"top-right",richColors:!0}),t.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",placeholder:"Cari siswa...",defaultValue:o.search||"",onChange:e=>p.get(route("students.index"),{search:e.target.value},{preserveState:!0}),className:"w-64 rounded border px-3 py-1"}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>M(!_),className:"rounded bg-gray-200 px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-300",children:["Filter Kelas ",d.length>0?`(${d.length})`:""]}),_&&t.jsxs("div",{className:"absolute top-full left-0 z-10 mt-1 w-64 rounded-md border border-gray-200 bg-white p-3 shadow-lg",children:[t.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium",children:"Filter by Kelas"}),d.length>0&&t.jsx("button",{onClick:q,className:"text-xs text-blue-600 hover:text-blue-800",children:"Clear"})]}),t.jsx("div",{className:"max-h-48 overflow-y-auto",children:j.map(e=>t.jsxs("label",{className:"flex items-center space-x-2 py-1",children:[t.jsx("input",{type:"checkbox",checked:d.includes(e.id),onChange:()=>B(e.id),className:"rounded border-gray-300"}),t.jsx("span",{className:"text-sm",children:e.name})]},e.id))})]})]}),t.jsx("button",{disabled:n.length===0,onClick:G,className:`rounded bg-indigo-600 px-3 py-1 text-sm font-medium text-white hover:bg-indigo-700 ${n.length===0?"cursor-not-allowed opacity-50":"hover:cursor-pointer"}`,children:"Ekspor data yang dipilih"}),t.jsx("button",{disabled:n.length===0,onClick:z,className:"rounded bg-indigo-700 px-3 py-1 text-sm font-medium text-white hover:bg-indigo-700 disabled:cursor-not-allowed disabled:opacity-50",children:"Bulk Print Kartu Siswa"})]}),t.jsx("button",{onClick:()=>$(null),className:"rounded bg-green-600 px-3 py-1 text-sm font-medium text-white transition hover:cursor-pointer hover:bg-green-700",children:"Tambah Siswa"})]}),t.jsx(le,{headers:W,data:h.data,sortColumn:o.sort??"",sortDirection:o.direction==="asc"||o.direction==="desc"?o.direction:"asc",onSort:V,onSelectAll:e=>k(e?h.data.map(a=>a.id):[]),selectedIds:n,rowRender:e=>{var a,r,m,c;return t.jsxs("tr",{className:"border-b",children:[t.jsx("td",{className:"w-[10px] p-3 text-sm",children:t.jsx("input",{type:"checkbox",checked:n.includes(e.id),onChange:()=>J(e.id)})}),t.jsx("td",{className:"p-3",children:t.jsx("div",{className:"flex justify-center",children:e.profile_picture?t.jsx("img",{src:`/storage/${e.profile_picture}`,alt:e.full_name,className:"h-10 w-10 rounded-full border border-gray-300 object-cover"}):t.jsx("img",{src:`https://api.dicebear.com/9.x/initials/svg?seed=${encodeURIComponent(e.full_name)}`,alt:e.full_name,className:"h-10 w-10 rounded-full border border-gray-300 object-cover"})})}),t.jsx("td",{className:"p-3 text-sm",children:e.full_name}),t.jsx("td",{className:"p-3 text-sm",children:((a=e.parent)==null?void 0:a.full_name)||"-"}),t.jsx("td",{className:"p-3 text-sm",children:((r=e.classroom)==null?void 0:r.name)||"-"}),t.jsx("td",{className:"p-3 text-sm",children:e.nis||"-"}),t.jsx("td",{className:"p-3 text-sm",children:e.entry_year}),t.jsx("td",{className:"p-3 text-sm",children:e.gender}),t.jsx("td",{className:"p-3 text-sm",children:e.religion}),t.jsxs("td",{className:"p-3 text-sm",children:[e.birth_place,", ",e.date_of_birth]}),t.jsx("td",{className:"p-3 text-sm",children:e.address?e.address.length>70?e.address.substring(0,70)+"...":e.address:"-"}),t.jsx("td",{className:"p-3 text-sm",children:t.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${X(e.status)}`,children:Y(e.status)})}),t.jsxs("td",{className:"flex justify-center gap-2 p-3",children:[t.jsx("button",{onClick:()=>$(e),className:"rounded bg-blue-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Edit"}),t.jsx(ae,{href:route("students.attendance",e.id),className:`rounded px-3 py-1 text-sm font-medium text-white ${(m=e.classroom)!=null&&m.name?"bg-sky-500 hover:cursor-pointer hover:bg-sky-600":"cursor-not-allowed bg-sky-300"}`,onClick:x=>{var s;(s=e.classroom)!=null&&s.name||x.preventDefault()},title:(c=e.classroom)!=null&&c.name?"":"Siswa harus memiliki kelas untuk melihat kehadiran",children:"Kehadiran"}),t.jsx("button",{onClick:async()=>{S(e),f(!0);const s=await(await fetch(route("student.qrcode.preview",{student:e.id}))).text();v(s),N(route("kartu-siswa",{student_id:e.id}))},className:"rounded bg-sky-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Kartu"}),t.jsx("button",{onClick:()=>b(e),className:"rounded bg-red-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Hapus"})]})]},e.id)}}),t.jsx(re,{links:h.links}),t.jsx(ie,{isOpen:R,onClose:()=>w(!1),student:E,classrooms:j,sexes:L,statuses:A,religions:K}),t.jsx(D,{isOpen:!!u,onClose:()=>b(null),title:"Confirm Deletion",message:t.jsxs("span",{children:["Are you sure you want to delete student ",t.jsx("strong",{children:u==null?void 0:u.full_name}),"?"]}),buttons:[{label:"Cancel",onClick:()=>b(null),variant:"neutral"},{label:"Delete",onClick:()=>{u&&(Q(u.id),b(null))},variant:"danger"}]}),t.jsx(D,{isOpen:U,onClose:()=>{f(!1),S(null),v(""),N("")},title:`Kartu Pelajar - ${y==null?void 0:y.full_name}`,message:t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx("div",{dangerouslySetInnerHTML:{__html:H},className:"h-[200px] w-[200px]"}),t.jsx("a",{href:I,download:!0,className:"mt-2 rounded bg-blue-600 px-4 py-2 text-sm text-white hover:bg-blue-700",children:"Download PDF"})]}),buttons:[{label:"Close",onClick:()=>f(!1),variant:"neutral"}]})]})]})}export{_e as default};
