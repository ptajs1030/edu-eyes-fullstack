import{C as A,r as m,u as E,j as e,H as D,a as B}from"./app-CyshOikY.js";import{S as H}from"./student-assignment-modal-BqWmsZpE.js";import{A as P}from"./app-layout-BzMrhGUa.js";import{t as n,T as q}from"./index-BUAJzwt7.js";/* empty css            */import"./button-CVDMPaG2.js";import"./index-CUeaCuGb.js";import"./index-BFWA2_KQ.js";import"./index-CI7l1avO.js";import"./createLucideIcon-CnvrJxFW.js";import"./app-logo-icon-Nm3oCOC7.js";const I=[{title:"Tugas",href:"/tasks"},{title:"Edit Tugas",href:""}];function Q({task:r,subjects:g,academicYears:p,classrooms:b}){const{data:s,setData:c,put:f,processing:h}=A({subject_id:r.subject_id,title:r.title,description:r.description||"",due_date:r.due_date,due_time:r.due_time,student_assignments:(r.student_assignments||[]).map(t=>({student_id:t.student_id,student_name:t.student_name,class_name:t.class_name,class_id:t.class_id,score:t.score,is_scored:t.is_scored}))}),[j,u]=m.useState(!1),[y,_]=m.useState(r.title.length),[N,v]=m.useState((r.description||"").length),{errors:i,flash:l}=E().props;m.useEffect(()=>{l!=null&&l.success&&n.success(l.success),l!=null&&l.error&&n.error(l.error),i&&Object.keys(i).length>0&&Object.values(i).forEach(t=>{n.error(t)})},[l,i]);const w=t=>{if(t.preventDefault(),!Array.isArray(s.student_assignments)||s.student_assignments.length===0){n.error("Minimal harus memilih 1 siswa untuk tugas ini");return}const a=n.loading("Memperbarui tugas...");f(`/tasks/${r.id}`,{onSuccess:()=>{n.dismiss(a)},onError:o=>{n.dismiss(a),o.student_assignments?n.error("Terjadi kesalahan pada data siswa yang dipilih"):o.title?n.error("Nama tugas tidak valid"):o.subject_id?n.error("Mata pelajaran harus dipilih"):n.error("Terjadi kesalahan validasi data")},onFinish:()=>{n.dismiss(a)}})},k=t=>{const a=t.target.value;a.length<=70&&(c("title",a),_(a.length))},S=t=>{const a=t.target.value;a.length<=70&&(c("description",a),v(a.length))},C=t=>{const a=s.student_assignments.map(d=>d.student_id),o=t.filter(d=>!a.includes(d.student_id));c("student_assignments",[...s.student_assignments,...o.map(d=>({student_id:d.student_id,student_name:d.student_name,class_name:d.class_name,class_id:d.class_id,score:d.score??null,is_scored:d.is_scored??!1}))]),u(!1),n.success(`${o.length} siswa berhasil ditambahkan`)},M=(t,a=!1)=>{a&&!window.confirm("Siswa ini sudah memiliki nilai. Menghapus siswa akan menghilangkan data nilai tersebut. Apakah Anda yakin ingin melanjutkan?")||(c("student_assignments",s.student_assignments.filter(o=>o.student_id!==t)),n.success("Siswa berhasil dihapus dari Tugas"))},x=p.find(t=>t.id===r.academic_year_id)||r.academic_year,T=s.student_assignments.filter(t=>t.is_scored).length,L=s.student_assignments.length;return e.jsxs(P,{breadcrumbs:I,children:[e.jsx(D,{title:`Edit Tugas - ${r.title}`}),e.jsx(q,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsxs("h2",{className:"mb-6 text-2xl font-semibold text-gray-900",children:["Edit Exam: ",r.title]}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Tahun Ajaran"}),e.jsx("input",{type:"text",value:(x==null?void 0:x.title)||"Loading...",disabled:!0,className:"w-full cursor-not-allowed rounded-lg border border-gray-300 bg-gray-100 px-4 py-2 text-gray-600",readOnly:!0}),e.jsx("p",{className:"mt-1 text-xs text-amber-600",children:"Tahun ajaran tidak dapat diubah setelah exam dibuat"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Mata Pelajaran *"}),e.jsxs("select",{value:s.subject_id,onChange:t=>c("subject_id",parseInt(t.target.value)),className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Pilih mata pelajaran"}),g.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),i.subject_id&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:i.subject_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Nama *"}),e.jsx("input",{type:"text",value:s.title,onChange:k,className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"Masukkan nama exam",required:!0}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["String, max 70 char (",y,"/70)"]}),i.title&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:i.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Deskripsi"}),e.jsx("input",{type:"text",value:s.description,onChange:S,className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"Deskripsi tugas..."}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["String, max 70 char (optional) (",N,"/70)"]}),i.description&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:i.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Batas Pengumpulan *"}),e.jsx("input",{type:"date",value:s.due_date,onChange:t=>c("due_date",t.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",required:!0}),i.due_date&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:i.due_date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Batas Pengumpulan (Jam)*"}),e.jsx("input",{type:"time",value:s.due_time,onChange:t=>c("due_time",t.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",required:!0}),i.due_time&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:i.due_time})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Student Assignments"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:[T," dari ",L," siswa sudah dinilai"]})]}),e.jsx("p",{className:"max-w-md text-right text-sm text-red-600",children:"⚠️ Warning: Menghapus siswa yang sudah dinilai akan menghilangkan data skor mereka!"})]}),s.student_assignments.length>0?e.jsx("div",{className:"mb-4 overflow-hidden rounded-lg border border-gray-200",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"Status Nilai"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Action"})]})}),e.jsx("tbody",{children:s.student_assignments.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.student_name,t.is_scored&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-800",children:[e.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Sudah Dinilai"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.class_name}),e.jsx("td",{className:"px-4 py-3 text-center",children:t.is_scored?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"inline-flex rounded-full bg-green-100 px-2 py-1 text-xs font-semibold text-green-800",children:"Sudah Dinilai"}),e.jsxs("span",{className:"mt-1 text-xs text-gray-600",children:["Nilai: ",t.score]})]}):e.jsx("span",{className:"inline-flex rounded-full bg-gray-100 px-2 py-1 text-xs font-semibold text-gray-800",children:"Belum Dinilai"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("button",{type:"button",onClick:()=>M(t.student_id,t.is_scored),className:"flex items-center gap-1 rounded bg-red-500 px-2 py-1 text-xs text-white hover:bg-red-600 hover:opacity-90",title:t.is_scored?"Hati-hati: Siswa ini sudah memiliki nilai!":"Hapus siswa dari exam",children:[e.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Remove"]})})]},t.student_id))})]})}):e.jsx("div",{className:"mb-4 rounded-lg border-2 border-dashed border-gray-300 p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Belum ada siswa yang di-assign ke exam ini"})}),e.jsxs("button",{type:"button",onClick:()=>u(!0),className:"flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Tambah Siswa"]})]}),e.jsxs("div",{className:"flex justify-end gap-4 border-t pt-6",children:[e.jsx("button",{type:"button",onClick:()=>B.get("/tasks"),className:"rounded-lg border border-gray-300 bg-white px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:h,className:"rounded-lg bg-blue-600 px-6 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",children:h?"Memperbarui...":"Update"})]})]})]}),e.jsx(H,{isOpen:j,onClose:()=>u(!1),onSubmit:C,classrooms:b,assignedStudentIds:s.student_assignments.map(t=>t.student_id)})]})}export{Q as default};
