import{u as O,r as x,j as e,H as P,a as f}from"./app-BF9f0RJy.js";import{C as S}from"./confirmation-modal-QdiDnaRT.js";import{A}from"./app-layout-CSv4mheD.js";import{t as j,T as B}from"./index-D5cdOoW6.js";/* empty css            */import"./proxy-CWtVx81M.js";import"./button-C168h7yY.js";import"./index-DfUL4gPf.js";import"./index-s_RueEyH.js";import"./index-BoFCgx6G.js";import"./createLucideIcon-Gzk0VVng.js";import"./app-logo-icon-CD7_nrNB.js";const E=p=>[{title:"Tagihan",href:"/payments"},{title:p}];function G({transaction:p,payment:a}){const{flash:i}=O().props,[c,y]=x.useState({}),[k,u]=x.useState(!1),[C,h]=x.useState(!1);i!=null&&i.success&&j.success(i.success),i!=null&&i.error&&j.error(i.error);const w=p.filter(s=>s.student!==null),N=a.assignments.map(s=>{const t=s.student,n=w.find(r=>r.student&&r.student.id===t.id);return{student:t,transaction:n||{id:0,student:t,payment:a,payment_date:null}}}),[g,b]=x.useState(!1),T=()=>{var t;u(!1),b(!0);const s=Object.entries(c).map(([n,r])=>({id:Number(n),status:r}));f.patch(route("payments.updateTransactions",a.id),{transaction_ids:s.map(n=>n.id),status:(t=s[0])==null?void 0:t.status},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{y({})},onError:()=>b(!1),onFinish:()=>b(!1)})},D=()=>{h(!1),f.visit(route("payments.index"))},L=()=>{const s=["Nama","NIS","Kelas","Tanggal Pembayaran","Status"],t=N.map(({student:o,transaction:m})=>{var v;const _=m.payment_date?"Lunas":"Belum Lunas";return[o.full_name,o.nis||"-",((v=o.classroom)==null?void 0:v.name)||"-",m.payment_date||"-",_]}),n=[s,...t].map(o=>o.map(m=>`"${m}"`).join(",")).join(`
`),r=new Blob([n],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(r),l=document.createElement("a");l.href=d,l.setAttribute("download",`payment_${a.id}.csv`),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(d),j.success("Data berhasil diekspor ke CSV!")};return e.jsxs(A,{breadcrumbs:E(a.title),children:[e.jsx(P,{title:`Detail Tagihan - ${a.title}`}),e.jsx(B,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h1",{className:"mb-4 text-2xl font-bold",children:a.title}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Tenggat Pembayaran"}),e.jsx("p",{className:"mt-1",children:new Date(a.due_date).toLocaleDateString("id-ID")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Nominal"}),e.jsxs("p",{className:"mt-1",children:["Rp ",a.nominal.toLocaleString("id-ID")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Deskripsi"}),e.jsx("p",{className:"mt-1",children:a.description||"-"})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Daftar Tagihan"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",a.assignments.length," peserta"]}),e.jsx("button",{onClick:L,className:"rounded bg-green-500 px-3 py-1 text-sm font-medium text-white hover:bg-green-600",children:"Ekspor CSV"})]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tanggal Pembayaran"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:N.map(({student:s,transaction:t})=>{var l;const n=t.payment_date?"lunas":"belum",r=c[t.id],d=r??n;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:s.full_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:s.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:((l=s.classroom)==null?void 0:l.name)||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.payment_date||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("select",{value:d,onChange:o=>y({...c,[t.id]:o.target.value}),className:`rounded border px-2 py-1 text-sm ${d==="lunas"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("option",{value:"belum",children:"Belum Lunas"}),e.jsx("option",{value:"lunas",children:"Lunas"})]}),r&&r!==n&&e.jsx("span",{className:"mt-1 text-xs text-orange-600",children:"Perubahan belum disimpan"})]})})]},s.id)})})]}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[Object.keys(c).length>0&&e.jsx("button",{disabled:g,onClick:()=>u(!0),className:`rounded px-4 py-2 text-white ${g?"bg-gray-400":"bg-blue-500 hover:bg-blue-600"}`,children:g?"Menyimpan...":"Simpan Perubahan"}),e.jsx("button",{onClick:()=>{Object.keys(c).length>0?h(!0):f.visit(route("payments.index"))},className:"rounded bg-gray-200 px-4 py-2 text-sm font-medium text-gray-800 hover:bg-gray-300",children:"Kembali ke Daftar"})]})]})]})]}),e.jsx(S,{isOpen:k,title:"Konfirmasi Simpan",message:"Apakah Anda yakin ingin menyimpan perubahan ini?",onConfirm:T,onCancel:()=>u(!1)}),e.jsx(S,{isOpen:C,title:"Konfirmasi Kembali",message:"Ada perubahan yang belum disimpan. Yakin mau kembali ke daftar?",onConfirm:D,onCancel:()=>h(!1)})]})}export{G as default};
