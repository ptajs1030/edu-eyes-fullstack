import{r as d,u as A,j as e,H as D,L as q,a as G}from"./app-ECl7PNEZ.js";import{A as H}from"./app-layout-B2BG3xTd.js";import{t as x,T as K}from"./index-DuXsyNjS.js";/* empty css            */import"./button-BcjioZaA.js";import"./index-CdcOExhn.js";import"./index-BqkEATxV.js";import"./index-Di_juwC2.js";import"./createLucideIcon-BCx9m3V0.js";import"./app-logo-icon-QNZacgtM.js";const R=n=>[{title:"Tagihan",href:"/payments"},{title:n?"Edit Tagihan":"Buat Tagihan Baru"}];function se({academicYears:n,classrooms:N,payment:t,selectedStudents:_=[]}){var S,k;const m=n.find(s=>s.status==="active"),[i,h]=d.useState({title:(t==null?void 0:t.title)||"",nominal:t==null?void 0:t.nominal,due_date:(t==null?void 0:t.due_date)||"",academic_year_id:(t==null?void 0:t.academic_year_id)||(m==null?void 0:m.id)||"",description:(t==null?void 0:t.description)||"",student_assignments:(t==null?void 0:t.student_assignments)||[]}),[u,C]=d.useState(null),[c,g]=d.useState([]),[V,M]=d.useState((t==null?void 0:t.nominal)||null),[P,U]=d.useState((t==null?void 0:t.academic_year_id)||((S=n[0])==null?void 0:S.id)||0);n.find(s=>s.id===P);const[o,b]=d.useState(_),[v,f]=d.useState([]),[T,p]=d.useState(!1),{flash:l}=A().props;d.useEffect(()=>{l!=null&&l.success&&x.success(l.success),l!=null&&l.error&&x.error(l.error)},[l]),d.useEffect(()=>{u&&y(u)},[u]),d.useEffect(()=>{o.length>0?E(o):f([])},[o]);const y=async s=>{p(!0);try{const a=await fetch(route("students.by-class",s));if(!a.ok)throw new Error("Failed to fetch students");const r=await a.json();g(r)}catch{x.error("Gagal memuat data siswa"),g([])}finally{p(!1)}},E=async s=>{try{const a=await fetch(route("students.get-by-ids",{ids:s.join(",")}));if(!a.ok)throw new Error("Failed to fetch student info");const r=await a.json();f(r)}catch{x.error("Gagal memuat data siswa terpilih"),f([])}},B=s=>{C(s),g([])},w=s=>{b(a=>a.includes(s)?a.filter(r=>r!==s):[...a,s])},I=s=>{if(s){const a=c.map(r=>r.id);b(a)}else{const a=c.map(r=>r.id);b(r=>r.filter(j=>!a.includes(j)))}},F=s=>{if(s.preventDefault(),o.length===0){x.error("Pilih minimal 1 peserta");return}const a=t!=null&&t.id?`/payments/${t.id}`:"/payments/",r=t!=null&&t.id?"put":"post";G[r](a,{...i,student_ids:o},{onSuccess:()=>{},onError:()=>{}})},L=c.length>0&&c.every(s=>o.includes(s.id));return e.jsxs(H,{breadcrumbs:R(!!(t!=null&&t.id)),children:[e.jsx(D,{title:t!=null&&t.id?"Edit Pembayaran":"Buat Pembayaran Baru"}),e.jsx(K,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t!=null&&t.id?"Edit Pembayaran":"Buat Pembayaran Baru"}),e.jsxs("form",{onSubmit:F,className:"flex flex-col gap-6",children:[e.jsx("div",{className:"rounded-lg border p-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Nama Tagihan*"}),e.jsx("input",{id:"title",type:"text",maxLength:70,value:i.title,onChange:s=>h({...i,title:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"academic_year_id",className:"mb-2 block text-sm font-medium text-gray-700",children:"Tahun Ajaran*"}),e.jsx("input",{type:"text",id:"academic_year_id",value:((k=n.find(s=>s.id===i.academic_year_id))==null?void 0:k.title)||"",disabled:!0,className:"w-full rounded-lg border border-gray-300 bg-gray-100 px-4 py-2 text-gray-600"}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Tahun ajaran otomatis dipilih dari yang ",e.jsx("span",{className:"font-medium",children:"aktif"}),"."]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"due_date",className:"block text-sm font-medium text-gray-700",children:"Batas Waktu*"}),e.jsx("input",{id:"due_date",type:"date",value:i.due_date,onChange:s=>h({...i,due_date:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nominal",className:"block text-sm font-medium text-gray-700",children:"Nominal*"}),e.jsx("input",{id:"nominal",type:"text",inputMode:"numeric",value:i.nominal?i.nominal.toLocaleString("id-ID"):"",onChange:s=>{const a=s.target.value.replace(/\D/g,""),r=a?parseInt(a,10):0;h({...i,nominal:r})},className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Gunakan angka saja, otomatis diformat dengan pemisah ribuan"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Deskripsi"}),e.jsx("textarea",{id:"description",value:i.description,onChange:s=>h({...i,description:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",rows:4})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Pilih Peserta"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Kelas"}),e.jsxs("select",{value:u||"",onChange:s=>B(Number(s.target.value)),className:"w-full rounded border p-2",children:[e.jsx("option",{value:"",children:"Pilih Kelas"}),N.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),T?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-blue-500 border-t-transparent"})}):c.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[c.length," siswa ditemukan"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:s=>I(s.target.checked),className:"rounded border-gray-300 text-indigo-600 hover:cursor-pointer"}),"Pilih Semua"]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto rounded-lg border",children:e.jsx("div",{className:"divide-y divide-gray-200",children:c.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.full_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["NIS: ",s.nis||"-"]})]}),e.jsx("input",{type:"checkbox",checked:o.includes(s.id),onChange:()=>w(s.id),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 hover:cursor-pointer"})]},s.id))})})]}):e.jsx("div",{className:"rounded-lg border bg-gray-50 p-6 text-center",children:e.jsx("div",{className:"text-gray-400",children:u?"Tidak ada siswa di kelas ini":"Pilih kelas untuk melihat siswa"})})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("h2",{className:"mb-4 text-lg font-semibold",children:["Peserta Terpilih (",o.length,")"]}),v.length>0?e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"max-h-96 divide-y divide-gray-200 overflow-y-auto rounded-lg border border-gray-200",children:v.map(s=>{var a,r;return e.jsxs("div",{className:"flex items-center justify-between bg-white p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.full_name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsx("span",{children:((a=N.find(j=>j.id===s.class_id))==null?void 0:a.name)||((r=s.classroom)==null?void 0:r.name)||"-"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["NIS: ",s.nis||"-"]})]})]}),e.jsx("button",{type:"button",onClick:()=>w(s.id),className:"text-red-500 hover:cursor-pointer hover:text-red-700",children:"✕"})]},s.id)})})}):e.jsx("div",{className:"rounded-lg border bg-gray-50 p-6 text-center",children:e.jsx("div",{className:"text-gray-400",children:"Belum ada peserta terpilih"})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(q,{href:route("events.index"),className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"submit",className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:cursor-pointer hover:bg-blue-700",children:t!=null&&t.id?"Update":"Simpan"})]})]})]})]})}export{se as default};
