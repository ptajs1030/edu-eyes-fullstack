import{r,c as q,j as e,u as G,H as J,L as M,a as V}from"./app-Cy_yH0cU.js";import{R as H}from"./rich-text-editor-CDEGZclh.js";import{A as z}from"./app-layout-Z_0Lpuly.js";import{t as k,T as U}from"./index-BBS2l-Ku.js";/* empty css            */import"./button-Bs7TbKwX.js";import"./index-BZR7NyXe.js";import"./index-CXWTTp-_.js";import"./index-6lxvuY0S.js";import"./createLucideIcon-Cy4IV-AB.js";import"./app-logo-icon-DPckmXBf.js";function W({value:o,onChange:_,placeholder:t="Search...",endpoint:N,options:l,initialOptions:x=[],showInitialOptions:u=!1,maxInitialOptions:K=10}){const[m,v]=r.useState(""),[g,p]=r.useState(!1),[h,w]=r.useState(!1),[j,y]=r.useState(x),[L,P]=r.useState(x),c=r.useRef(null),S=r.useRef(null),C=r.useRef(null),T=l&&l.length>0?l:L,I=j.filter(a=>a&&a.name&&typeof a.name=="string"&&a.name.toLowerCase().includes(m.toLowerCase())&&!o.includes(a.id)),E=T.filter(a=>o.includes(a.id));r.useEffect(()=>{const a=d=>{c.current&&!c.current.contains(d.target)&&p(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),r.useEffect(()=>{u&&N&&j.length===0&&f("")},[u,N,j.length]);const f=async a=>{if(N){w(!0);try{const d=await q.get(N,{params:{query:a},withCredentials:!0}),D=(Array.isArray(d.data)?d.data:[]).map(b=>({id:b.id||"",name:b.name||b.full_name||""})).filter(b=>b.id&&b.name).slice(0,K);y(D),P(b=>{const B=[...b];return D.forEach(R=>{B.some(A=>A.id===R.id)||B.push(R)}),B}),p(!0)}catch(d){console.error("Error fetching options:",d),y([])}finally{w(!1)}}},F=a=>{const d=a.target.value;if(v(d),C.current&&clearTimeout(C.current),u&&d===""){f("");return}C.current=setTimeout(()=>{d.length>=1||u&&d.length===0?f(d):(y([]),p(!1))},300)},O=a=>{!a||!a.id||(_([...o,a.id]),v(""),p(!1),S.current&&S.current.focus())},s=a=>{_(o.filter(d=>d!==a))},i=()=>{u&&j.length===0&&f(""),p(!0)},n=a=>{if(a.key==="Enter"){a.preventDefault(),m.trim()!==""?f(m):u&&f("");return}a.key==="Backspace"&&m===""&&o.length>0&&s(o[o.length-1])};return e.jsxs("div",{className:"relative",ref:c,children:[e.jsxs("div",{className:"flex flex-wrap mt-1 items-center gap-1 border p-2 border-gray-300 rounded-md shadow-sm bg-white cursor-text",onClick:()=>{var a;return(a=S.current)==null?void 0:a.focus()},children:[E.map(a=>a&&e.jsxs("span",{className:"inline-flex items-center rounded bg-blue-100 px-2 py-1 text-xs font-medium text-blue-800",children:[a.name,e.jsx("button",{type:"button",onClick:d=>{d.stopPropagation(),s(a.id)},className:"ml-1 text-blue-600 hover:text-blue-800 hover:cursor-pointer",children:"×"})]},a.id)),e.jsx("input",{ref:S,type:"text",value:m,onChange:F,onFocus:i,onKeyDown:n,placeholder:E.length===0?t:"",className:"flex-1 min-w-[120px] outline-none bg-transparent",style:{minWidth:"120px"}})]}),g&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md border max-h-60 overflow-auto",children:h?e.jsx("div",{className:"py-2 px-3 text-gray-500",children:"Loading..."}):I.length===0?e.jsx("div",{className:"py-2 px-3 text-gray-500",children:"Tidak ditemukan"}):I.map(a=>a&&e.jsx("div",{onClick:()=>O(a),className:"px-3 py-2 hover:bg-gray-100 cursor-pointer",children:a.name},a.id))})]})}const $=o=>[{title:"Kegiatan",href:"/events"},{title:o?"Edit Kegiatan":"Buat Kegiatan Baru"}];function ce({teachers:o,classrooms:_,event:t,selectedStudents:N=[]}){const[l,x]=r.useState({name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||"",start_date:(t==null?void 0:t.start_date)||"",end_date:(t==null?void 0:t.end_date)||"",start_hour:(t==null?void 0:t.start_hour)||"",end_hour:(t==null?void 0:t.end_hour)||""}),[u,K]=r.useState(t!=null&&t.pics?t.pics.map(s=>s.user.id):[]),[m,v]=r.useState(null),[g,p]=r.useState([]),[h,w]=r.useState(N),[j,y]=r.useState([]),[L,P]=r.useState(!1),{flash:c}=G().props;r.useEffect(()=>{c!=null&&c.success&&k.success(c.success),c!=null&&c.error&&k.error(c.error)},[c]);const S=o.map(s=>({id:s.id,name:s.full_name}));r.useEffect(()=>{m&&C(m)},[m]),r.useEffect(()=>{h.length>0?T(h):y([])},[h]);const C=async s=>{P(!0);try{const i=await fetch(route("students.by-class",s));if(!i.ok)throw new Error("Gagal memuat data siswa");const n=await i.json();p(n)}catch{k.error("Gagal memuat data siswa"),p([])}finally{P(!1)}},T=async s=>{try{const i=await fetch(route("students.get-by-ids",{ids:s.join(",")}));if(!i.ok)throw new Error("Gagal memuat data siswa terpilih");const n=await i.json();y(n)}catch{k.error("Gagal memuat data siswa terpilih"),y([])}},I=s=>{v(s),p([])},E=s=>{w(i=>i.includes(s)?i.filter(n=>n!==s):[...i,s])},f=s=>{const i=g.map(n=>n.id);w(s?n=>{const a=[...n];return i.forEach(d=>{a.includes(d)||a.push(d)}),a}:n=>n.filter(a=>!i.includes(a)))},F=s=>{if(s.preventDefault(),h.length===0){k.error("Pilih minimal 1 peserta");return}if(u.length===0){k.error("Pilih minimal 1 PIC");return}const i=t!=null&&t.id?`/events/${t.id}`:"/events",n=t!=null&&t.id?"put":"post";V[n](i,{...l,pics:u.map(a=>({id:a})),selected_students:h},{onSuccess:()=>{},onError:()=>{}})},O=g.length>0&&g.every(s=>h.includes(s.id));return e.jsxs(z,{breadcrumbs:$(!!(t!=null&&t.id)),children:[e.jsx(J,{title:t!=null&&t.id?"Edit Kegiatan":"Buat Kegiatan Baru"}),e.jsx(U,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t!=null&&t.id?"Edit Kegiatan":"Buat Kegiatan Baru"}),e.jsxs("form",{onSubmit:F,className:"flex flex-col gap-6",children:[e.jsx("div",{className:"rounded-lg border p-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:["Nama Kegiatan ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"name",type:"text",placeholder:"Nama kegiatan",maxLength:70,value:l.name,onChange:s=>x({...l,name:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{className:"",children:[e.jsxs("label",{htmlFor:"pics",className:"block text-sm font-medium text-gray-700",children:["PIC (Penanggung Jawab) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(W,{value:u,onChange:K,placeholder:"Cari guru...",endpoint:route("teachers.search"),initialOptions:S,showInitialOptions:!0,maxInitialOptions:10})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"start_hour",className:"block text-sm font-medium text-gray-700",children:["Jam Mulai ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"time",id:"start_hour",value:l.start_hour,onChange:s=>x({...l,start_hour:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"end_hour",className:"block text-sm font-medium text-gray-700",children:["Jam Selesai ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"time",id:"end_hour",value:l.end_hour,min:l.start_hour,onChange:s=>x({...l,end_hour:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"start_date",className:"block text-sm font-medium text-gray-700",children:["Tanggal Mulai ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"start_date",type:"date",value:l.start_date,min:new Date().toISOString().split("T")[0],onChange:s=>x({...l,start_date:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"end_date",className:"block text-sm font-medium text-gray-700",children:["Tanggal Selesai ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"end_date",type:"date",value:l.end_date,min:l.start_date,onChange:s=>x({...l,end_date:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:["Deskripsi ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(H,{value:l.description,onChange:s=>x({...l,description:s}),placeholder:"Ketik deskripsi kegiatan di sini..."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Pilih Peserta"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Kelas"}),e.jsxs("select",{value:m||"",onChange:s=>I(Number(s.target.value)),className:"w-full rounded border p-2",children:[e.jsx("option",{value:"",children:"Pilih Kelas"}),_.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),L?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-blue-500 border-t-transparent"})}):g.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[g.length," siswa ditemukan"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:s=>f(s.target.checked),className:"rounded border-gray-300 text-indigo-600 hover:cursor-pointer"}),"Pilih Semua"]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto rounded-lg border",children:e.jsx("div",{className:"divide-y divide-gray-200",children:g.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.full_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["NIS: ",s.nis||"-"]})]}),e.jsx("input",{type:"checkbox",checked:h.includes(s.id),onChange:()=>E(s.id),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 hover:cursor-pointer"})]},s.id))})})]}):e.jsx("div",{className:"rounded-lg border bg-gray-50 p-6 text-center",children:e.jsx("div",{className:"text-gray-400",children:m?"Tidak ada siswa di kelas ini":"Pilih kelas untuk melihat siswa"})})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("h2",{className:"mb-4 text-lg font-semibold",children:["Peserta Terpilih (",h.length,")"]}),j.length>0?e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"max-h-96 divide-y divide-gray-200 overflow-y-auto rounded-lg border border-gray-200",children:j.map(s=>{var i,n;return e.jsxs("div",{className:"flex items-center justify-between bg-white p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.full_name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsx("span",{children:((i=_.find(a=>a.id===s.class_id))==null?void 0:i.name)||((n=s.classroom)==null?void 0:n.name)||"-"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["NIS: ",s.nis||"-"]})]})]}),e.jsx("button",{type:"button",onClick:()=>E(s.id),className:"text-red-500 hover:cursor-pointer hover:text-red-700",children:"✕"})]},s.id)})})}):e.jsx("div",{className:"rounded-lg border bg-gray-50 p-6 text-center",children:e.jsx("div",{className:"text-gray-400",children:"Belum ada peserta terpilih"})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(M,{href:route("events.index"),className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"submit",className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:cursor-pointer hover:bg-blue-700",children:t!=null&&t.id?"Ubah":"Simpan"})]})]})]})]})}export{ce as default};
