import{u as J,r as m,j as e,H as W,a as f,L as q}from"./app-Deq4L0pn.js";import{P as z}from"./pagination-DgppRJaU.js";import{A as G}from"./app-layout-QeWFFrQP.js";import{t as N,T as Q}from"./index-0Nxa6yz1.js";import X from"./editAttendance-VTq5gNjh.js";/* empty css            */import"./button-DgCTJlug.js";import"./index-ExPVSQ8Q.js";import"./index-Cp7H5p_2.js";import"./index-Dcxvdc3r.js";import"./createLucideIcon-CZxVVz0J.js";import"./app-logo-icon-B14am6Jj.js";import"./form-modal-C94M-Siy.js";import"./proxy-BPF-jza7.js";const Y=a=>[{title:"Kegiatan",href:"/events"},{title:a}];function me({event:a,attendances:c,canEditAttendance:S,filters:g}){const{flash:o}=J().props,[C,k]=m.useState(null),r=g.dates??[],[M,w]=m.useState(!1),[L,v]=m.useState(!1),[p,j]=m.useState([]),_=m.useRef(null),h=typeof(g==null?void 0:g.limit)<"u"?g.limit:10;m.useEffect(()=>{j([])},[r,h]);const A=()=>{if(p.length===0)return;const t=c.data.filter(l=>p.includes(l.id)),s={};t.forEach(l=>{s[l.submit_date]||(s[l.submit_date]=[]),s[l.submit_date].push(l)});const x=Object.keys(s).sort((l,u)=>new Date(l).getTime()-new Date(u).getTime()),n=["Tanggal","Nama","NIS","Kelas","Status","Jam Masuk","Jam Keluar","Keterlambatan","Catatan"],i=l=>{const u=String(l??"");return u.includes(",")||u.includes('"')||u.includes(`
`)?'"'+u.replace(/"/g,'""')+'"':u};let D=[];D.push(n.map(i).join(",")),x.forEach(l=>{s[l].forEach((d,U)=>{var I;const V=new Date(d.submit_date).toLocaleDateString("id-ID");D.push([U===0?i(V):"",i(d.student.full_name),i(d.student.nis||"-"),i(((I=d.student.classroom)==null?void 0:I.name)||"-"),i(E(d.status)),i(d.clock_in_hour||"-"),i(d.clock_out_hour||"-"),i(d.minutes_of_late!==null?`${d.minutes_of_late} Menit`:"-"),i(d.note||"-")].join(","))})});const B=D.join(`\r
`),P=new Blob([B],{type:"text/csv;charset=utf-8;"}),T=URL.createObjectURL(P),b=document.createElement("a");b.href=T,b.setAttribute("download",`attendance_event_${a.id}.csv`),document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(T),N.success("Data berhasil diekspor ke CSV!")},K=t=>{j(t?c.data.map(s=>s.id):[])},R=t=>{j(s=>s.includes(t)?s.filter(x=>x!==t):[...s,t])};o!=null&&o.success?N.success(o.success):o!=null&&o.error&&N.error(o.error);const y=m.useMemo(()=>{const t=[],s=new Date(a.start_date),x=new Date(a.end_date);for(let n=new Date(s);n<=x;n.setDate(n.getDate()+1))t.push(n.toISOString().split("T")[0]);return t},[a.start_date,a.end_date]),O=()=>{let t;r.length===y.length?t=[]:t=[...y];const s={dates:t,limit:h,page:1};f.get(route("events.attendance",a.id),s,{preserveState:!0})},$=t=>{let s;r.includes(t)?s=r.filter(n=>n!==t):s=[...r,t];const x={dates:s,limit:h,page:1};f.get(route("events.attendance",a.id),x,{preserveState:!0})},F=t=>{f.patch(route("events.attendance.update",a.id),t,{preserveScroll:!0,onSuccess:()=>{N.success("Kehadiran berhasil diperbarui"),w(!1),k(null)}})},H=t=>{switch(t){case"present":return"bg-green-100 text-green-800 border-green-200";case"present_in_tolerance":return"bg-blue-100 text-blue-800 border-blue-200";case"late":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"alpha":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},E=t=>{switch(console.log({status:t}),t){case"present":return"Hadir";case"present_in_tolerance":return"Hadir (Toleransi)";case"late":return"Terlambat";case"alpha":return"Tidak Masuk";default:return"Belum Diisi"}};return m.useEffect(()=>{const t=s=>{_.current&&!_.current.contains(s.target)&&v(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]),e.jsxs(G,{breadcrumbs:Y(a.name),children:[e.jsx(W,{title:`Detail Event - ${a.name}`}),e.jsx(Q,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h1",{className:"mb-4 text-2xl font-bold",children:a.name}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Tanggal"}),e.jsxs("p",{className:"mt-1",children:[new Date(a.start_date).toLocaleDateString("id-ID")," - ",new Date(a.end_date).toLocaleDateString("id-ID")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Waktu"}),e.jsxs("p",{className:"mt-1",children:[a.start_hour," - ",a.end_hour]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"PIC"}),e.jsx("p",{className:"mt-1",children:a.event_pics.map(t=>t.user.full_name).join(", ")||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Deskripsi"}),e.jsx("p",{className:"mt-1",children:a.description||"-"})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-3 justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Daftar Kehadiran"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("select",{value:h,onChange:t=>{const s=t.target.value,n={limit:s==="all"?"all":Number(s),page:1};r.length>0&&(n.dates=r),f.get(route("events.attendance",a.id),n,{preserveState:!0})},className:"rounded-lg border border-gray-300 px-3 py-1 text-sm text-gray-700 bg-white",children:[e.jsx("option",{value:10,children:"Show 10 data"}),e.jsx("option",{value:20,children:"Show 20 data"}),e.jsx("option",{value:"all",children:"Show All"})]}),e.jsx("button",{onClick:A,disabled:p.length===0,className:`rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700 ${p.length===0?"opacity-50 cursor-not-allowed":""}`,children:"Ekspor CSV"}),e.jsxs("div",{className:"relative",ref:_,children:[e.jsxs("button",{onClick:()=>v(!L),className:"flex items-center gap-2 rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filter Tanggal",r.length>0&&e.jsx("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-blue-800 text-xs",children:r.length})]}),L&&e.jsxs("div",{className:"absolute top-full right-0 z-10 mt-2 w-80 rounded-lg border border-gray-200 bg-white p-4 shadow-lg",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Filter Berdasarkan Tanggal"}),e.jsx("button",{onClick:()=>v(!1),className:"text-gray-400 hover:cursor-pointer hover:text-gray-600",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:r.length===y.length,onChange:O,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Pilih Semua Tanggal"})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto border-t border-gray-200 pt-3",children:y.map(t=>e.jsxs("label",{className:"flex items-center space-x-2 py-1",children:[e.jsx("input",{type:"checkbox",checked:r.includes(t),onChange:()=>$(t),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:new Date(t).toLocaleDateString("id-ID",{weekday:"short",year:"numeric",month:"short",day:"numeric"})})]},t))}),e.jsxs("div",{className:"flex justify-between border-t border-gray-200 pt-3",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[r.length," tanggal dipilih"]}),e.jsx("button",{onClick:()=>{const t={dates:[],limit:h,page:1};f.get(route("events.attendance",a.id),t,{preserveState:!0})},className:"text-sm text-blue-600 hover:cursor-pointer hover:text-blue-800",children:"Reset Filter"})]})]})]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.length===c.data.length&&c.data.length>0,onChange:t=>K(t.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tanggal"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Jam Masuk"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Jam Keluar"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Keterlambatan"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Catatan"}),S&&e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:c.data.map(t=>{var s;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.includes(t.id),onChange:()=>R(t.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:new Date(t.submit_date).toLocaleDateString("id-ID")}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.student.full_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.student.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:((s=t.student.classroom)==null?void 0:s.name)||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`inline-block rounded px-2 py-1 text-xs font-semibold ${H(t.status)}`,children:E(t.status)})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.clock_in_hour||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.clock_out_hour||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.minutes_of_late!==null?`${t.minutes_of_late} Menit`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.note||"-"}),S&&e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{className:"rounded bg-blue-500 px-3 py-1 text-sm font-medium text-white hover:bg-blue-600",onClick:()=>{k(t),w(!0)},children:"Edit"})})]},`${t.submit_date}-${t.student.id}`)})})]})}),e.jsx("div",{className:"mt-4",children:c.links&&c.links.length>0?e.jsx(z,{links:c.links,dates:r,limit:h}):e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{disabled:!0,className:"rounded px-3 py-1 text-sm bg-gray-100 text-black",dangerouslySetInnerHTML:{__html:"&laquo;"}}),e.jsx("button",{className:"rounded px-3 py-1 text-sm bg-blue-500 text-white font-bold",children:"1"}),e.jsx("button",{disabled:!0,className:"rounded px-3 py-1 text-sm bg-gray-100 text-black",dangerouslySetInnerHTML:{__html:"&raquo;"}})]})}),c.data.length===0&&e.jsx("div",{className:"mt-4 text-center text-gray-500",children:"Tidak ada data kehadiran untuk tanggal yang dipilih"})]}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx(q,{href:route("events.index"),className:"rounded-md bg-gray-200 px-4 py-2 text-sm font-medium text-gray-800 hover:bg-gray-300",children:"Kembali ke Daftar Event"})})]}),M&&C&&e.jsx(X,{attendance:C,onClose:()=>{w(!1),k(null)},onSubmit:F})]})}export{me as default};
