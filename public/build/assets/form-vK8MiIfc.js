import{r as d,u as D,j as e,H as F,L as G,a as q}from"./app-O-2u72Mi.js";import{A as H}from"./app-layout-Dhxy3x32.js";import{t as h,T as K}from"./index-prrS81Tn.js";/* empty css            */import"./button-CPyHwaaF.js";import"./index-CKgTjTqk.js";import"./index-DWnYtUfi.js";import"./index-BKUKOoe2.js";import"./createLucideIcon-in3-qpkb.js";import"./app-logo-icon-dbdnfOc2.js";const R=n=>[{title:"Tagihan",href:"/payments"},{title:n?"Edit Tagihan":"Buat Tagihan Baru"}];function se({academicYears:n,classrooms:N,payment:a,selectedStudents:_=[]}){var S,k;const m=n.find(s=>s.status==="active"),[i,x]=d.useState({title:(a==null?void 0:a.title)||"",nominal:a==null?void 0:a.nominal,due_date:(a==null?void 0:a.due_date)||"",academic_year_id:(a==null?void 0:a.academic_year_id)||(m==null?void 0:m.id)||"",description:(a==null?void 0:a.description)||"",student_assignments:(a==null?void 0:a.student_assignments)||[]}),[u,T]=d.useState(null),[c,g]=d.useState([]),[V,M]=d.useState((a==null?void 0:a.nominal)||null),[C,U]=d.useState((a==null?void 0:a.academic_year_id)||((S=n[0])==null?void 0:S.id)||0);n.find(s=>s.id===C);const[o,b]=d.useState(_),[v,f]=d.useState([]),[E,p]=d.useState(!1),{flash:l}=D().props;d.useEffect(()=>{l!=null&&l.success&&h.success(l.success),l!=null&&l.error&&h.error(l.error)},[l]),d.useEffect(()=>{u&&B(u)},[u]),d.useEffect(()=>{o.length>0?I(o):f([])},[o]);const B=async s=>{p(!0);try{const t=await fetch(route("students.by-class",s));if(!t.ok)throw new Error("Gagal memuat data siswa");const r=await t.json();g(r)}catch{h.error("Gagal memuat data siswa"),g([])}finally{p(!1)}},I=async s=>{try{const t=await fetch(route("students.get-by-ids",{ids:s.join(",")}));if(!t.ok)throw new Error("Gagal memuat data siswa terpilih");const r=await t.json();f(r)}catch{h.error("Gagal memuat data siswa terpilih"),f([])}},y=s=>{T(s),g([])},w=s=>{b(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])},P=s=>{if(s){const t=c.map(r=>r.id);b(r=>Array.from(new Set([...r,...t])))}else{const t=c.map(r=>r.id);b(r=>r.filter(j=>!t.includes(j)))}},A=s=>{if(s.preventDefault(),o.length===0){h.error("Pilih minimal 1 peserta");return}const t=a!=null&&a.id?`/payments/${a.id}`:"/payments",r=a!=null&&a.id?"put":"post";q[r](t,{...i,student_ids:o},{onSuccess:()=>{},onError:()=>{}})},L=c.length>0&&c.every(s=>o.includes(s.id));return e.jsxs(H,{breadcrumbs:R(!!(a!=null&&a.id)),children:[e.jsx(F,{title:a!=null&&a.id?"Edit Tagihan":"Buat Tagihan Baru"}),e.jsx(K,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[e.jsx("h1",{className:"text-2xl font-bold",children:a!=null&&a.id?"Edit Tagihan":"Buat Tagihan Baru"}),e.jsxs("form",{onSubmit:A,className:"flex flex-col gap-6",children:[e.jsx("div",{className:"rounded-lg border p-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Nama Tagihan*"}),e.jsx("input",{id:"title",type:"text",maxLength:70,value:i.title,onChange:s=>x({...i,title:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"academic_year_id",className:"mb-2 block text-sm font-medium text-gray-700",children:"Tahun Ajaran*"}),e.jsx("input",{type:"text",id:"academic_year_id",value:((k=n.find(s=>s.id===i.academic_year_id))==null?void 0:k.title)||"",disabled:!0,className:"w-full rounded-lg border border-gray-300 bg-gray-100 px-4 py-2 text-gray-600"}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Tahun ajaran otomatis dipilih dari yang ",e.jsx("span",{className:"font-medium",children:"aktif"}),"."]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"due_date",className:"block text-sm font-medium text-gray-700",children:"Batas Waktu*"}),e.jsx("input",{id:"due_date",type:"date",value:i.due_date,onChange:s=>x({...i,due_date:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nominal",className:"block text-sm font-medium text-gray-700",children:"Nominal*"}),e.jsx("input",{id:"nominal",type:"text",inputMode:"numeric",value:i.nominal?i.nominal.toLocaleString("id-ID"):"",onChange:s=>{const t=s.target.value.replace(/\D/g,""),r=t?parseInt(t,10):0;x({...i,nominal:r})},className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Gunakan angka saja, otomatis diformat dengan pemisah ribuan"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Deskripsi"}),e.jsx("textarea",{id:"description",value:i.description,onChange:s=>x({...i,description:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",rows:4})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Pilih Peserta"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Kelas"}),e.jsxs("select",{value:u||"",onChange:s=>y(Number(s.target.value)),className:"w-full rounded border p-2",children:[e.jsx("option",{value:"",children:"Pilih Kelas"}),N.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),E?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-blue-500 border-t-transparent"})}):c.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[c.length," siswa ditemukan"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:s=>P(s.target.checked),className:"rounded border-gray-300 text-indigo-600 hover:cursor-pointer"}),"Pilih Semua"]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto rounded-lg border",children:e.jsx("div",{className:"divide-y divide-gray-200",children:c.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.full_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["NIS: ",s.nis||"-"]})]}),e.jsx("input",{type:"checkbox",checked:o.includes(s.id),onChange:()=>w(s.id),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 hover:cursor-pointer"})]},s.id))})})]}):e.jsx("div",{className:"rounded-lg border bg-gray-50 p-6 text-center",children:e.jsx("div",{className:"text-gray-400",children:u?"Tidak ada siswa di kelas ini":"Pilih kelas untuk melihat siswa"})})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("h2",{className:"mb-4 text-lg font-semibold",children:["Peserta Terpilih (",o.length,")"]}),v.length>0?e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"max-h-96 divide-y divide-gray-200 overflow-y-auto rounded-lg border border-gray-200",children:v.map(s=>{var t,r;return e.jsxs("div",{className:"flex items-center justify-between bg-white p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.full_name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsx("span",{children:((t=N.find(j=>j.id===s.class_id))==null?void 0:t.name)||((r=s.classroom)==null?void 0:r.name)||"-"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["NIS: ",s.nis||"-"]})]})]}),e.jsx("button",{type:"button",onClick:()=>w(s.id),className:"text-red-500 hover:cursor-pointer hover:text-red-700",children:"✕"})]},s.id)})})}):e.jsx("div",{className:"rounded-lg border bg-gray-50 p-6 text-center",children:e.jsx("div",{className:"text-gray-400",children:"Belum ada peserta terpilih"})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(G,{href:route("payments.index"),className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"submit",className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:cursor-pointer hover:bg-blue-700",children:a!=null&&a.id?"Ubah":"Simpan"})]})]})]})]})}export{se as default};
