import{r as c,u as U,j as t,H as B,a as x}from"./app-Cn2t8gJw.js";import{A as D}from"./action-modal-BASpSwrF.js";import{P as O}from"./pagination-DQHh2ioN.js";import{T as H}from"./table-Bl75bIuL.js";import{A as L}from"./app-layout-iUCMu0m9.js";import{t as h,T as P}from"./index-BYKIGkqn.js";import V from"./base-form-BEZmtnEQ.js";import"./proxy-BkAw2byc.js";import"./createLucideIcon-DGjCQfrJ.js";import"./button-B_qfFY_x.js";import"./index-ByVWRwgP.js";import"./index-BdfUTLuM.js";import"./index-DYvuR1c0.js";import"./app-logo-icon-Dz0n-jmV.js";import"./form-modal-CN0FeIhh.js";function ne({users:d,statuses:y,filters:r,breadcrumbs:k,title:N,role:a,routePrefix:m}){const[w,j]=c.useState(!1),[u,C]=c.useState(null),[o,f]=c.useState([]),[i,p]=c.useState(null),{flash:s}=U().props;c.useEffect(()=>{s!=null&&s.success&&h.success(s.success),s!=null&&s.error&&h.error(s.error)},[s]);const v=(e=null)=>{C(e),j(!0)},S=e=>{x.delete(route(`${m}.destroy`,e),{onSuccess:()=>{x.reload()},onError:()=>{h.error("Failed to delete user")}})},$=e=>{f(l=>l.includes(e)?l.filter(b=>b!==e):[...l,e])},_=()=>{if(o.length===0)return;const e=d.data.filter(n=>o.includes(n.id)),l=`Name,Username,Role,Phone,Email,Status
`,b=e.map(n=>`${n.full_name},${n.username},${n.role.name},${n.phone},${n.email},${n.status}`).join(`
`),R=new Blob([l,b],{type:"text/csv"}),T=URL.createObjectURL(R),g=document.createElement("a");g.href=T,g.download=`${a.value}-users.csv`,g.click(),h.success(`Berhasil mengekspor ${e.length} data user`,{description:"File CSV telah didownload otomatis"})},A=e=>{x.get(route(`${m}.index`),{sort:e,direction:r.direction==="asc"?"desc":"asc"},{preserveState:!0})},E=[...a.value==="admin"||a.value==="teacher"?[{key:"profile_picture",label:"Foto",sortable:!1}]:[],{key:"full_name",label:"Nama",sortable:!0},...a.value==="admin"||a.value==="teacher"?[{key:"nip",label:"NIP",sortable:!0}]:[],{key:"username",label:"Username",sortable:!0},...a.value==="admin"||a.value==="teacher"?[{key:"position",label:"Jabatan",sortable:!0}]:[{key:"job",label:"Pekerjaan",sortable:!0}],{key:"phone",label:"Nomor Telepon",sortable:!0},{key:"email",label:"Email",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"address",label:"Alamat",sortable:!0},{key:"actions",label:"Aksi",sortable:!1}],F=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},I=e=>{switch(e){case"active":return"Active";case"inactive":return"Inactive";default:return e}};return t.jsxs(L,{breadcrumbs:k,children:[t.jsx(B,{title:N}),t.jsx(P,{position:"top-right",richColors:!0}),t.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",placeholder:"Cari pengguna...",defaultValue:r.search||"",onChange:e=>x.get(route(`${m}.index`),{search:e.target.value},{preserveState:!0}),className:"w-64 rounded border px-3 py-1"}),t.jsx("button",{disabled:o.length===0,onClick:_,className:`rounded bg-indigo-600 px-3 py-1 text-sm font-medium text-white hover:bg-indigo-700 ${o.length===0?"cursor-not-allowed opacity-50":"hover:cursor-pointer"}`,children:"Ekspor data yang dipilih"})]}),t.jsxs("button",{onClick:()=>v(null),className:"rounded bg-green-600 px-3 py-1 text-sm font-medium text-white transition hover:cursor-pointer hover:bg-green-700",children:["Tambah ",a.name]})]}),t.jsx(H,{headers:E,data:d.data,sortColumn:r.sort??"",sortDirection:r.direction==="asc"||r.direction==="desc"?r.direction:"asc",onSort:A,onSelectAll:e=>f(e?d.data.map(l=>l.id):[]),selectedIds:o,rowRender:e=>t.jsxs("tr",{className:"border-b",children:[t.jsx("td",{className:"w-[10px] p-3 text-sm",children:t.jsx("input",{type:"checkbox",checked:o.includes(e.id),onChange:()=>$(e.id)})}),(a.value==="admin"||a.value==="teacher")&&t.jsx("td",{className:"w-[50px] p-3 text-sm",children:t.jsx("div",{className:"h-10 w-10 overflow-hidden rounded-full border shadow-sm",children:t.jsx("img",{src:e.profile_picture?`/storage/${e.profile_picture}`:`https://api.dicebear.com/9.x/initials/svg?seed=${encodeURIComponent(e.full_name)}`,alt:e.full_name,className:"h-full w-full object-cover"})})}),t.jsx("td",{className:"p-3 text-sm",children:e.full_name}),(a.value==="admin"||a.value==="teacher")&&t.jsx("td",{className:"p-3 text-sm",children:e.nip||"-"}),t.jsx("td",{className:"p-3 text-sm",children:e.username}),(a.value==="admin"||a.value==="teacher")&&t.jsx("td",{className:"p-3 text-sm",children:e.position||"-"}),a.value==="parent"&&t.jsx("td",{className:"p-3 text-sm",children:e.job||"-"}),t.jsx("td",{className:"p-3 text-sm",children:e.phone||"-"}),t.jsx("td",{className:"p-3 text-sm",children:e.email||"-"}),t.jsx("td",{className:"p-3 text-sm",children:t.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${F(e.status)}`,children:I(e.status)})}),t.jsx("td",{className:"p-3 text-sm",children:e.address?e.address.length>70?e.address.substring(0,70)+"...":e.address:"-"}),t.jsxs("td",{className:"flex gap-2 p-3 text-sm",children:[t.jsx("button",{onClick:()=>v(e),className:"rounded bg-blue-500 px-3 py-1 font-medium text-white hover:cursor-pointer",children:"Edit"}),t.jsx("button",{onClick:()=>p(e),className:"rounded bg-red-500 px-3 py-1 font-medium text-white hover:cursor-pointer",children:"Hapus"})]})]},e.id)}),t.jsx(O,{links:d.links}),t.jsx(V,{isOpen:w,onClose:()=>j(!1),user:u,statuses:y,role:a,routePrefix:m},(u==null?void 0:u.id)||"new"),t.jsx(D,{isOpen:!!i,onClose:()=>p(null),title:"Confirm Deletion",message:t.jsxs("span",{children:["Are you sure you want to delete user ",t.jsx("strong",{children:i==null?void 0:i.full_name}),"?"]}),buttons:[{label:"Cancel",onClick:()=>p(null),variant:"neutral"},{label:"Delete",onClick:()=>{i&&(S(i.id),p(null))},variant:"danger"}]})]})]})}export{ne as default};
