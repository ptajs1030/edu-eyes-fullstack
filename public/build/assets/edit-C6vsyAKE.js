import{b as T,r as m,u as E,j as e,H as B,a as H}from"./app-C701TH5y.js";import{t as n,T as D}from"./index-8EoPVkl2.js";import{A as U}from"./app-layout-B-3PTEtg.js";import{S as W}from"./student-assignment-modal-Dh1YVN2y.js";/* empty css            */import"./index-C3RhDOjc.js";import"./button-CZKoGKPP.js";import"./index-eOG5pbBm.js";import"./index-EVa9hk18.js";import"./createLucideIcon--nE48WKx.js";import"./app-logo-icon-DO4HV3kk.js";const z=[{title:"Ujian",href:"/exams"},{title:"Edit Ujian",href:""}];function J({exam:i,subjects:g,academicYears:p,classrooms:b}){const{data:a,setData:c,put:j,processing:h}=T({subject_id:i.subject_id,name:i.name,type:i.type||"",date:i.date,student_assignments:(i.student_assignments||[]).map(s=>({student_id:s.student_id,student_name:s.student_name,nis:s.nis,class_name:s.class_name,class_id:s.class_id,score:s.score,is_scored:s.is_scored}))}),[f,x]=m.useState(!1),[y,N]=m.useState(i.name.length),[v,_]=m.useState((i.type||"").length),{errors:r,flash:l}=E().props;m.useEffect(()=>{l!=null&&l.success&&n.success(l.success),l!=null&&l.error&&n.error(l.error),r&&Object.keys(r).length>0&&Object.values(r).forEach(t=>{n.error(t)})},[l,r]);const k=s=>{if(s.preventDefault(),!Array.isArray(a.student_assignments)||a.student_assignments.length===0){n.error("Minimal harus memilih 1 siswa untuk exam ini");return}const t=n.loading("Memperbarui exam...");j(`/exams/${i.id}`,{onSuccess:()=>{n.dismiss(t)},onError:o=>{n.dismiss(t),o.student_assignments?n.error("Terjadi kesalahan pada data siswa yang dipilih"):o.name?n.error("Nama exam tidak valid"):o.subject_id?n.error("Mata pelajaran harus dipilih"):n.error("Terjadi kesalahan validasi data")},onFinish:()=>{n.dismiss(t)}})},w=s=>{const t=s.target.value;t.length<=70&&(c("name",t),N(t.length))},S=s=>{const t=s.target.value;t.length<=70&&(c("type",t),_(t.length))},L=s=>{const t=a.student_assignments.map(d=>d.student_id),o=s.filter(d=>!t.includes(d.student_id));c("student_assignments",[...a.student_assignments,...o.map(d=>({student_id:d.student_id,student_name:d.student_name,nis:d.nis,class_name:d.class_name,class_id:d.class_id,score:d.score??null,is_scored:d.is_scored??!1}))]),x(!1),n.success(`${o.length} siswa berhasil ditambahkan`)},M=(s,t=!1)=>{t&&!window.confirm("Siswa ini sudah memiliki nilai. Menghapus siswa akan menghilangkan data nilai tersebut. Apakah Anda yakin ingin melanjutkan?")||(c("student_assignments",a.student_assignments.filter(o=>o.student_id!==s)),n.success("Siswa berhasil dihapus dari exam"))},u=p.find(s=>s.id===i.academic_year_id)||i.academic_year,C=a.student_assignments.filter(s=>s.is_scored).length,A=a.student_assignments.length;return e.jsxs(U,{breadcrumbs:z,children:[e.jsx(B,{title:`Edit Exam - ${i.name}`}),e.jsx(D,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsxs("h2",{className:"mb-6 text-2xl font-semibold text-gray-900",children:["Edit Exam: ",i.name]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tahun Ajaran"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:(u==null?void 0:u.title)||"Loading...",disabled:!0,className:"w-full rounded-lg border border-gray-300 bg-gray-100 px-4 py-2 text-gray-600 cursor-not-allowed",readOnly:!0}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})})]}),e.jsxs("p",{className:"mt-1 text-xs text-amber-600 flex items-center gap-1",children:[e.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.99-.833-2.46 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),"Tahun ajaran tidak dapat diubah setelah exam dibuat"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mata Pelajaran *"}),e.jsxs("select",{value:a.subject_id,onChange:s=>c("subject_id",parseInt(s.target.value)),className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Pilih mata pelajaran"}),g.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Dropdown, taken from table subjects"}),r.subject_id&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.subject_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nama *"}),e.jsx("input",{type:"text",value:a.name,onChange:w,className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Masukkan nama exam",required:!0}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["String, max 70 char (",y,"/70)"]}),r.name&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipe (optional)"}),e.jsx("input",{type:"text",value:a.type,onChange:S,className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Contoh: Ulangan Harian, Quiz, UTS, UAS"}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["String, max 70 char (optional) (",v,"/70)"]}),r.type&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.type})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tanggal *"}),e.jsx("input",{type:"date",value:a.date,onChange:s=>c("date",s.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Select date (dateonly) in calendar"}),r.date&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.date})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Student Assignments"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[C," dari ",A," siswa sudah dinilai"]})]}),e.jsx("p",{className:"text-sm text-red-600 max-w-md text-right",children:"⚠️ Warning: Menghapus siswa yang sudah dinilai akan menghilangkan data skor mereka!"})]}),a.student_assignments.length>0?e.jsx("div",{className:"mb-4 overflow-hidden rounded-lg border border-gray-200",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"Status Nilai"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Action"})]})}),e.jsx("tbody",{children:a.student_assignments.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.student_name,s.is_scored&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-800",children:[e.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Sudah Dinilai"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:s.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:s.class_name}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.is_scored?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"inline-flex rounded-full bg-green-100 px-2 py-1 text-xs font-semibold text-green-800",children:"Sudah Dinilai"}),e.jsxs("span",{className:"text-xs text-gray-600 mt-1",children:["Nilai: ",s.score]})]}):e.jsx("span",{className:"inline-flex rounded-full bg-gray-100 px-2 py-1 text-xs font-semibold text-gray-800",children:"Belum Dinilai"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("button",{type:"button",onClick:()=>M(s.student_id,s.is_scored),className:"flex items-center gap-1 rounded px-2 py-1 text-xs text-white hover:opacity-90 bg-red-500 hover:bg-red-600",title:s.is_scored?"Hati-hati: Siswa ini sudah memiliki nilai!":"Hapus siswa dari exam",children:[e.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Remove"]})})]},s.student_id))})]})}):e.jsx("div",{className:"mb-4 rounded-lg border-2 border-dashed border-gray-300 p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Belum ada siswa yang di-assign ke exam ini"})}),e.jsxs("button",{type:"button",onClick:()=>x(!0),className:"flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Tambah Siswa"]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t",children:[e.jsx("button",{type:"button",onClick:()=>H.get("/exams"),className:"rounded-lg border border-gray-300 bg-white px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:h,className:"rounded-lg bg-blue-600 px-6 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",children:h?"Memperbarui...":"Update"})]})]})]}),e.jsx(W,{isOpen:f,onClose:()=>x(!1),onSubmit:L,classrooms:b,assignedStudentIds:a.student_assignments.map(s=>s.student_id)})]})}export{J as default};
