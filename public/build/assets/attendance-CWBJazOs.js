import{u as J,r as h,j as e,H as V,a as j,L as W}from"./app-CZvbObQA.js";import{P as q}from"./pagination-BLAG5eZK.js";import{A as z}from"./app-layout-BGdMAJuK.js";import{t as E,T as G}from"./index-DjCyt74Z.js";import Q from"./editAttendance-DeX3Yvx2.js";/* empty css            */import"./button-AthTwPwC.js";import"./index-BoVBHKYU.js";import"./index-CYx-xawi.js";import"./index-DzyThNNL.js";import"./createLucideIcon-iLjx2ksk.js";import"./app-logo-icon-BUFDshL2.js";import"./form-modal-rXE4YND9.js";import"./proxy-kW_FNpOv.js";const X=a=>[{title:"Events",href:"/events"},{title:a}];function me({event:a,attendances:c,canEditAttendance:w,filters:g}){const{flash:o}=J().props,[_,N]=h.useState(null),r=g.dates??[],[I,k]=h.useState(!1),[D,S]=h.useState(!1),[u,y]=h.useState([]),p=typeof(g==null?void 0:g.limit)<"u"?g.limit:10;h.useEffect(()=>{y([])},[r,p]);const A=()=>{if(u.length===0)return;const t=c.data.filter(l=>u.includes(l.id)),s={};t.forEach(l=>{s[l.submit_date]||(s[l.submit_date]=[]),s[l.submit_date].push(l)});const x=Object.keys(s).sort((l,m)=>new Date(l).getTime()-new Date(m).getTime()),n=["Tanggal","Nama","NIS","Kelas","Status","Jam Masuk","Jam Keluar","Keterlambatan","Catatan"],d=l=>{const m=String(l??"");return m.includes(",")||m.includes('"')||m.includes(`
`)?'"'+m.replace(/"/g,'""')+'"':m};let v=[];v.push(n.map(d).join(",")),x.forEach(l=>{s[l].forEach((i,P)=>{var T;const U=new Date(i.submit_date).toLocaleDateString("id-ID");v.push([P===0?d(U):"",d(i.student.full_name),d(i.student.nis||"-"),d(((T=i.student.classroom)==null?void 0:T.name)||"-"),d(C(i.status)),d(i.clock_in_hour||"-"),d(i.clock_out_hour||"-"),d(i.minutes_of_late!==null?i.minutes_of_late:"-"),d(i.note||"-")].join(","))})});const $=v.join(`\r
`),B=new Blob([$],{type:"text/csv;charset=utf-8;"}),L=URL.createObjectURL(B),b=document.createElement("a");b.href=L,b.setAttribute("download",`attendance_event_${a.id}.csv`),document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(L)},M=t=>{y(t?c.data.map(s=>s.id):[])},K=t=>{y(s=>s.includes(t)?s.filter(x=>x!==t):[...s,t])};o!=null&&o.success?E.success(o.success):o!=null&&o.error&&E.error(o.error);const f=h.useMemo(()=>{const t=[],s=new Date(a.start_date),x=new Date(a.end_date);for(let n=new Date(s);n<=x;n.setDate(n.getDate()+1))t.push(n.toISOString().split("T")[0]);return t},[a.start_date,a.end_date]),O=()=>{let t;r.length===f.length?t=[]:t=[...f];const s={dates:t,limit:p,page:1};j.get(route("events.attendance",a.id),s,{preserveState:!0})},R=t=>{let s;r.includes(t)?s=r.filter(n=>n!==t):s=[...r,t];const x={dates:s,limit:p,page:1};j.get(route("events.attendance",a.id),x,{preserveState:!0})},F=t=>{j.patch(route("events.attendance.update",a.id),t,{preserveScroll:!0,onSuccess:()=>{k(!1),N(null)}})},H=t=>{switch(t){case"present":return"bg-green-100 text-green-800 border-green-200";case"present_in_tolerance":return"bg-blue-100 text-blue-800 border-blue-200";case"late":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"alpha":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},C=t=>{switch(t){case"present":return"Hadir";case"present_in_tolerance":return"Hadir (Toleransi)";case"late":return"Terlambat";case"alpha":return"Tidak Masuk";default:return"Belum Diisi"}};return e.jsxs(z,{breadcrumbs:X(a.name),children:[e.jsx(V,{title:`Detail Event - ${a.name}`}),e.jsx(G,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h1",{className:"mb-4 text-2xl font-bold",children:a.name}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Tanggal"}),e.jsxs("p",{className:"mt-1",children:[new Date(a.start_date).toLocaleDateString("id-ID")," - ",new Date(a.end_date).toLocaleDateString("id-ID")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Waktu"}),e.jsxs("p",{className:"mt-1",children:[a.start_hour," - ",a.end_hour]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"PIC"}),e.jsx("p",{className:"mt-1",children:a.event_pics.map(t=>t.user.full_name).join(", ")||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Deskripsi"}),e.jsx("p",{className:"mt-1",children:a.description||"-"})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-3 justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Daftar Kehadiran"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("select",{value:p,onChange:t=>{const s=t.target.value,n={limit:s==="all"?"all":Number(s),page:1};r.length>0&&(n.dates=r),j.get(route("events.attendance",a.id),n,{preserveState:!0})},className:"rounded-lg border border-gray-300 px-3 py-1 text-sm text-gray-700 bg-white",children:[e.jsx("option",{value:10,children:"Show 10 data"}),e.jsx("option",{value:20,children:"Show 20 data"}),e.jsx("option",{value:"all",children:"Show All"})]}),e.jsx("button",{onClick:A,disabled:u.length===0,className:`rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700 ${u.length===0?"opacity-50 cursor-not-allowed":""}`,children:"Ekspor CSV"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>S(!D),className:"flex items-center gap-2 rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filter Tanggal",r.length>0&&e.jsx("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-blue-800 text-xs",children:r.length})]}),D&&e.jsxs("div",{className:"absolute top-full right-0 z-10 mt-2 w-80 rounded-lg border border-gray-200 bg-white p-4 shadow-lg",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Filter Berdasarkan Tanggal"}),e.jsx("button",{onClick:()=>S(!1),className:"text-gray-400 hover:cursor-pointer hover:text-gray-600",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:r.length===f.length,onChange:O,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Pilih Semua Tanggal"})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto border-t border-gray-200 pt-3",children:f.map(t=>e.jsxs("label",{className:"flex items-center space-x-2 py-1",children:[e.jsx("input",{type:"checkbox",checked:r.includes(t),onChange:()=>R(t),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:new Date(t).toLocaleDateString("id-ID",{weekday:"short",year:"numeric",month:"short",day:"numeric"})})]},t))}),e.jsxs("div",{className:"flex justify-between border-t border-gray-200 pt-3",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[r.length," tanggal dipilih"]}),e.jsx("button",{onClick:()=>{const t={dates:[],limit:p,page:1};j.get(route("events.attendance",a.id),t,{preserveState:!0})},className:"text-sm text-blue-600 hover:cursor-pointer hover:text-blue-800",children:"Reset Filter"})]})]})]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:u.length===c.data.length&&c.data.length>0,onChange:t=>M(t.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tanggal"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Jam Masuk"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Jam Keluar"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Keterlambatan"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Catatan"}),w&&e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:c.data.map(t=>{var s;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:u.includes(t.id),onChange:()=>K(t.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:new Date(t.submit_date).toLocaleDateString("id-ID")}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.student.full_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.student.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:((s=t.student.classroom)==null?void 0:s.name)||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`inline-block rounded px-2 py-1 text-xs font-semibold ${H(t.status)}`,children:C(t.status)})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.clock_in_hour||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.clock_out_hour||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.minutes_of_late!==null?t.minutes_of_late:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.note||"-"}),w&&e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{className:"rounded bg-blue-500 px-3 py-1 text-sm font-medium text-white hover:bg-blue-600",onClick:()=>{N(t),k(!0)},children:"Edit"})})]},`${t.submit_date}-${t.student.id}`)})})]})}),e.jsx("div",{className:"mt-4",children:c.links&&c.links.length>0?e.jsx(q,{links:c.links,dates:r,limit:p}):e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{disabled:!0,className:"rounded px-3 py-1 text-sm bg-gray-100 text-black",dangerouslySetInnerHTML:{__html:"&laquo;"}}),e.jsx("button",{className:"rounded px-3 py-1 text-sm bg-blue-500 text-white font-bold",children:"1"}),e.jsx("button",{disabled:!0,className:"rounded px-3 py-1 text-sm bg-gray-100 text-black",dangerouslySetInnerHTML:{__html:"&raquo;"}})]})}),c.data.length===0&&e.jsx("div",{className:"mt-4 text-center text-gray-500",children:"Tidak ada data kehadiran untuk tanggal yang dipilih"})]}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx(W,{href:route("events.index"),className:"rounded-md bg-gray-200 px-4 py-2 text-sm font-medium text-gray-800 hover:bg-gray-300",children:"Kembali ke Daftar Event"})})]}),I&&_&&e.jsx(Q,{attendance:_,onClose:()=>{k(!1),N(null)},onSubmit:F})]})}export{me as default};
