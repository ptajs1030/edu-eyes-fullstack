import{r,D as q,j as e,u as G,H as J,L as M,a as V}from"./app-BTMWmB6-.js";import{A as H}from"./app-layout-CXr8fwYk.js";import{t as k,T as z}from"./index-CqGPXG27.js";/* empty css            */import"./button-DP-iB3o-.js";import"./index-D-CXGy4f.js";import"./index-O6hNaYvg.js";import"./index-BghVHWhV.js";import"./createLucideIcon-sJulOUbC.js";import"./app-logo-icon-BQHpvXpr.js";function U({value:o,onChange:_,placeholder:t="Search...",endpoint:N,options:l,initialOptions:x=[],showInitialOptions:m=!1,maxInitialOptions:L=10}){const[u,v]=r.useState(""),[p,g]=r.useState(!1),[h,w]=r.useState(!1),[j,y]=r.useState(x),[K,P]=r.useState(x),c=r.useRef(null),S=r.useRef(null),C=r.useRef(null),D=l&&l.length>0?l:K,I=j.filter(a=>a&&a.name&&typeof a.name=="string"&&a.name.toLowerCase().includes(u.toLowerCase())&&!o.includes(a.id)),E=D.filter(a=>o.includes(a.id));r.useEffect(()=>{const a=i=>{c.current&&!c.current.contains(i.target)&&g(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),r.useEffect(()=>{m&&N&&j.length===0&&f("")},[m,N,j.length]);const f=async a=>{if(N){w(!0);try{const i=await q.get(N,{params:{query:a},withCredentials:!0}),B=(Array.isArray(i.data)?i.data:[]).map(b=>({id:b.id||"",name:b.name||b.full_name||""})).filter(b=>b.id&&b.name).slice(0,L);y(B),P(b=>{const T=[...b];return B.forEach(A=>{T.some(R=>R.id===A.id)||T.push(A)}),T}),g(!0)}catch(i){console.error("Error fetching options:",i),y([])}finally{w(!1)}}},F=a=>{const i=a.target.value;if(v(i),C.current&&clearTimeout(C.current),m&&i===""){f("");return}C.current=setTimeout(()=>{i.length>=1||m&&i.length===0?f(i):(y([]),g(!1))},300)},O=a=>{!a||!a.id||(_([...o,a.id]),v(""),g(!1),S.current&&S.current.focus())},s=a=>{_(o.filter(i=>i!==a))},d=()=>{m&&j.length===0&&f(""),g(!0)},n=a=>{if(a.key==="Enter"){a.preventDefault(),u.trim()!==""?f(u):m&&f("");return}a.key==="Backspace"&&u===""&&o.length>0&&s(o[o.length-1])};return e.jsxs("div",{className:"relative",ref:c,children:[e.jsxs("div",{className:"flex flex-wrap mt-1 items-center gap-1 border p-2 border-gray-300 rounded-md shadow-sm bg-white cursor-text",onClick:()=>{var a;return(a=S.current)==null?void 0:a.focus()},children:[E.map(a=>a&&e.jsxs("span",{className:"inline-flex items-center rounded bg-blue-100 px-2 py-1 text-xs font-medium text-blue-800",children:[a.name,e.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),s(a.id)},className:"ml-1 text-blue-600 hover:text-blue-800 hover:cursor-pointer",children:"Ã—"})]},a.id)),e.jsx("input",{ref:S,type:"text",value:u,onChange:F,onFocus:d,onKeyDown:n,placeholder:E.length===0?t:"",className:"flex-1 min-w-[120px] outline-none bg-transparent",style:{minWidth:"120px"}})]}),p&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md border max-h-60 overflow-auto",children:h?e.jsx("div",{className:"py-2 px-3 text-gray-500",children:"Loading..."}):I.length===0?e.jsx("div",{className:"py-2 px-3 text-gray-500",children:"Tidak ditemukan"}):I.map(a=>a&&e.jsx("div",{onClick:()=>O(a),className:"px-3 py-2 hover:bg-gray-100 cursor-pointer",children:a.name},a.id))})]})}const W=o=>[{title:"Kegiatan",href:"/events"},{title:o?"Edit Kegiatan":"Buat Kegiatan Baru"}];function ie({teachers:o,classrooms:_,event:t,selectedStudents:N=[]}){const[l,x]=r.useState({name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||"",start_date:(t==null?void 0:t.start_date)||"",end_date:(t==null?void 0:t.end_date)||"",start_hour:(t==null?void 0:t.start_hour)||"",end_hour:(t==null?void 0:t.end_hour)||""}),[m,L]=r.useState(t!=null&&t.pics?t.pics.map(s=>s.user.id):[]),[u,v]=r.useState(null),[p,g]=r.useState([]),[h,w]=r.useState(N),[j,y]=r.useState([]),[K,P]=r.useState(!1),{flash:c}=G().props;r.useEffect(()=>{c!=null&&c.success&&k.success(c.success),c!=null&&c.error&&k.error(c.error)},[c]);const S=o.map(s=>({id:s.id,name:s.full_name}));r.useEffect(()=>{u&&C(u)},[u]),r.useEffect(()=>{h.length>0?D(h):y([])},[h]);const C=async s=>{P(!0);try{const d=await fetch(route("students.by-class",s));if(!d.ok)throw new Error("Gagal memuat data siswa");const n=await d.json();g(n)}catch{k.error("Gagal memuat data siswa"),g([])}finally{P(!1)}},D=async s=>{try{const d=await fetch(route("students.get-by-ids",{ids:s.join(",")}));if(!d.ok)throw new Error("Gagal memuat data siswa terpilih");const n=await d.json();y(n)}catch{k.error("Gagal memuat data siswa terpilih"),y([])}},I=s=>{v(s),g([])},E=s=>{w(d=>d.includes(s)?d.filter(n=>n!==s):[...d,s])},f=s=>{const d=p.map(n=>n.id);w(s?n=>{const a=[...n];return d.forEach(i=>{a.includes(i)||a.push(i)}),a}:n=>n.filter(a=>!d.includes(a)))},F=s=>{if(s.preventDefault(),h.length===0){k.error("Pilih minimal 1 peserta");return}if(m.length===0){k.error("Pilih minimal 1 PIC");return}const d=t!=null&&t.id?`/events/${t.id}`:"/events",n=t!=null&&t.id?"put":"post";V[n](d,{...l,pics:m.map(a=>({id:a})),selected_students:h},{onSuccess:()=>{},onError:()=>{}})},O=p.length>0&&p.every(s=>h.includes(s.id));return e.jsxs(H,{breadcrumbs:W(!!(t!=null&&t.id)),children:[e.jsx(J,{title:t!=null&&t.id?"Edit Kegiatan":"Buat Kegiatan Baru"}),e.jsx(z,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t!=null&&t.id?"Edit Kegiatan":"Buat Kegiatan Baru"}),e.jsxs("form",{onSubmit:F,className:"flex flex-col gap-6",children:[e.jsx("div",{className:"rounded-lg border p-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Nama Kegiatan*"}),e.jsx("input",{id:"name",type:"text",placeholder:"Nama kegiatan",maxLength:70,value:l.name,onChange:s=>x({...l,name:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{htmlFor:"pics",className:"block text-sm font-medium text-gray-700",children:"PIC (Penanggung Jawab)*"}),e.jsx(U,{value:m,onChange:L,placeholder:"Cari guru...",endpoint:route("teachers.search"),initialOptions:S,showInitialOptions:!0,maxInitialOptions:10})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"start_hour",className:"block text-sm font-medium text-gray-700",children:"Jam Mulai*"}),e.jsx("input",{type:"time",id:"start_hour",value:l.start_hour,onChange:s=>x({...l,start_hour:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"end_hour",className:"block text-sm font-medium text-gray-700",children:"Jam Selesai*"}),e.jsx("input",{type:"time",id:"end_hour",value:l.end_hour,min:l.start_hour,onChange:s=>x({...l,end_hour:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"start_date",className:"block text-sm font-medium text-gray-700",children:"Tanggal Mulai*"}),e.jsx("input",{id:"start_date",type:"date",value:l.start_date,min:new Date().toISOString().split("T")[0],onChange:s=>x({...l,start_date:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"end_date",className:"block text-sm font-medium text-gray-700",children:"Tanggal Selesai*"}),e.jsx("input",{id:"end_date",type:"date",value:l.end_date,min:l.start_date,onChange:s=>x({...l,end_date:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Deskripsi*"}),e.jsx("textarea",{id:"description",value:l.description,onChange:s=>x({...l,description:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",rows:4,required:!0})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Pilih Peserta"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Kelas"}),e.jsxs("select",{value:u||"",onChange:s=>I(Number(s.target.value)),className:"w-full rounded border p-2",children:[e.jsx("option",{value:"",children:"Pilih Kelas"}),_.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),K?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-blue-500 border-t-transparent"})}):p.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[p.length," siswa ditemukan"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:s=>f(s.target.checked),className:"rounded border-gray-300 text-indigo-600 hover:cursor-pointer"}),"Pilih Semua"]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto rounded-lg border",children:e.jsx("div",{className:"divide-y divide-gray-200",children:p.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.full_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["NIS: ",s.nis||"-"]})]}),e.jsx("input",{type:"checkbox",checked:h.includes(s.id),onChange:()=>E(s.id),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 hover:cursor-pointer"})]},s.id))})})]}):e.jsx("div",{className:"rounded-lg border bg-gray-50 p-6 text-center",children:e.jsx("div",{className:"text-gray-400",children:u?"Tidak ada siswa di kelas ini":"Pilih kelas untuk melihat siswa"})})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("h2",{className:"mb-4 text-lg font-semibold",children:["Peserta Terpilih (",h.length,")"]}),j.length>0?e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"max-h-96 divide-y divide-gray-200 overflow-y-auto rounded-lg border border-gray-200",children:j.map(s=>{var d,n;return e.jsxs("div",{className:"flex items-center justify-between bg-white p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.full_name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsx("span",{children:((d=_.find(a=>a.id===s.class_id))==null?void 0:d.name)||((n=s.classroom)==null?void 0:n.name)||"-"}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["NIS: ",s.nis||"-"]})]})]}),e.jsx("button",{type:"button",onClick:()=>E(s.id),className:"text-red-500 hover:cursor-pointer hover:text-red-700",children:"âœ•"})]},s.id)})})}):e.jsx("div",{className:"rounded-lg border bg-gray-50 p-6 text-center",children:e.jsx("div",{className:"text-gray-400",children:"Belum ada peserta terpilih"})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(M,{href:route("events.index"),className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"submit",className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:cursor-pointer hover:bg-blue-700",children:t!=null&&t.id?"Ubah":"Simpan"})]})]})]})]})}export{ie as default};
