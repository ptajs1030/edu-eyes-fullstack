import{r as x,u as D,j as e,H as F,a as f}from"./app-BHxPEqLt.js";import{A as L}from"./app-layout-CCzLGhRQ.js";import{t as i,T as B}from"./index-B3tPXugK.js";/* empty css            */import"./button-D-B4KWd0.js";import"./index-CzPtNsn1.js";import"./index-Dsd29r8I.js";import"./index-CS7b4lyp.js";import"./createLucideIcon-BU_jnPrR.js";import"./app-logo-icon-b30RjAPZ.js";function V({task:o,studentAssignments:u}){const[b,g]=x.useState({}),[p,h]=x.useState({}),[y,N]=x.useState({}),[m,j]=x.useState(u),{flash:n}=D().props,v=[{title:"Tugas",href:"/tasks"},{title:"Penilaian",href:""}];x.useEffect(()=>{n!=null&&n.success&&i.success(n.success),n!=null&&n.error&&i.error(n.error)},[n]),x.useEffect(()=>{j(u);const t={};(u??[]).forEach(s=>{var a;t[s.id]=((a=s.score)==null?void 0:a.toString())||""}),g(t)},[u]);const k=(t,s)=>{(s===""||/^\d*\.?\d*$/.test(s))&&g(a=>({...a,[t]:s}))},w=t=>{h(s=>({...s,[t]:!0}))},S=t=>{var a;const s=(a=m.find(r=>r.id===t))==null?void 0:a.score;g(r=>({...r,[t]:(s==null?void 0:s.toString())||""})),h(r=>({...r,[t]:!1}))},E=async t=>{const s=b[t];if(s===""){i.error("Nilai tidak boleh kosong");return}const a=parseFloat(s);if(isNaN(a)||a<0||a>100){i.error("Nilai harus antara 0-100");return}N(r=>({...r,[t]:!0})),f.put(`/tasks/${o.id}/assignments/${t}/score`,{score:a},{onSuccess:()=>{i.success("Nilai berhasil disimpan"),h(r=>({...r,[t]:!1})),j(r=>r.map(l=>l.id===t?{...l,score:a}:l))},onError:r=>{console.error("Error saving score:",r),i.error("Gagal menyimpan nilai"),S(t)},onFinish:()=>{N(r=>({...r,[t]:!1}))}})},C=async()=>{const t=Object.entries(b).filter(([a,r])=>{const l=parseFloat(r);return!isNaN(l)&&l>=0&&l<=100}).map(([a,r])=>({assignment_id:parseInt(a),score:parseFloat(r)}));if(t.length===0){i.error("Tidak ada nilai valid untuk disimpan");return}const s=i.loading("Menyimpan semua nilai...");f.put(`/tasks/${o.id}/scores/bulk`,{scores:t},{onSuccess:()=>{i.dismiss(s),h({}),j(a=>a.map(r=>{const l=t.find(d=>d.assignment_id===r.id);return l?{...r,score:l.score}:r}))},onError:a=>{i.dismiss(s),console.error("Error saving bulk scores:",a),i.error("Gagal menyimpan nilai")},onFinish:()=>{i.dismiss(s)}})},_=t=>t===null?"text-gray-400":t>=80?"text-green-600":t>=60?"text-yellow-600":"text-red-600",T=t=>t===null?"Belum dinilai":"Sudah Dinilai",$=Object.keys(p).some(t=>p[parseInt(t)]),A=()=>{if(!m||m.length===0){i.error("Tidak ada data untuk diexport");return}const t=["Nama","NIS","Kelas","Nilai","Status"],s=m.map(c=>[c.student_name,c.nis||"-",c.class_name,c.score!==null?c.score.toString():"-",c.score===null?"Belum Dinilai":"Sudah Dinilai"]),a=[t,...s].map(c=>c.join(",")).join(`
`),r=new Blob([a],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(r),d=document.createElement("a");d.href=l,d.setAttribute("download",`nilai_${o.title.replace(/\s+/g,"_")}.csv`),document.body.appendChild(d),d.click(),document.body.removeChild(d)};return e.jsxs(L,{breadcrumbs:v,children:[e.jsx(F,{title:`Penilaian - ${o.title}`}),e.jsx(B,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-6 border-b pb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:o.title}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tahun Ajaran"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:o.academic_year.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Mata Pelajaran"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:o.subject.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tenggat Waktu"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:o.due_date?(()=>{const t=new Date(o.due_date.replace(/-/g,"/"));return isNaN(t.getTime())?"-":t.toLocaleDateString("id-ID")})():"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tenggat Waktu (Jam)"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:o.due_time?o.due_time.substring(0,5):"-"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Student Assignments"}),$&&e.jsx("button",{onClick:C,className:"rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:"Simpan Semua Nilai"}),e.jsx("button",{onClick:A,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700",children:"Export Nilai"})]}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-200",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"NILAI"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"Action"})]})}),e.jsx("tbody",{children:(m??[]).map(t=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.student_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.class_name}),e.jsx("td",{className:"px-4 py-3 text-center",children:p[t.id]?e.jsx("input",{type:"text",value:b[t.id]||"",onChange:s=>k(t.id,s.target.value),className:"w-16 rounded border border-gray-300 px-2 py-1 text-center text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none",placeholder:"0-100",autoFocus:!0}):e.jsx("span",{className:`text-sm font-medium ${_(t.score)}`,children:t.score!==null?t.score:"-"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${t.score===null?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800"}`,children:T(t.score)})}),e.jsx("td",{className:"px-4 py-3 text-center",children:p[t.id]?e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsx("button",{onClick:()=>E(t.id),disabled:y[t.id],className:"rounded bg-blue-500 px-2 py-1 text-xs text-white hover:bg-blue-600 disabled:opacity-50",children:y[t.id]?"...":"Simpan"}),e.jsx("button",{onClick:()=>S(t.id),disabled:y[t.id],className:"rounded bg-gray-500 px-2 py-1 text-xs text-white hover:bg-gray-600 disabled:opacity-50",children:"Batal"})]}):e.jsx("button",{onClick:()=>w(t.id),className:"rounded bg-yellow-500 px-3 py-1 text-xs text-white hover:bg-yellow-600",children:"Edit"})})]},t.id))})]})})]}),e.jsxs("div",{className:"rounded-lg bg-blue-50 p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900",children:"Petunjuk:"}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-800",children:[e.jsx("li",{children:'• Klik tombol "Edit" untuk memperbarui nilai siswa'}),e.jsx("li",{children:"• Nilai harus antara 0-100"}),e.jsx("li",{children:'• Klik "Simpan" untuk menyimpan nilai atau "Batal" untuk membatalkan'}),e.jsx("li",{children:'• Jika ada beberapa perubahan, gunakan tombol "Simpan Semua Nilai" untuk menyimpan sekaligus'})]})]}),e.jsx("div",{className:"mt-6 flex justify-end border-t pt-6",children:e.jsx("button",{onClick:()=>f.get("/tasks"),className:"rounded-lg border border-gray-300 bg-white px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Kembali ke Daftar Tugas"})})]})]})}export{V as default};
