import{u as T,r as o,j as s,H as ae,a as h,L as le}from"./app-Cl9VbZmE.js";import{A as D}from"./action-modal-LriFQPc1.js";import{P as oe}from"./pagination-B8jKc6ZG.js";import{T as ne}from"./table-DGjwTx_6.js";import{A as ie}from"./app-layout-CwRHq0j6.js";import{t as g,T as ce}from"./index-BNS5INK1.js";import de from"./form-DoFe_KBo.js";/* empty css            */import"./proxy-DbIYpQ65.js";import"./createLucideIcon-BYL4H8Za.js";import"./button-BpTCOO0K.js";import"./index-p_E92kqk.js";import"./index-Cg4x4Wpx.js";import"./index-VCQxX_LZ.js";import"./app-logo-icon-D-5qQfPm.js";import"./form-modal-R_GCHg5I.js";import"./searchable-select-CI3CTuZg.js";const me=[{title:"Siswa",href:"/students"}];function Oe(){const{students:x,classrooms:k,sexes:E,statuses:R,religions:I,filters:t}=T().props,{flash:c}=T().props;o.useEffect(()=>{c!=null&&c.success&&g.success(c.success),c!=null&&c.error&&g.error(c.error)},[c]),o.useEffect(()=>{const e=r=>{j.current&&!j.current.contains(r.target)&&O(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),o.useEffect(()=>{const e=t.classrooms?Array.isArray(t.classrooms)?t.classrooms.map(r=>Number(r)):[Number(t.classrooms)]:[];w(e)},[t.classrooms]);const K=t.classrooms?Array.isArray(t.classrooms)?t.classrooms.map(e=>Number(e)):[Number(t.classrooms)]:[],[P,v]=o.useState(!1),[U,H]=o.useState(null),[i,N]=o.useState([]),[u,b]=o.useState(null),[M,f]=o.useState(!1),[y,S]=o.useState(null),[q,C]=o.useState(""),[B,_]=o.useState(""),[d,w]=o.useState(K),[$,O]=o.useState(!1),j=o.useRef(null),Q=e=>{const r=Number(e),l=d.includes(r)?d.filter(n=>n!==r):[...d,r];w(l);const m={search:t.search||void 0,sort:t.sort||void 0,direction:t.direction||void 0,page:1};l.length>0&&(m.classrooms=l),h.get(route("students.index"),m,{preserveState:!0,replace:!0,only:["students","filters"]})},J=()=>{w([]);const e={search:t.search||void 0,sort:t.sort||void 0,direction:t.direction||void 0,page:1};t.classrooms&&(e.classrooms=void 0),h.get(route("students.index"),e,{preserveState:!0,replace:!0,only:["students","filters"]})},A=(e=null)=>{H(e),v(!0)},G=async e=>{h.delete(`/students/${e}`,{onSuccess:()=>{h.reload()}})},V=e=>{N(r=>r.includes(e)?r.filter(l=>l!==e):[...r,e])},z=()=>{if(i.length===0)return;const e=x.data.filter(a=>i.includes(a.id)),r=`Nama Siswa,Nama Orang Tua/Wali,Kelas,NIS,Tahun Masuk,Jenis Kelamin,Agama,Tanggal Lahir,Alamat,Status
`,l=e.map(a=>{var F,L;const se=a.address?`"${a.address.replace(/[\r\n\u2028\u2029\u0085]+/g," ").replace(/"/g,'""')}"`:'""',te=a.date_of_birth?new Date(a.date_of_birth).toISOString().slice(0,10):"",re=a.nis?a.nis:"-";return`${a.full_name},${(F=a.parent)==null?void 0:F.full_name},${(L=a.classroom)==null?void 0:L.name},${re},${a.entry_year},${a.gender},${a.religion},${te},${se},${a.status}`}).join(`
`),m=new Blob([r,l],{type:"text/csv"}),n=URL.createObjectURL(m),p=document.createElement("a");p.href=n,p.download="students.csv",p.click(),g.success(`Berhasil mengekspor ${i.length} data siswa`,{description:"File CSV telah didownload otomatis"}),URL.revokeObjectURL(n)},W=e=>{const r=t.direction==="asc"?"desc":"asc";let l=e;e==="classroom.name"&&(l="class_name"),h.get(route("students.index"),{sort:l,direction:r,classrooms:d.length>0?d:void 0,search:t.search||void 0},{preserveState:!0})},X=async()=>{var e;if(i.length!==0)try{const r=await fetch("/bulk-kartu-siswa",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.content)||""},body:JSON.stringify({student_ids:i})});if(!r.ok)throw new Error("Failed to download PDF");const l=await r.blob(),m=window.URL.createObjectURL(l),n=document.createElement("a");n.href=m,n.download="kumpulan-kartu-siswa.pdf",n.click()}catch{g.error("Gagal download kartu siswa.")}},Y=[{key:"profile_picture",label:"Foto",sortable:!1},{key:"full_name",label:"Nama Siswa",sortable:!0},{key:"parent.full_name",label:"Nama Orang Tua/wali",sortable:!1},{key:"classroom.name",label:"Kelas",sortable:!0},{key:"nis",label:"NIS",sortable:!0},{key:"entry_year",label:"Tahun Masuk",sortable:!0},{key:"gender",label:"Jenis Kelamin",sortable:!0},{key:"religion",label:"Agama",sortable:!0},{key:"date_of_birth",label:"Tanggal Lahir",sortable:!0},{key:"address",label:"Alamat",sortable:!1},{key:"status",label:"Status",sortable:!0},{key:"actions",label:"Aksi",sortable:!1}],Z=e=>{switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-red-100 text-red-800";case"graduated":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},ee=e=>{switch(e){case"active":return"Active";case"inactive":return"Inactive";case"graduated":return"Graduated";default:return e}};return s.jsxs(ie,{breadcrumbs:me,children:[s.jsx(ae,{title:"Siswa"}),s.jsx(ce,{position:"top-right",richColors:!0}),s.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"text",placeholder:"Cari siswa...",defaultValue:t.search||"",onChange:e=>h.get(route("students.index"),{search:e.target.value},{preserveState:!0}),className:"w-64 rounded border px-3 py-1"}),s.jsxs("div",{className:"relative",ref:j,children:[s.jsxs("button",{onClick:()=>O(!$),className:"rounded bg-gray-200 px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-300",children:["Filter Kelas ",d.length>0?`(${d.length})`:""]}),$&&s.jsxs("div",{className:"absolute top-full left-0 z-10 mt-1 w-64 rounded-md border border-gray-200 bg-white p-3 shadow-lg",children:[s.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[s.jsx("span",{className:"text-sm font-medium",children:"Filter by Kelas"}),d.length>0&&s.jsx("button",{onClick:J,className:"text-xs text-blue-600 hover:text-blue-800",children:"Clear"})]}),s.jsx("div",{className:"max-h-48 overflow-y-auto",children:k.map(e=>s.jsxs("label",{className:"flex items-center space-x-2 py-1",children:[s.jsx("input",{type:"checkbox",checked:d.includes(e.id),onChange:()=>Q(e.id),className:"rounded border-gray-300"}),s.jsx("span",{className:"text-sm",children:e.name})]},e.id))})]})]}),s.jsx("button",{disabled:i.length===0,onClick:z,className:`rounded bg-indigo-600 px-3 py-1 text-sm font-medium text-white hover:bg-indigo-700 ${i.length===0?"cursor-not-allowed opacity-50":"hover:cursor-pointer"}`,children:"Ekspor data yang dipilih"}),s.jsx("button",{disabled:i.length===0,onClick:X,className:"rounded bg-indigo-700 px-3 py-1 text-sm font-medium text-white hover:bg-indigo-700 disabled:cursor-not-allowed disabled:opacity-50",children:"Bulk Print Kartu Siswa"})]}),s.jsx("button",{onClick:()=>A(null),className:"rounded bg-green-600 px-3 py-1 text-sm font-medium text-white transition hover:cursor-pointer hover:bg-green-700",children:"Tambah Siswa"})]}),s.jsx(ne,{headers:Y,data:x.data,sortColumn:t.sort??"",sortDirection:t.direction==="asc"||t.direction==="desc"?t.direction:"asc",onSort:W,onSelectAll:e=>N(e?x.data.map(r=>r.id):[]),selectedIds:i,rowRender:e=>{var r,l,m,n;return s.jsxs("tr",{className:"border-b",children:[s.jsx("td",{className:"w-[10px] p-3 text-sm",children:s.jsx("input",{type:"checkbox",checked:i.includes(e.id),onChange:()=>V(e.id)})}),s.jsx("td",{className:"p-3",children:s.jsx("div",{className:"flex justify-center",children:e.profile_picture?s.jsx("img",{src:`/storage/${e.profile_picture}`,alt:e.full_name,className:"h-10 w-10 rounded-full border border-gray-300 object-cover"}):s.jsx("img",{src:`https://api.dicebear.com/9.x/initials/svg?seed=${encodeURIComponent(e.full_name)}`,alt:e.full_name,className:"h-10 w-10 rounded-full border border-gray-300 object-cover"})})}),s.jsx("td",{className:"p-3 text-sm",children:e.full_name}),s.jsx("td",{className:"p-3 text-sm",children:((r=e.parent)==null?void 0:r.full_name)||"-"}),s.jsx("td",{className:"p-3 text-sm",children:((l=e.classroom)==null?void 0:l.name)||"-"}),s.jsx("td",{className:"p-3 text-sm",children:e.nis||"-"}),s.jsx("td",{className:"p-3 text-sm",children:e.entry_year}),s.jsx("td",{className:"p-3 text-sm",children:e.gender}),s.jsx("td",{className:"p-3 text-sm",children:e.religion}),s.jsxs("td",{className:"p-3 text-sm",children:[e.birth_place,", ",e.date_of_birth]}),s.jsx("td",{className:"p-3 text-sm",children:e.address?e.address.length>70?e.address.substring(0,70)+"...":e.address:"-"}),s.jsx("td",{className:"p-3 text-sm",children:s.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${Z(e.status)}`,children:ee(e.status)})}),s.jsxs("td",{className:"flex justify-center gap-2 p-3",children:[s.jsx("button",{onClick:()=>A(e),className:"rounded bg-blue-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Edit"}),s.jsx(le,{href:route("students.attendance",e.id),className:`rounded px-3 py-1 text-sm font-medium text-white ${(m=e.classroom)!=null&&m.name?"bg-sky-500 hover:cursor-pointer hover:bg-sky-600":"cursor-not-allowed bg-sky-300"}`,onClick:p=>{var a;(a=e.classroom)!=null&&a.name||p.preventDefault()},title:(n=e.classroom)!=null&&n.name?"":"Siswa harus memiliki kelas untuk melihat kehadiran",children:"Kehadiran"}),s.jsx("button",{onClick:async()=>{S(e),f(!0);const a=await(await fetch(route("student.qrcode.preview",{student:e.id}))).text();_(a),C(route("kartu-siswa",{student_id:e.id}))},className:"rounded bg-sky-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Kartu"}),s.jsx("button",{onClick:()=>b(e),className:"rounded bg-red-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Hapus"})]})]},e.id)}}),s.jsx(oe,{links:x.links}),s.jsx(de,{isOpen:P,onClose:()=>v(!1),student:U,classrooms:k,sexes:E,statuses:R,religions:I}),s.jsx(D,{isOpen:!!u,onClose:()=>b(null),title:"Confirm Deletion",message:s.jsxs("span",{children:["Are you sure you want to delete student ",s.jsx("strong",{children:u==null?void 0:u.full_name}),"?"]}),buttons:[{label:"Cancel",onClick:()=>b(null),variant:"neutral"},{label:"Delete",onClick:()=>{u&&(G(u.id),b(null))},variant:"danger"}]}),s.jsx(D,{isOpen:M,onClose:()=>{f(!1),S(null),_(""),C("")},title:`Kartu Pelajar - ${y==null?void 0:y.full_name}`,message:s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsx("div",{dangerouslySetInnerHTML:{__html:B},className:"h-[200px] w-[200px]"}),s.jsx("a",{href:q,download:!0,className:"mt-2 rounded bg-blue-600 px-4 py-2 text-sm text-white hover:bg-blue-700",children:"Download PDF"})]}),buttons:[{label:"Close",onClick:()=>f(!1),variant:"neutral"}]})]})]})}export{Oe as default};
