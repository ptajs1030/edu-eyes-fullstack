import{j as e,u as D,r as o,H as P,a as h}from"./app-DILUMODj.js";import{m as j}from"./proxy-yJxII8k4.js";import{A as _}from"./app-layout-C7YzT-KX.js";import{t as g,T as M}from"./index-kiHhjHCH.js";import"./button-BodouoRR.js";import"./index-CaK9bMaE.js";import"./index-CFvD6c4Y.js";import"./index-D2K6XBRW.js";import"./createLucideIcon-CNiEGURe.js";import"./app-logo-icon-Z6POH9h5.js";function y({isOpen:c,title:s,message:i,onConfirm:l,onCancel:d}){return c?e.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm",children:e.jsxs(j.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.1},className:"w-full max-w-xl rounded-lg bg-white p-6 shadow-xl",children:[e.jsx("h2",{className:"mb-4 text-lg font-bold",children:s}),e.jsx("p",{className:"mb-4",children:i}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:d,className:"rounded bg-gray-300 px-4 py-2 hover:cursor-pointer",children:"Cancel"}),e.jsx("button",{onClick:l,className:"rounded bg-blue-600 px-4 py-2 text-white hover:cursor-pointer",children:"Confirm"})]})]})}):null}const A=c=>[{title:"Tagihan",href:"/payments"},{title:c}];function F({transaction:c,payment:s}){const{flash:i}=D().props,[l,d]=o.useState({}),[N,m]=o.useState(!1),[v,x]=o.useState(!1);i!=null&&i.success&&g.success(i.success),i!=null&&i.error&&g.error(i.error);const S=c.filter(t=>t.student!==null),k=s.assignments.map(t=>{const a=t.student,n=S.find(r=>r.student&&r.student.id===a.id);return{student:a,transaction:n||{id:0,student:a,payment:s,payment_date:null}}}),[u,p]=o.useState(!1),w=()=>{var a;m(!1),p(!0);const t=Object.entries(l).map(([n,r])=>({id:Number(n),status:r}));h.patch(route("payments.updateTransactions",s.id),{transaction_ids:t.map(n=>n.id),status:(a=t[0])==null?void 0:a.status},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{d({}),g.success("Perubahan berhasil disimpan")},onError:()=>p(!1),onFinish:()=>p(!1)})},C=()=>{x(!1),h.visit(route("payments.index"))};return e.jsxs(_,{breadcrumbs:A(s.title),children:[e.jsx(P,{title:`Detail Tagihan - ${s.title}`}),e.jsx(M,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h1",{className:"mb-4 text-2xl font-bold",children:s.title}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Tenggat Pembayaran"}),e.jsx("p",{className:"mt-1",children:new Date(s.due_date).toLocaleDateString("id-ID")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Nominal"}),e.jsxs("p",{className:"mt-1",children:["Rp ",s.nominal.toLocaleString("id-ID")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Deskripsi"}),e.jsx("p",{className:"mt-1",children:s.description||"-"})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Daftar Pembayaran"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",s.assignments.length," peserta"]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tanggal Pembayaran"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:k.map(({student:t,transaction:a})=>{var b;const n=a.payment_date?"lunas":"belum",r=l[a.id],f=r??n;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.full_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:((b=t.classroom)==null?void 0:b.name)||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:a.payment_date||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("select",{value:f,onChange:T=>d({...l,[a.id]:T.target.value}),className:`rounded border px-2 py-1 text-sm ${f==="lunas"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("option",{value:"belum",children:"Belum Lunas"}),e.jsx("option",{value:"lunas",children:"Lunas"})]}),r&&r!==n&&e.jsx("span",{className:"mt-1 text-xs text-orange-600",children:"Perubahan belum disimpan"})]})})]},t.id)})})]}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[Object.keys(l).length>0&&e.jsx("button",{disabled:u,onClick:()=>m(!0),className:`rounded px-4 py-2 text-white ${u?"bg-gray-400":"bg-blue-500 hover:bg-blue-600"}`,children:u?"Menyimpan...":"Simpan Perubahan"}),e.jsx("button",{onClick:()=>{Object.keys(l).length>0?x(!0):h.visit(route("payments.index"))},className:"rounded bg-gray-200 px-4 py-2 text-sm font-medium text-gray-800 hover:bg-gray-300",children:"Kembali ke Daftar"})]})]})]})]}),e.jsx(y,{isOpen:N,title:"Konfirmasi Simpan",message:"Apakah Anda yakin ingin menyimpan perubahan ini?",onConfirm:w,onCancel:()=>m(!1)}),e.jsx(y,{isOpen:v,title:"Konfirmasi Kembali",message:"Ada perubahan yang belum disimpan. Yakin mau kembali ke daftar?",onConfirm:C,onCancel:()=>x(!1)})]})}export{F as default};
