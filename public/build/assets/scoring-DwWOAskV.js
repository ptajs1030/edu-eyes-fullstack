import{r as o,u as _,j as e,H as A,a as p}from"./app-C4jwBUjg.js";import{t as n,T}from"./index-boZ7SFx8.js";import{A as D}from"./app-layout-DxdMMKRX.js";/* empty css            */import"./index-C3x7a7PC.js";import"./button-DoWYOUnh.js";import"./index-CQFqO4Kw.js";import"./index-Bu5jGai6.js";import"./createLucideIcon-CBTiOSyS.js";import"./app-logo-icon-B6vckTTz.js";function M({exam:i}){const[m,u]=o.useState({}),[c,x]=o.useState({}),[h,g]=o.useState({}),{flash:l}=_().props,j=[{title:"Ujian",href:"/exams"},{title:"Penilaian",href:""}];o.useEffect(()=>{l!=null&&l.success&&n.success(l.success),l!=null&&l.error&&n.error(l.error)},[l]),o.useEffect(()=>{const t={};i.student_assignments.forEach(s=>{var a;t[s.id]=((a=s.score)==null?void 0:a.toString())||""}),u(t)},[i.student_assignments]);const f=(t,s)=>{(s===""||/^\d*\.?\d*$/.test(s))&&u(a=>({...a,[t]:s}))},N=t=>{x(s=>({...s,[t]:!0}))},b=t=>{var a;const s=(a=i.student_assignments.find(r=>r.id===t))==null?void 0:a.score;u(r=>({...r,[t]:(s==null?void 0:s.toString())||""})),x(r=>({...r,[t]:!1}))},S=async t=>{const s=m[t];if(s===""){n.error("Nilai tidak boleh kosong");return}const a=parseFloat(s);if(isNaN(a)||a<0||a>100){n.error("Nilai harus antara 0-100");return}g(r=>({...r,[t]:!0})),p.put(`/exams/${i.id}/assignments/${t}/score`,{score:a},{onSuccess:()=>{n.success("Nilai berhasil disimpan"),x(d=>({...d,[t]:!1}));const r=i.student_assignments.findIndex(d=>d.id===t);r!==-1&&(i.student_assignments[r].score=a)},onError:r=>{console.error("Error saving score:",r),n.error("Gagal menyimpan nilai"),b(t)},onFinish:()=>{g(r=>({...r,[t]:!1}))}})},v=async()=>{const t=Object.entries(m).filter(([a,r])=>{const d=parseFloat(r);return!isNaN(d)&&d>=0&&d<=100}).map(([a,r])=>({assignment_id:parseInt(a),score:parseFloat(r)}));if(t.length===0){n.error("Tidak ada nilai valid untuk disimpan");return}const s=n.loading("Menyimpan semua nilai...");p.put(`/exams/${i.id}/scores/bulk`,{scores:t},{onSuccess:a=>{n.dismiss(s),n.success("Semua nilai berhasil disimpan"),x({}),t.forEach(({assignment_id:r,score:d})=>{const y=i.student_assignments.findIndex(C=>C.id===r);y!==-1&&(i.student_assignments[y].score=d)})},onError:a=>{n.dismiss(s),console.error("Error saving bulk scores:",a),n.error("Gagal menyimpan nilai")},onFinish:()=>{n.dismiss(s)}})},k=t=>t===null?"text-gray-400":t>=80?"text-green-600":t>=60?"text-yellow-600":"text-red-600",E=t=>t===null?"Belum dinilai":"Sudah Dinilai",w=Object.keys(c).some(t=>c[parseInt(t)]);return e.jsxs(D,{breadcrumbs:j,children:[e.jsx(A,{title:`Penilaian - ${i.name}`}),e.jsx(T,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-6 border-b pb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:i.name}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tahun Ajaran"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:i.academic_year.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Mata Pelajaran"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:i.subject.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tipe"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:i.type||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tanggal"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:new Date(i.date).toLocaleDateString("id-ID")})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Student Assignments"}),w&&e.jsx("button",{onClick:v,className:"rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:"Simpan Semua Nilai"})]}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-200",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"NILAI"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"Action"})]})}),e.jsx("tbody",{children:i.student_assignments.map(t=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.student_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.class_name}),e.jsx("td",{className:"px-4 py-3 text-center",children:c[t.id]?e.jsx("input",{type:"text",value:m[t.id]||"",onChange:s=>f(t.id,s.target.value),className:"w-16 rounded border border-gray-300 px-2 py-1 text-center text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"0-100",autoFocus:!0}):e.jsx("span",{className:`text-sm font-medium ${k(t.score)}`,children:t.score!==null?t.score:"-"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${t.score===null?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800"}`,children:E(t.score)})}),e.jsx("td",{className:"px-4 py-3 text-center",children:c[t.id]?e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsx("button",{onClick:()=>S(t.id),disabled:h[t.id],className:"rounded bg-blue-500 px-2 py-1 text-xs text-white hover:bg-blue-600 disabled:opacity-50",children:h[t.id]?"...":"SAVE"}),e.jsx("button",{onClick:()=>b(t.id),disabled:h[t.id],className:"rounded bg-gray-500 px-2 py-1 text-xs text-white hover:bg-gray-600 disabled:opacity-50",children:"CANCEL"})]}):e.jsx("button",{onClick:()=>N(t.id),className:"rounded bg-yellow-500 px-3 py-1 text-xs text-white hover:bg-yellow-600",children:"EDIT"})})]},t.id))})]})})]}),e.jsxs("div",{className:"rounded-lg bg-blue-50 p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900",children:"Petunjuk:"}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-800",children:[e.jsx("li",{children:'• Klik tombol "EDIT" untuk mengubah nilai siswa'}),e.jsx("li",{children:"• Nilai harus antara 0-100"}),e.jsx("li",{children:'• Klik "SAVE" untuk menyimpan nilai atau "CANCEL" untuk membatalkan'}),e.jsx("li",{children:'• Jika ada beberapa perubahan, gunakan tombol "Simpan Semua Nilai" untuk menyimpan sekaligus'})]})]}),e.jsx("div",{className:"mt-6 flex justify-end border-t pt-6",children:e.jsx("button",{onClick:()=>p.get("/exams"),className:"rounded-lg border border-gray-300 bg-white px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Kembali ke Daftar Exam"})})]})]})}export{M as default};
