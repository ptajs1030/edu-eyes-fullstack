import{r,D as K,j as e,u as J,H as M,L as V,a as G}from"./app-Cl9VbZmE.js";import{A as H}from"./app-layout-CwRHq0j6.js";import{t as k,T as z}from"./index-BNS5INK1.js";/* empty css            */import"./button-BpTCOO0K.js";import"./index-p_E92kqk.js";import"./index-Cg4x4Wpx.js";import"./index-VCQxX_LZ.js";import"./createLucideIcon-BYL4H8Za.js";import"./app-logo-icon-D-5qQfPm.js";function U({value:o,onChange:_,placeholder:a="Search...",endpoint:N,options:l,initialOptions:x=[],showInitialOptions:m=!1,maxInitialOptions:I=10}){const[u,v]=r.useState(""),[f,p]=r.useState(!1),[h,w]=r.useState(!1),[j,y]=r.useState(x),[L,P]=r.useState(x),c=r.useRef(null),S=r.useRef(null),C=r.useRef(null),D=l&&l.length>0?l:L,F=j.filter(t=>t&&t.name&&typeof t.name=="string"&&t.name.toLowerCase().includes(u.toLowerCase())&&!o.includes(t.id)),E=D.filter(t=>o.includes(t.id));r.useEffect(()=>{const t=i=>{c.current&&!c.current.contains(i.target)&&p(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),r.useEffect(()=>{m&&N&&j.length===0&&g("")},[m,N,j.length]);const g=async t=>{if(N){w(!0);try{const i=await K.get(N,{params:{query:t},withCredentials:!0}),A=(Array.isArray(i.data)?i.data:[]).map(b=>({id:b.id||"",name:b.name||b.full_name||""})).filter(b=>b.id&&b.name).slice(0,I);y(A),P(b=>{const B=[...b];return A.forEach(R=>{B.some(q=>q.id===R.id)||B.push(R)}),B}),p(!0)}catch(i){console.error("Error fetching options:",i),y([])}finally{w(!1)}}},O=t=>{const i=t.target.value;if(v(i),C.current&&clearTimeout(C.current),m&&i===""){g("");return}C.current=setTimeout(()=>{i.length>=1||m&&i.length===0?g(i):(y([]),p(!1))},300)},T=t=>{!t||!t.id||(_([...o,t.id]),v(""),p(!1),S.current&&S.current.focus())},s=t=>{_(o.filter(i=>i!==t))},d=()=>{m&&j.length===0&&g(""),p(!0)},n=t=>{if(t.key==="Enter"){t.preventDefault(),u.trim()!==""?g(u):m&&g("");return}t.key==="Backspace"&&u===""&&o.length>0&&s(o[o.length-1])};return e.jsxs("div",{className:"relative",ref:c,children:[e.jsxs("div",{className:"flex flex-wrap mt-1 items-center gap-1 border p-2 border-gray-300 rounded-md shadow-sm bg-white cursor-text",onClick:()=>{var t;return(t=S.current)==null?void 0:t.focus()},children:[E.map(t=>t&&e.jsxs("span",{className:"inline-flex items-center rounded bg-blue-100 px-2 py-1 text-xs font-medium text-blue-800",children:[t.name,e.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),s(t.id)},className:"ml-1 text-blue-600 hover:text-blue-800 hover:cursor-pointer",children:"×"})]},t.id)),e.jsx("input",{ref:S,type:"text",value:u,onChange:O,onFocus:d,onKeyDown:n,placeholder:E.length===0?a:"",className:"flex-1 min-w-[120px] outline-none bg-transparent",style:{minWidth:"120px"}})]}),f&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md border max-h-60 overflow-auto",children:h?e.jsx("div",{className:"py-2 px-3 text-gray-500",children:"Loading..."}):F.length===0?e.jsx("div",{className:"py-2 px-3 text-gray-500",children:"Tidak ditemukan"}):F.map(t=>t&&e.jsx("div",{onClick:()=>T(t),className:"px-3 py-2 hover:bg-gray-100 cursor-pointer",children:t.name},t.id))})]})}const W=o=>[{title:"Events",href:"/events"},{title:o?"Edit Event":"Buat Event Baru"}];function ie({teachers:o,classrooms:_,event:a,selectedStudents:N=[]}){const[l,x]=r.useState({name:(a==null?void 0:a.name)||"",description:(a==null?void 0:a.description)||"",start_date:(a==null?void 0:a.start_date)||"",end_date:(a==null?void 0:a.end_date)||"",start_hour:(a==null?void 0:a.start_hour)||"",end_hour:(a==null?void 0:a.end_hour)||""}),[m,I]=r.useState(a!=null&&a.pics?a.pics.map(s=>s.user.id):[]),[u,v]=r.useState(null),[f,p]=r.useState([]),[h,w]=r.useState(N),[j,y]=r.useState([]),[L,P]=r.useState(!1),{flash:c}=J().props;r.useEffect(()=>{c!=null&&c.success&&k.success(c.success),c!=null&&c.error&&k.error(c.error)},[c]);const S=o.map(s=>({id:s.id,name:s.full_name}));r.useEffect(()=>{u&&C(u)},[u]),r.useEffect(()=>{h.length>0?D(h):y([])},[h]);const C=async s=>{P(!0);try{const d=await fetch(route("students.by-class",s));if(!d.ok)throw new Error("Failed to fetch students");const n=await d.json();p(n)}catch{k.error("Gagal memuat data siswa"),p([])}finally{P(!1)}},D=async s=>{try{const d=await fetch(route("students.get-by-ids",{ids:s.join(",")}));if(!d.ok)throw new Error("Failed to fetch student info");const n=await d.json();y(n)}catch{k.error("Gagal memuat data siswa terpilih"),y([])}},F=s=>{v(s),p([])},E=s=>{w(d=>d.includes(s)?d.filter(n=>n!==s):[...d,s])},g=s=>{const d=f.map(n=>n.id);w(s?n=>{const t=[...n];return d.forEach(i=>{t.includes(i)||t.push(i)}),t}:n=>n.filter(t=>!d.includes(t)))},O=s=>{if(s.preventDefault(),h.length===0){k.error("Pilih minimal 1 peserta");return}if(m.length===0){k.error("Pilih minimal 1 PIC");return}const d=a!=null&&a.id?`/events/${a.id}`:"/events",n=a!=null&&a.id?"put":"post";G[n](d,{...l,pics:m.map(t=>({id:t})),selected_students:h},{onSuccess:()=>{},onError:()=>{}})},T=f.length>0&&f.every(s=>h.includes(s.id));return e.jsxs(H,{breadcrumbs:W(!!(a!=null&&a.id)),children:[e.jsx(M,{title:a!=null&&a.id?"Edit Event":"Buat Event Baru"}),e.jsx(z,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[e.jsx("h1",{className:"text-2xl font-bold",children:a!=null&&a.id?"Edit Event":"Buat Event Baru"}),e.jsxs("form",{onSubmit:O,className:"flex flex-col gap-6",children:[e.jsx("div",{className:"rounded-lg border p-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Nama Event*"}),e.jsx("input",{id:"name",type:"text",placeholder:"Nama kegiatan",maxLength:70,value:l.name,onChange:s=>x({...l,name:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{htmlFor:"pics",className:"block text-sm font-medium text-gray-700",children:"PIC (Penanggung Jawab)*"}),e.jsx(U,{value:m,onChange:I,placeholder:"Cari guru...",endpoint:route("teachers.search"),initialOptions:S,showInitialOptions:!0,maxInitialOptions:10})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"start_hour",className:"block text-sm font-medium text-gray-700",children:"Jam Mulai*"}),e.jsx("input",{type:"time",id:"start_hour",value:l.start_hour,onChange:s=>x({...l,start_hour:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"end_hour",className:"block text-sm font-medium text-gray-700",children:"Jam Selesai*"}),e.jsx("input",{type:"time",id:"end_hour",value:l.end_hour,min:l.start_hour,onChange:s=>x({...l,end_hour:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"start_date",className:"block text-sm font-medium text-gray-700",children:"Tanggal Mulai*"}),e.jsx("input",{id:"start_date",type:"date",value:l.start_date,min:new Date().toISOString().split("T")[0],onChange:s=>x({...l,start_date:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"end_date",className:"block text-sm font-medium text-gray-700",children:"Tanggal Selesai*"}),e.jsx("input",{id:"end_date",type:"date",value:l.end_date,min:l.start_date,onChange:s=>x({...l,end_date:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Deskripsi"}),e.jsx("textarea",{id:"description",value:l.description,onChange:s=>x({...l,description:s.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",rows:4,required:!0})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Pilih Peserta"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Kelas"}),e.jsxs("select",{value:u||"",onChange:s=>F(Number(s.target.value)),className:"w-full rounded border p-2",children:[e.jsx("option",{value:"",children:"Pilih Kelas"}),_.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),L?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-blue-500 border-t-transparent"})}):f.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[f.length," siswa ditemukan"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:s=>g(s.target.checked),className:"rounded border-gray-300 text-indigo-600 hover:cursor-pointer"}),"Pilih Semua"]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto rounded-lg border",children:e.jsx("div",{className:"divide-y divide-gray-200",children:f.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.full_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["NIS: ",s.nis||"-"]})]}),e.jsx("input",{type:"checkbox",checked:h.includes(s.id),onChange:()=>E(s.id),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 hover:cursor-pointer"})]},s.id))})})]}):e.jsx("div",{className:"rounded-lg border bg-gray-50 p-6 text-center",children:e.jsx("div",{className:"text-gray-400",children:u?"Tidak ada siswa di kelas ini":"Pilih kelas untuk melihat siswa"})})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("h2",{className:"mb-4 text-lg font-semibold",children:["Peserta Terpilih (",h.length,")"]}),j.length>0?e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"max-h-96 divide-y divide-gray-200 overflow-y-auto rounded-lg border border-gray-200",children:j.map(s=>{var d,n;return e.jsxs("div",{className:"flex items-center justify-between bg-white p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.full_name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsx("span",{children:((d=_.find(t=>t.id===s.class_id))==null?void 0:d.name)||((n=s.classroom)==null?void 0:n.name)||"-"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["NIS: ",s.nis||"-"]})]})]}),e.jsx("button",{type:"button",onClick:()=>E(s.id),className:"text-red-500 hover:cursor-pointer hover:text-red-700",children:"✕"})]},s.id)})})}):e.jsx("div",{className:"rounded-lg border bg-gray-50 p-6 text-center",children:e.jsx("div",{className:"text-gray-400",children:"Belum ada peserta terpilih"})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(V,{href:route("events.index"),className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"submit",className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:cursor-pointer hover:bg-blue-700",children:a!=null&&a.id?"Update":"Simpan"})]})]})]})]})}export{ie as default};
