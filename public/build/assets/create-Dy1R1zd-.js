import{C as M,r as m,u as T,j as e,H as A,a as L}from"./app-CXEzde8B.js";import{t as n,T as B}from"./index-b_a1n12s.js";import{A as U}from"./app-layout-C2YSQJUl.js";import{S as E}from"./student-assignment-modal-wrDTibRw.js";/* empty css            */import"./index-DEDOldg8.js";import"./button-B0OZNl9H.js";import"./index-T0USjLpq.js";import"./index-DtG-Ly1x.js";import"./createLucideIcon-muKrIsa_.js";import"./app-logo-icon-t09rzfAw.js";const H=[{title:"Ujian",href:"/exams"},{title:"Buat Ujian Baru",href:""}];function V({subjects:h,academicYears:x,classrooms:p}){const l=Array.isArray(x)?x.find(t=>t.status==="active"):void 0,{data:s,setData:d,post:b,processing:g}=M({academic_year_id:(l==null?void 0:l.id)||"",subject_id:"",name:"",type:"",date:"",student_assignments:[]}),[y,c]=m.useState(!1),[j,f]=m.useState(0),[N,v]=m.useState(0),{errors:r,flash:i}=T().props;m.useEffect(()=>{i!=null&&i.success&&(console.log("Showing success toast:",i.success),n.success(i.success)),i!=null&&i.error&&(console.log("Showing error toast:",i.error),n.error(i.error)),r&&Object.keys(r).length>0&&Object.values(r).forEach(a=>{n.error(a)})},[i,r]);const _=t=>{if(t.preventDefault(),!Array.isArray(s.student_assignments)||s.student_assignments.length===0){n.error("Minimal harus memilih 1 siswa untuk exam ini");return}const a=n.loading("Menyimpan exam...");b("/exams",{onSuccess:()=>{n.dismiss(a)},onError:o=>{n.dismiss(a),o.student_assignments?n.error("Terjadi kesalahan pada data siswa yang dipilih"):o.name?n.error("Nama ujian tidak valid"):o.subject_id?n.error("Mata pelajaran harus dipilih"):n.error("Terjadi kesalahan validasi data")},onFinish:()=>{n.dismiss(a)}})},w=t=>{const a=t.target.value;a.length<=70&&(d("name",a),f(a.length))},S=t=>{const a=t.target.value;a.length<=70&&(d("type",a),v(a.length))},k=t=>{const a=s.student_assignments.map(u=>u.student_id),o=t.filter(u=>!a.includes(u.student_id));d("student_assignments",[...s.student_assignments,...o]),c(!1),n.success(`${o.length} siswa berhasil ditambahkan`)},C=t=>{d("student_assignments",s.student_assignments.filter(a=>a.student_id!==t)),n.success("Siswa berhasil dihapus dari exam")};return e.jsxs(U,{breadcrumbs:H,children:[e.jsx(A,{title:"Buat Ujian"}),e.jsx(B,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsx("h2",{className:"mb-6 text-2xl font-semibold text-gray-900",children:"Buat Ujian Baru"}),e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tahun Ajaran"}),e.jsx("input",{type:"text",value:(l==null?void 0:l.title)||"",disabled:!0,className:"w-full rounded-lg border border-gray-300 bg-gray-100 px-4 py-2 text-gray-600"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Auto fill disabled, taken from active academic_year"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mata Pelajaran *"}),e.jsxs("select",{value:typeof s.subject_id=="string"||typeof s.subject_id=="number"?s.subject_id:"",onChange:t=>d("subject_id",t.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Pilih mata pelajaran"}),h.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Dropdown, taken from table subjects"}),r.subject_id&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.subject_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nama Ujian *"}),e.jsx("input",{type:"text",value:typeof s.name=="string"||typeof s.name=="number"?s.name:"",onChange:w,className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Masukkan nama ujian",required:!0}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["String, max 70 char (",j,"/70)"]}),r.name&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipe (optional)"}),e.jsx("input",{type:"text",value:typeof s.type=="string"||typeof s.type=="number"?s.type:"",onChange:S,className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Contoh: Ulangan Harian, Quiz, UTS, UAS"}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["String, max 70 char (optional) (",N,"/70)"]}),r.type&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.type})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tanggal Pelaksanaan*"}),e.jsx("input",{type:"date",value:typeof s.date=="string"?s.date:"",onChange:t=>d("date",t.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Select date (dateonly) in calendar"}),r.date&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.date})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Student Assignments"})}),s.student_assignments.length>0?e.jsx("div",{className:"mb-4 overflow-hidden rounded-lg border border-gray-200",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Action"})]})}),e.jsx("tbody",{children:s.student_assignments.map((t,a)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:t.student_name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.class_name}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("button",{type:"button",onClick:()=>C(t.student_id),className:"flex items-center gap-1 rounded bg-red-500 px-2 py-1 text-xs text-white hover:bg-red-600",children:[e.jsx("svg",{className:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Remove"]})})]},t.student_id))})]})}):e.jsx("div",{className:"mb-4 rounded-lg border-2 border-dashed border-gray-300 p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Belum ada siswa yang di-assign ke exam ini"})}),e.jsxs("button",{type:"button",onClick:()=>c(!0),className:"flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Tambah Siswa"]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t",children:[e.jsx("button",{type:"button",onClick:()=>L.get("/exams"),className:"rounded-lg border border-gray-300 bg-white px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:g,className:"rounded-lg bg-blue-600 px-6 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",children:g?"Menyimpan...":"Submit"})]})]})]}),e.jsx(E,{isOpen:y,onClose:()=>c(!1),onSubmit:k,classrooms:p,assignedStudentIds:s.student_assignments.map(t=>t.student_id)})]})}export{V as default};
