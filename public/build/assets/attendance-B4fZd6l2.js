import{u as W,r as u,j as e,H as q,a as y,L as z}from"./app-CpN3_quc.js";import{P as G}from"./pagination--xCrqP-P.js";import{A as Q}from"./app-layout-B_b9hzy5.js";import{t as N,T as X}from"./index-CbTlgibL.js";import Y from"./editAttendance-CqWtw1Ih.js";/* empty css            */import"./button-B_tmRQwO.js";import"./index-CGSd29uJ.js";import"./index-CCbUnfIf.js";import"./index-DwGUaSwA.js";import"./createLucideIcon-g8MRwZZ7.js";import"./app-logo-icon-pNU_cU9r.js";import"./form-modal-BvwHc7h5.js";import"./proxy-BR4URNsY.js";const Z=a=>[{title:"Kegiatan",href:"/events"},{title:a}];function pe({event:a,attendances:c,canEditAttendance:S,filters:g}){const{flash:o}=W().props,[L,k]=u.useState(null),r=g.dates??[],[M,w]=u.useState(!1),[C,v]=u.useState(!1),[p,j]=u.useState([]),_=u.useRef(null),h=typeof(g==null?void 0:g.limit)<"u"?g.limit:10;u.useEffect(()=>{j([])},[r,h]);const A=t=>({__html:t}),K=()=>{if(p.length===0)return;const t=c.data.filter(l=>p.includes(l.id)),s={};t.forEach(l=>{s[l.submit_date]||(s[l.submit_date]=[]),s[l.submit_date].push(l)});const x=Object.keys(s).sort((l,m)=>new Date(l).getTime()-new Date(m).getTime()),n=["Tanggal","Nama","NIS","Kelas","Status","Jam Masuk","Jam Keluar","Keterlambatan","Catatan"],i=l=>{const m=String(l??"");return m.includes(",")||m.includes('"')||m.includes(`
`)?'"'+m.replace(/"/g,'""')+'"':m},D=[];D.push(n.map(i).join(",")),x.forEach(l=>{s[l].forEach((d,U)=>{var I;const V=new Date(d.submit_date).toLocaleDateString("id-ID");D.push([U===0?i(V):"",i(d.student.full_name),i(d.student.nis||"-"),i(((I=d.student.classroom)==null?void 0:I.name)||"-"),i(T(d.status)),i(d.clock_in_hour||"-"),i(d.clock_out_hour||"-"),i(d.minutes_of_late!==null?`${d.minutes_of_late} Menit`:"-"),i(d.note||"-")].join(","))})});const B=D.join(`\r
`),P=new Blob([B],{type:"text/csv;charset=utf-8;"}),E=URL.createObjectURL(P),b=document.createElement("a");b.href=E,b.setAttribute("download",`attendance_event_${a.id}.csv`),document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(E),N.success("Data berhasil diekspor ke CSV!")},R=t=>{j(t?c.data.map(s=>s.id):[])},O=t=>{j(s=>s.includes(t)?s.filter(x=>x!==t):[...s,t])};o!=null&&o.success?N.success(o.success):o!=null&&o.error&&N.error(o.error);const f=u.useMemo(()=>{const t=[],s=new Date(a.start_date),x=new Date(a.end_date);for(let n=new Date(s);n<=x;n.setDate(n.getDate()+1))t.push(n.toISOString().split("T")[0]);return t},[a.start_date,a.end_date]),F=()=>{let t;r.length===f.length?t=[]:t=[...f];const s={dates:t,limit:h,page:1};y.get(route("events.attendance",a.id),s,{preserveState:!0})},H=t=>{let s;r.includes(t)?s=r.filter(n=>n!==t):s=[...r,t];const x={dates:s,limit:h,page:1};y.get(route("events.attendance",a.id),x,{preserveState:!0})},$=t=>{y.patch(route("events.attendance.update",a.id),t,{preserveScroll:!0,onSuccess:()=>{N.success("Kehadiran berhasil diperbarui"),w(!1),k(null)}})},J=t=>{switch(t){case"present":return"bg-green-100 text-green-800 border-green-200";case"present_in_tolerance":return"bg-blue-100 text-blue-800 border-blue-200";case"late":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"alpha":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},T=t=>{switch(console.log({status:t}),t){case"present":return"Hadir";case"present_in_tolerance":return"Hadir (Toleransi)";case"late":return"Terlambat";case"alpha":return"Tidak Masuk";default:return"Belum Diisi"}};return u.useEffect(()=>{const t=s=>{_.current&&!_.current.contains(s.target)&&v(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]),e.jsxs(Q,{breadcrumbs:Z(a.name),children:[e.jsx(q,{title:`Detail Event - ${a.name}`}),e.jsx(X,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[e.jsxs("div",{className:"rounded-lg border p-6",children:[e.jsx("h1",{className:"mb-6 text-2xl font-bold text-gray-900",children:a.name}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold tracking-wide text-gray-700 uppercase",children:"Informasi Waktu"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Tanggal"}),e.jsxs("p",{className:"text-gray-900",children:[new Date(a.start_date).toLocaleDateString("id-ID"),a.start_date!==a.end_date&&e.jsxs(e.Fragment,{children:[" - ",new Date(a.end_date).toLocaleDateString("id-ID")]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Jam"}),e.jsxs("p",{className:"text-gray-900",children:[a.start_hour," - ",a.end_hour]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold tracking-wide text-gray-700 uppercase",children:"Penanggung Jawab"}),e.jsx("div",{className:"space-y-2",children:a.event_pics.length>0?a.event_pics.map((t,s)=>e.jsx("p",{className:"text-gray-900",children:t.user.full_name},s)):e.jsx("p",{className:"text-gray-500",children:"-"})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold tracking-wide text-gray-700 uppercase",children:"Deskripsi"}),e.jsx("div",{className:"text-gray-700",children:a.description?e.jsx("div",{className:"rich-text-content text-sm leading-relaxed",dangerouslySetInnerHTML:A(a.description)}):e.jsx("p",{className:"text-gray-500 italic",children:"Tidak ada deskripsi"})})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Daftar Kehadiran"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("select",{value:h,onChange:t=>{const s=t.target.value,n={limit:s==="all"?"all":Number(s),page:1};r.length>0&&(n.dates=r),y.get(route("events.attendance",a.id),n,{preserveState:!0})},className:"rounded-lg border border-gray-300 bg-white px-3 py-1 text-sm text-gray-700",children:[e.jsx("option",{value:10,children:"Show 10 data"}),e.jsx("option",{value:20,children:"Show 20 data"}),e.jsx("option",{value:"all",children:"Show All"})]}),e.jsx("button",{onClick:K,disabled:p.length===0,className:`rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700 ${p.length===0?"cursor-not-allowed opacity-50":""}`,children:"Ekspor CSV"}),e.jsxs("div",{className:"relative",ref:_,children:[e.jsxs("button",{onClick:()=>v(!C),className:"flex items-center gap-2 rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filter Tanggal",r.length>0&&e.jsx("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-blue-800 text-xs",children:r.length})]}),C&&e.jsxs("div",{className:"absolute top-full right-0 z-10 mt-2 w-80 rounded-lg border border-gray-200 bg-white p-4 shadow-lg",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Filter Berdasarkan Tanggal"}),e.jsx("button",{onClick:()=>v(!1),className:"text-gray-400 hover:cursor-pointer hover:text-gray-600",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:r.length===f.length,onChange:F,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Pilih Semua Tanggal"})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto border-t border-gray-200 pt-3",children:f.map(t=>e.jsxs("label",{className:"flex items-center space-x-2 py-1",children:[e.jsx("input",{type:"checkbox",checked:r.includes(t),onChange:()=>H(t),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:new Date(t).toLocaleDateString("id-ID",{weekday:"short",year:"numeric",month:"short",day:"numeric"})})]},t))}),e.jsxs("div",{className:"flex justify-between border-t border-gray-200 pt-3",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[r.length," tanggal dipilih"]}),e.jsx("button",{onClick:()=>{const t={dates:[],limit:h,page:1};y.get(route("events.attendance",a.id),t,{preserveState:!0})},className:"text-sm text-blue-600 hover:cursor-pointer hover:text-blue-800",children:"Reset Filter"})]})]})]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.length===c.data.length&&c.data.length>0,onChange:t=>R(t.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tanggal"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Jam Masuk"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Jam Keluar"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Keterlambatan"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Catatan"}),S&&e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:c.data.map(t=>{var s;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:p.includes(t.id),onChange:()=>O(t.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:new Date(t.submit_date).toLocaleDateString("id-ID")}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.student.full_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.student.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:((s=t.student.classroom)==null?void 0:s.name)||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`inline-block rounded px-2 py-1 text-xs font-semibold ${J(t.status)}`,children:T(t.status)})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.clock_in_hour||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.clock_out_hour||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.minutes_of_late!==null?`${t.minutes_of_late} Menit`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.note||"-"}),S&&e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{className:"rounded bg-blue-500 px-3 py-1 text-sm font-medium text-white hover:bg-blue-600",onClick:()=>{k(t),w(!0)},children:"Edit"})})]},`${t.submit_date}-${t.student.id}`)})})]})}),e.jsx("div",{className:"mt-4",children:c.links&&c.links.length>0?e.jsx(G,{links:c.links,dates:r,limit:h}):e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{disabled:!0,className:"rounded bg-gray-100 px-3 py-1 text-sm text-black",dangerouslySetInnerHTML:{__html:"&laquo;"}}),e.jsx("button",{className:"rounded bg-blue-500 px-3 py-1 text-sm font-bold text-white",children:"1"}),e.jsx("button",{disabled:!0,className:"rounded bg-gray-100 px-3 py-1 text-sm text-black",dangerouslySetInnerHTML:{__html:"&raquo;"}})]})}),c.data.length===0&&e.jsx("div",{className:"mt-4 text-center text-gray-500",children:"Tidak ada data kehadiran untuk tanggal yang dipilih"})]}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx(z,{href:route("events.index"),className:"rounded-md bg-gray-200 px-4 py-2 text-sm font-medium text-gray-800 hover:bg-gray-300",children:"Kembali ke Daftar Event"})})]}),M&&L&&e.jsx(Y,{attendance:L,onClose:()=>{w(!1),k(null)},onSubmit:$})]})}export{pe as default};
