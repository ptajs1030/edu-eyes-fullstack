import{r as x,u as E,j as t,H as I,a as c,L as j}from"./app-QZ3OdksW.js";import{A as N}from"./action-modal-Dr8HpgZG.js";import{P as L}from"./pagination-BvCPm8kt.js";import{T as H}from"./table-CYlGmVZU.js";import{A as O}from"./app-layout-5gKZ6ZAs.js";import{t as y,T as R}from"./index-C2yOkZ_H.js";/* empty css            */import"./proxy-ta45JBII.js";import"./createLucideIcon-BRt2U9p_.js";import"./button-f0kX3KFh.js";import"./index-LYl8HVmj.js";import"./index-_BLXYr7V.js";import"./index-Dm1HRYKN.js";import"./app-logo-icon-CxRKZBKw.js";const B=[{title:"Tugas",href:""}];function Z({tasks:u,filters:i}){const[a,w]=x.useState([]),[l,m]=x.useState(null),[d,p]=x.useState(null),{flash:n}=E().props;x.useEffect(()=>{n!=null&&n.success&&y.success(n.success),n!=null&&n.error&&y.error(n.error)},[n]);const T=e=>{w(s=>s.includes(e)?s.filter(r=>r!==e):[...s,e])},C=()=>{if(a.length===0)return;const e=u.data.filter(o=>a.includes(o.id)),s=`Title,Description,Due Date,Due Time,Attachments
`,r=e.map(o=>{const S=o.attachments.map($=>$.url).join("; ");return`"${o.title}","${o.description}","${o.due_date}","${o.due_time}","${S}"`}).join(`
`),g=new Blob([s,r],{type:"text/csv"}),b=URL.createObjectURL(g),f=document.createElement("a");f.href=b,f.download="tasks.csv",f.click(),y.success(`Berhasil mengekspor ${e.length} data tugas`,{description:"File CSV telah didownload otomatis"})},D=e=>e?new Date(e).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",k=e=>e?e.length===5?e:e.substring(0,5):"-",v=[{key:"title",label:"Judul",sortable:!0},{key:"description",label:"Deskripsi",sortable:!1},{key:"due_date",label:"Tanggal Tenggat",sortable:!0},{key:"due_time",label:"Waktu Tenggat ",sortable:!0},{key:"attachments.url",label:"Lampiran",sortable:!1},{key:"actions",label:"Aksi",sortable:!1}],_=e=>{c.get(route("tasks.index"),{sort:e,direction:i.direction==="asc"?"desc":"asc"})},A=e=>{c.delete(route("tasks.destroy",e),{onSuccess:()=>{c.reload()}})},h=e=>{const s=new Date,r=new Date(e.due_date);if(isNaN(r.getTime()))return console.error("Invalid base date:",e.due_date),!0;if(e.due_time){const[g,b]=e.due_time.split(":");r.setHours(parseInt(g),parseInt(b),0,0)}else r.setHours(23,59,59,999);return s>r};return t.jsxs(O,{breadcrumbs:B,children:[t.jsx(I,{title:"Daftar Tugas"}),t.jsx(R,{position:"top-right",richColors:!0}),t.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",placeholder:"Cari Tugas...",defaultValue:i.search||"",onChange:e=>c.get(route("tasks.index"),{search:e.target.value}),className:"w-64 rounded border px-3 py-1"}),t.jsx("button",{disabled:a.length===0,onClick:C,className:`rounded bg-indigo-600 px-3 py-1 text-sm font-medium text-white hover:bg-indigo-700 ${a.length===0?"cursor-not-allowed opacity-50":"hover:cursor-pointer"}`,children:"Ekspor data yang dipilih"})]}),t.jsx(j,{href:route("tasks.create"),className:"rounded bg-green-600 px-3 py-1 text-sm font-medium text-white transition hover:cursor-pointer hover:bg-green-700",children:"Buat Tugas"})]}),t.jsx(H,{headers:v,data:u.data,sortColumn:i.sort||"",sortDirection:i.direction==="asc"||i.direction==="desc"?i.direction:"asc",onSort:_,onSelectAll:e=>w(e?u.data.map(s=>s.id):[]),selectedIds:a,emptyMessage:"Tugas Tidak Ditemukan.",rowRender:e=>t.jsxs("tr",{className:"border-b",children:[t.jsx("td",{className:"w-[10px] p-3 text-sm",children:t.jsx("input",{type:"checkbox",checked:a.includes(e.id),onChange:()=>T(e.id)})}),t.jsxs("td",{className:"p-3 text-sm",children:[e.title," ",h(e)]}),t.jsx("td",{className:"p-3 text-sm",children:e.description&&e.description.length>70?`${e.description.substring(0,70)}...`:e.description||"-"}),t.jsx("td",{className:"p-3 text-sm",children:D(e.due_date)}),t.jsx("td",{className:"p-3 text-sm",children:k(e.due_time)}),t.jsx("td",{className:"p-3 text-sm",children:e.attachments&&e.attachments.length>0?e.attachments.map((s,r)=>t.jsx("div",{children:t.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:["lampiran ",r+1]})},r)):t.jsx("span",{children:"-"})}),t.jsxs("td",{className:"flex gap-2 p-3",children:[t.jsx(j,{href:route("tasks.edit",e.id),className:"rounded bg-blue-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Edit"}),t.jsx(j,{href:route("tasks.show",e.id),className:"rounded bg-sky-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Detail"}),t.jsx("button",{onClick:()=>p(e),disabled:h(e),className:`rounded px-3 py-1 text-sm font-medium text-white ${h(e)?"cursor-not-allowed bg-sky-300":"bg-sky-500 hover:cursor-pointer"}`,title:h(e)?"Tugas sudah melewati deadline":"Kirim notifikasi",children:"Kirim Notif"}),t.jsx("button",{onClick:()=>m(e),className:"rounded bg-red-500 px-3 py-1 text-sm font-medium text-white hover:cursor-pointer",children:"Hapus"})]})]},e.id)}),t.jsx(L,{links:u.links}),t.jsx(N,{isOpen:!!l,onClose:()=>m(null),title:"Confirm Deletion",message:t.jsxs("span",{children:["Are you sure you want to delete task ",t.jsx("strong",{children:l==null?void 0:l.title}),"?"]}),buttons:[{label:"Cancel",onClick:()=>m(null),variant:"neutral"},{label:"Delete",onClick:()=>{l&&(A(l.id),m(null))},variant:"danger"}]}),t.jsx(N,{isOpen:!!d,onClose:()=>p(null),title:"Confirm Notification",message:t.jsxs("span",{children:["Are you sure you want to send notification for task ",t.jsx("strong",{children:d==null?void 0:d.title}),"?"]}),buttons:[{label:"Cancel",onClick:()=>p(null),variant:"neutral"},{label:"Send Notification",onClick:()=>{d&&(c.post(route("tasks.resend-notification",d.id)),p(null))},variant:"primary"}]})]})]})}export{Z as default};
