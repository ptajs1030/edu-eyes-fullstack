import{r as l,D,j as s,u as R,H as O,L as q,a as A}from"./app-D8XG0Rmg.js";import{A as K}from"./app-layout-CGQ0l1vE.js";import{t as w,T as J}from"./index-CEvaMyb9.js";/* empty css            */import"./button-CTsKmUot.js";import"./index-jsT1uCmf.js";import"./index-BPtrcz-m.js";import"./index-BeS7fM6n.js";import"./createLucideIcon-BPgAGPHC.js";import"./app-logo-icon-qRSlk0Tl.js";function M({value:n,onChange:S,placeholder:t="Search...",endpoint:j,options:r,initialOptions:x=[],showInitialOptions:c=!1,maxInitialOptions:P=10}){const[u,C]=l.useState(""),[p,m]=l.useState(!1),[o,y]=l.useState(!1),[g,f]=l.useState(x),k=l.useRef(null),b=l.useRef(null),i=l.useRef(null),E=g.filter(e=>n.includes(e.id));l.useEffect(()=>{const e=a=>{k.current&&!k.current.contains(a.target)&&m(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),l.useEffect(()=>{c&&j&&g.length===0&&N("")},[c,j,g.length]),l.useEffect(()=>{r&&r.length>0&&f(r)},[r]);const N=async e=>{if(j){y(!0);try{const d=(await D.get(j,{params:{query:e},withCredentials:!0})).data.slice(0,P);f(d),m(!0)}catch(a){console.error("Error fetching options:",a),f([])}finally{y(!1)}}},I=e=>{const a=e.target.value;if(C(a),i.current&&clearTimeout(i.current),c&&a===""){N("");return}i.current=setTimeout(()=>{a.length>=1||c&&a.length===0?N(a):(f([]),m(!1))},300)},F=e=>{S([...n,e.id]),C(""),m(!1),b.current&&b.current.focus()},_=e=>{S(n.filter(a=>a!==e))},L=()=>{c&&g.length===0&&N(""),m(!0)},T=e=>{e.key==="Backspace"&&u===""&&n.length>0&&_(n[n.length-1])},v=g.filter(e=>e.name.toLowerCase().includes(u.toLowerCase())&&!n.includes(e.id));return s.jsxs("div",{className:"relative",ref:k,children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-1 border border-gray-300 rounded-md px-3 py-2 min-h-[42px] cursor-text",onClick:()=>{var e;return(e=b.current)==null?void 0:e.focus()},children:[E.map(e=>s.jsxs("span",{className:"inline-flex items-center rounded bg-blue-100 px-2 py-1 text-xs font-medium text-blue-800",children:[e.name,s.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),_(e.id)},className:"ml-1 text-blue-600 hover:text-blue-800 hover:cursor-pointer",children:"×"})]},e.id)),s.jsx("input",{ref:b,type:"text",value:u,onChange:I,onFocus:L,onKeyDown:T,placeholder:E.length===0?t:"",className:"flex-1 min-w-[120px] outline-none bg-transparent",style:{minWidth:"120px"}})]}),p&&s.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md border max-h-60 overflow-auto",children:o?s.jsx("div",{className:"py-2 px-3 text-gray-500",children:"Loading..."}):v.length===0?s.jsx("div",{className:"py-2 px-3 text-gray-500",children:"Tidak ditemukan"}):v.map(e=>s.jsx("div",{onClick:()=>F(e),className:"px-3 py-2 hover:bg-gray-100 cursor-pointer",children:e.name},e.id))})]})}const V=n=>[{title:"Events",href:"/events"},{title:n?"Edit Event":"Buat Event Baru"}];function ee({teachers:n,classrooms:S,event:t,selectedStudents:j=[]}){const[r,x]=l.useState({name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||"",start_date:(t==null?void 0:t.start_date)||"",end_date:(t==null?void 0:t.end_date)||"",start_hour:(t==null?void 0:t.start_hour)||"",end_hour:(t==null?void 0:t.end_hour)||""}),[c,P]=l.useState(t!=null&&t.pics?t.pics.map(e=>e.user.id):[]),[u,C]=l.useState(null),[p,m]=l.useState([]),[o,y]=l.useState(j),[g,f]=l.useState([]),[k,b]=l.useState(!1),{flash:i}=R().props;l.useEffect(()=>{i!=null&&i.success&&w.success(i.success),i!=null&&i.error&&w.error(i.error)},[i]);const E=n.map(e=>({id:e.id,name:e.full_name}));l.useEffect(()=>{u&&N(u)},[u]),l.useEffect(()=>{o.length>0?I(o):f([])},[o]);const N=async e=>{b(!0);try{const a=await fetch(route("students.by-class",e));if(!a.ok)throw new Error("Failed to fetch students");const d=await a.json();m(d)}catch{w.error("Gagal memuat data siswa"),m([])}finally{b(!1)}},I=async e=>{try{const a=await fetch(route("students.get-by-ids",{ids:e.join(",")}));if(!a.ok)throw new Error("Failed to fetch student info");const d=await a.json();f(d)}catch{w.error("Gagal memuat data siswa terpilih"),f([])}},F=e=>{C(e),m([])},_=e=>{y(a=>a.includes(e)?a.filter(d=>d!==e):[...a,e])},L=e=>{const a=p.map(d=>d.id);y(e?d=>{const h=[...d];return a.forEach(B=>{h.includes(B)||h.push(B)}),h}:d=>d.filter(h=>!a.includes(h)))},T=e=>{if(e.preventDefault(),o.length===0){w.error("Pilih minimal 1 peserta");return}if(c.length===0){w.error("Pilih minimal 1 PIC");return}const a=t!=null&&t.id?`/events/${t.id}`:"/events/",d=t!=null&&t.id?"put":"post";A[d](a,{...r,pics:c.map(h=>({id:h})),selected_students:o},{onSuccess:()=>{},onError:()=>{}})},v=p.length>0&&p.every(e=>o.includes(e.id));return s.jsxs(K,{breadcrumbs:V(!!(t!=null&&t.id)),children:[s.jsx(O,{title:t!=null&&t.id?"Edit Event":"Buat Event Baru"}),s.jsx(J,{position:"top-right",richColors:!0}),s.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[s.jsx("h1",{className:"text-2xl font-bold",children:t!=null&&t.id?"Edit Event":"Buat Event Baru"}),s.jsxs("form",{onSubmit:T,className:"flex flex-col gap-6",children:[s.jsx("div",{className:"rounded-lg border p-4",children:s.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Nama Event*"}),s.jsx("input",{id:"name",type:"text",maxLength:70,value:r.name,onChange:e=>x({...r,name:e.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),s.jsxs("div",{className:"",children:[s.jsx("label",{htmlFor:"pics",className:"block text-sm font-medium text-gray-700",children:"PIC (Penanggung Jawab)*"}),s.jsx(M,{value:c,onChange:P,placeholder:"Cari guru...",endpoint:route("teachers.search"),initialOptions:E,showInitialOptions:!0,maxInitialOptions:10})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"start_hour",className:"block text-sm font-medium text-gray-700",children:"Jam Mulai*"}),s.jsx("input",{id:"start_hour",type:"time",value:r.start_hour,onChange:e=>x({...r,start_hour:e.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"end_hour",className:"block text-sm font-medium text-gray-700",children:"Jam Selesai*"}),s.jsx("input",{id:"end_hour",type:"time",value:r.end_hour,min:r.start_hour,onChange:e=>x({...r,end_hour:e.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"start_date",className:"block text-sm font-medium text-gray-700",children:"Tanggal Mulai*"}),s.jsx("input",{id:"start_date",type:"date",value:r.start_date,min:new Date().toISOString().split("T")[0],onChange:e=>x({...r,start_date:e.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"end_date",className:"block text-sm font-medium text-gray-700",children:"Tanggal Selesai*"}),s.jsx("input",{id:"end_date",type:"date",value:r.end_date,min:r.start_date,onChange:e=>x({...r,end_date:e.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Deskripsi"}),s.jsx("textarea",{id:"description",value:r.description,onChange:e=>x({...r,description:e.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",rows:4})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[s.jsxs("div",{className:"rounded-lg border p-4",children:[s.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Pilih Peserta"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Kelas"}),s.jsxs("select",{value:u||"",onChange:e=>F(Number(e.target.value)),className:"w-full rounded border p-2",children:[s.jsx("option",{value:"",children:"Pilih Kelas"}),S.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),k?s.jsx("div",{className:"flex justify-center py-8",children:s.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-blue-500 border-t-transparent"})}):p.length>0?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-sm text-gray-600",children:[p.length," siswa ditemukan"]}),s.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[s.jsx("input",{type:"checkbox",checked:v,onChange:e=>L(e.target.checked),className:"rounded border-gray-300 text-indigo-600 hover:cursor-pointer"}),"Pilih Semua"]})]}),s.jsx("div",{className:"max-h-96 overflow-y-auto rounded-lg border",children:s.jsx("div",{className:"divide-y divide-gray-200",children:p.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-gray-900",children:e.full_name}),s.jsxs("p",{className:"text-sm text-gray-500",children:["NIS: ",e.nis||"-"]})]}),s.jsx("input",{type:"checkbox",checked:o.includes(e.id),onChange:()=>_(e.id),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 hover:cursor-pointer"})]},e.id))})})]}):s.jsx("div",{className:"rounded-lg border bg-gray-50 p-6 text-center",children:s.jsx("div",{className:"text-gray-400",children:u?"Tidak ada siswa di kelas ini":"Pilih kelas untuk melihat siswa"})})]}),s.jsxs("div",{className:"rounded-lg border p-4",children:[s.jsxs("h2",{className:"mb-4 text-lg font-semibold",children:["Peserta Terpilih (",o.length,")"]}),g.length>0?s.jsx("div",{className:"space-y-3",children:s.jsx("div",{className:"max-h-96 divide-y divide-gray-200 overflow-y-auto rounded-lg border border-gray-200",children:g.map(e=>{var a,d;return s.jsxs("div",{className:"flex items-center justify-between bg-white p-3",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-gray-900",children:e.full_name}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[s.jsx("span",{children:((a=S.find(h=>h.id===e.class_id))==null?void 0:a.name)||((d=e.classroom)==null?void 0:d.name)||"-"}),s.jsx("span",{children:"•"}),s.jsxs("span",{children:["NIS: ",e.nis||"-"]})]})]}),s.jsx("button",{type:"button",onClick:()=>_(e.id),className:"text-red-500 hover:cursor-pointer hover:text-red-700",children:"✕"})]},e.id)})})}):s.jsx("div",{className:"rounded-lg border bg-gray-50 p-6 text-center",children:s.jsx("div",{className:"text-gray-400",children:"Belum ada peserta terpilih"})})]})]}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx(q,{href:route("events.index"),className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:"Batal"}),s.jsx("button",{type:"submit",className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:cursor-pointer hover:bg-blue-700",children:t!=null&&t.id?"Update":"Simpan"})]})]})]})]})}export{ee as default};
