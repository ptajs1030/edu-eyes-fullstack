<<<<<<<< HEAD:public/build/assets/schedule-DOk_xciX.js
import{r as f,j as n,R as z,C as Ne,u as Ee,H as $e,a as Te}from"./app-DiACb4PV.js";import{S as xe}from"./searchable-select-Crk60qk1.js";import{A as Pe}from"./app-layout-Df7YWau7.js";import{t as re,T as Ie}from"./index-8c_HFqwD.js";import{$ as ve,a as Me,w as Fe,e as Ce,o as L,b as ke}from"./use-resolve-button-type-CPNlPNuD.js";import{K as Z,L as Y,f as Ae,y as se,n as le,o as J,_ as ye,s as ie,O as ge,u as ae,t as Oe}from"./use-is-mounted-BI9KCMjV.js";/* empty css            */import"./button-BVf90HrK.js";import"./index-L24Pu3MU.js";import"./index-BQu7hZY4.js";import"./index-BDGSQU1v.js";import"./createLucideIcon-BLh1dqaJ.js";import"./app-logo-icon-C2JrAlQh.js";function De({value:e,onChange:t,placeholder:s="Search...",options:a}){const[m,h]=f.useState(""),[c,p]=f.useState(!1),T=f.useRef(null),N=a.filter(u=>u.name.toLowerCase().includes(m.toLowerCase())&&!e.includes(u.id)),x=a.filter(u=>e.includes(u.id));f.useEffect(()=>{const u=b=>{T.current&&!T.current.contains(b.target)&&p(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const g=u=>{t([...e,u.id]),h(""),p(!1)},S=u=>{t(e.filter(b=>b!==u))};return n.jsxs("div",{className:"relative",ref:T,children:[n.jsx("div",{className:"flex flex-wrap gap-1 mb-1",children:x.map(u=>n.jsxs("div",{className:"flex items-center rounded bg-blue-100 px-2 py-1 text-xs font-medium text-blue-800",children:[n.jsx("span",{children:u.name}),n.jsx("button",{type:"button",onClick:()=>S(u.id),className:"ml-1 text-gray-500 hover:text-red-500 hover:cursor-pointer",children:"×"})]},u.id))}),n.jsx("div",{className:"flex border border-gray-300 rounded",children:n.jsx("input",{type:"text",value:m,onChange:u=>h(u.target.value),placeholder:s,className:"flex-1 px-3 py-2 outline-none",onFocus:()=>p(!0)})}),c&&n.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md border max-h-60 overflow-auto",children:N.length===0?n.jsx("div",{className:"py-2 px-3 text-gray-500",children:"Tidak ditemukan"}):N.map(u=>n.jsx("div",{onClick:()=>g(u),className:"px-3 py-2 hover:bg-gray-100 cursor-pointer",children:u.name},u.id))})]})}let Le="span";var je=(e=>(e[e.None=1]="None",e[e.Focusable=2]="Focusable",e[e.Hidden=4]="Hidden",e))(je||{});function Re(e,t){var s;let{features:a=1,...m}=e,h={ref:t,"aria-hidden":(a&2)===2?!0:(s=m["aria-hidden"])!=null?s:void 0,hidden:(a&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(a&4)===4&&(a&2)!==2&&{display:"none"}}};return Y()({ourProps:h,theirProps:m,slot:{},defaultTag:Le,name:"Hidden"})}let Se=Z(Re),Ge=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(e=>`${e}:not([tabindex='-1'])`).join(","),He=["[data-autofocus]"].map(e=>`${e}:not([tabindex='-1'])`).join(",");var A=(e=>(e[e.First=1]="First",e[e.Previous=2]="Previous",e[e.Next=4]="Next",e[e.Last=8]="Last",e[e.WrapAround=16]="WrapAround",e[e.NoScroll=32]="NoScroll",e[e.AutoFocus=64]="AutoFocus",e))(A||{}),ne=(e=>(e[e.Error=0]="Error",e[e.Overflow=1]="Overflow",e[e.Success=2]="Success",e[e.Underflow=3]="Underflow",e))(ne||{}),Ue=(e=>(e[e.Previous=-1]="Previous",e[e.Next=1]="Next",e))(Ue||{});function Be(e=document.body){return e==null?[]:Array.from(e.querySelectorAll(Ge)).sort((t,s)=>Math.sign((t.tabIndex||Number.MAX_SAFE_INTEGER)-(s.tabIndex||Number.MAX_SAFE_INTEGER)))}function Ke(e=document.body){return e==null?[]:Array.from(e.querySelectorAll(He)).sort((t,s)=>Math.sign((t.tabIndex||Number.MAX_SAFE_INTEGER)-(s.tabIndex||Number.MAX_SAFE_INTEGER)))}var Je=(e=>(e[e.Strict=0]="Strict",e[e.Loose=1]="Loose",e))(Je||{}),We=(e=>(e[e.Keyboard=0]="Keyboard",e[e.Mouse=1]="Mouse",e))(We||{});typeof window<"u"&&typeof document<"u"&&(document.addEventListener("keydown",e=>{e.metaKey||e.altKey||e.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",e=>{e.detail===1?delete document.documentElement.dataset.headlessuiFocusVisible:e.detail===0&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0));let Ve=["textarea","input"].join(",");function qe(e){var t,s;return(s=(t=e==null?void 0:e.matches)==null?void 0:t.call(e,Ve))!=null?s:!1}function X(e,t=s=>s){return e.slice().sort((s,a)=>{let m=t(s),h=t(a);if(m===null||h===null)return 0;let c=m.compareDocumentPosition(h);return c&Node.DOCUMENT_POSITION_FOLLOWING?-1:c&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function V(e,t,{sorted:s=!0,relativeTo:a=null,skipElements:m=[]}={}){let h=Array.isArray(e)?e.length>0?e[0].ownerDocument:document:e.ownerDocument,c=Array.isArray(e)?s?X(e):e:t&64?Ke(e):Be(e);m.length>0&&c.length>1&&(c=c.filter(u=>!m.some(b=>b!=null&&"current"in b?(b==null?void 0:b.current)===u:b===u))),a=a??h.activeElement;let p=(()=>{if(t&5)return 1;if(t&10)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),T=(()=>{if(t&1)return 0;if(t&2)return Math.max(0,c.indexOf(a))-1;if(t&4)return Math.max(0,c.indexOf(a))+1;if(t&8)return c.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),N=t&32?{preventScroll:!0}:{},x=0,g=c.length,S;do{if(x>=g||x+g<=0)return 0;let u=T+x;if(t&16)u=(u+g)%g;else{if(u<0)return 3;if(u>=g)return 1}S=c[u],S==null||S.focus(N),x+=p}while(S!==h.activeElement);return t&6&&qe(S)&&S.select(),2}function ze({onFocus:e}){let[t,s]=f.useState(!0),a=Ae();return t?z.createElement(Se,{as:"button",type:"button",features:je.Focusable,onFocus:m=>{m.preventDefault();let h,c=50;function p(){if(c--<=0){h&&cancelAnimationFrame(h);return}if(e()){if(cancelAnimationFrame(h),!a.current)return;s(!1);return}h=requestAnimationFrame(p)}h=requestAnimationFrame(p)}}):null}const _e=f.createContext(null);function Xe(){return{groups:new Map,get(e,t){var s;let a=this.groups.get(e);a||(a=new Map,this.groups.set(e,a));let m=(s=a.get(t))!=null?s:0;a.set(t,m+1);let h=Array.from(a.keys()).indexOf(t);function c(){let p=a.get(t);p>1?a.set(t,p-1):a.delete(t)}return[h,c]}}}function Qe({children:e}){let t=f.useRef(Xe());return f.createElement(_e.Provider,{value:t},e)}function we(e){let t=f.useContext(_e);if(!t)throw new Error("You must wrap your component in a <StableCollection>");let s=f.useId(),[a,m]=t.current.get(e,s);return f.useEffect(()=>m,[]),a}var Ze=(e=>(e[e.Forwards=0]="Forwards",e[e.Backwards=1]="Backwards",e))(Ze||{}),Ye=(e=>(e[e.Less=-1]="Less",e[e.Equal=0]="Equal",e[e.Greater=1]="Greater",e))(Ye||{}),et=(e=>(e[e.SetSelectedIndex=0]="SetSelectedIndex",e[e.RegisterTab=1]="RegisterTab",e[e.UnregisterTab=2]="UnregisterTab",e[e.RegisterPanel=3]="RegisterPanel",e[e.UnregisterPanel=4]="UnregisterPanel",e))(et||{});let tt={0(e,t){var s;let a=X(e.tabs,x=>x.current),m=X(e.panels,x=>x.current),h=a.filter(x=>{var g;return!((g=x.current)!=null&&g.hasAttribute("disabled"))}),c={...e,tabs:a,panels:m};if(t.index<0||t.index>a.length-1){let x=ae(Math.sign(t.index-e.selectedIndex),{[-1]:()=>1,0:()=>ae(Math.sign(t.index),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0});if(h.length===0)return c;let g=ae(x,{0:()=>a.indexOf(h[0]),1:()=>a.indexOf(h[h.length-1])});return{...c,selectedIndex:g===-1?e.selectedIndex:g}}let p=a.slice(0,t.index),T=[...a.slice(t.index),...p].find(x=>h.includes(x));if(!T)return c;let N=(s=a.indexOf(T))!=null?s:e.selectedIndex;return N===-1&&(N=e.selectedIndex),{...c,selectedIndex:N}},1(e,t){if(e.tabs.includes(t.tab))return e;let s=e.tabs[e.selectedIndex],a=X([...e.tabs,t.tab],h=>h.current),m=e.selectedIndex;return e.info.current.isControlled||(m=a.indexOf(s),m===-1&&(m=e.selectedIndex)),{...e,tabs:a,selectedIndex:m}},2(e,t){return{...e,tabs:e.tabs.filter(s=>s!==t.tab)}},3(e,t){return e.panels.includes(t.panel)?e:{...e,panels:X([...e.panels,t.panel],s=>s.current)}},4(e,t){return{...e,panels:e.panels.filter(s=>s!==t.panel)}}},fe=f.createContext(null);fe.displayName="TabsDataContext";function Q(e){let t=f.useContext(fe);if(t===null){let s=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(s,Q),s}return t}let be=f.createContext(null);be.displayName="TabsActionsContext";function pe(e){let t=f.useContext(be);if(t===null){let s=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(s,pe),s}return t}function rt(e,t){return ae(t.type,tt,e,t)}let nt="div";function at(e,t){let{defaultIndex:s=0,vertical:a=!1,manual:m=!1,onChange:h,selectedIndex:c=null,...p}=e;const T=a?"vertical":"horizontal",N=m?"manual":"auto";let x=c!==null,g=ie({isControlled:x}),S=se(t),[u,b]=f.useReducer(rt,{info:g,selectedIndex:c??s,tabs:[],panels:[]}),R=f.useMemo(()=>({selectedIndex:u.selectedIndex}),[u.selectedIndex]),U=ie(h||(()=>{})),P=ie(u.tabs),_=f.useMemo(()=>({orientation:T,activation:N,...u}),[T,N,u]),I=J(E=>(b({type:1,tab:E}),()=>b({type:2,tab:E}))),O=J(E=>(b({type:3,panel:E}),()=>b({type:4,panel:E}))),M=J(E=>{F.current!==E&&U.current(E),x||b({type:0,index:E})}),F=ie(x?e.selectedIndex:u.selectedIndex),G=f.useMemo(()=>({registerTab:I,registerPanel:O,change:M}),[]);le(()=>{b({type:0,index:c??s})},[c]),le(()=>{if(F.current===void 0||u.tabs.length<=0)return;let E=X(u.tabs,D=>D.current);E.some((D,H)=>u.tabs[H]!==D)&&M(E.indexOf(u.tabs[F.current]))});let ee={ref:S},B=Y();return z.createElement(Qe,null,z.createElement(be.Provider,{value:G},z.createElement(fe.Provider,{value:_},_.tabs.length<=0&&z.createElement(ze,{onFocus:()=>{var E,D;for(let H of P.current)if(((E=H.current)==null?void 0:E.tabIndex)===0)return(D=H.current)==null||D.focus(),!0;return!1}}),B({ourProps:ee,theirProps:p,slot:R,defaultTag:nt,name:"Tabs"}))))}let st="div";function ot(e,t){let{orientation:s,selectedIndex:a}=Q("Tab.List"),m=se(t),h=f.useMemo(()=>({selectedIndex:a}),[a]),c=e,p={ref:m,role:"tablist","aria-orientation":s};return Y()({ourProps:p,theirProps:c,slot:h,defaultTag:st,name:"Tabs.List"})}let it="button";function lt(e,t){var s,a;let m=f.useId(),{id:h=`headlessui-tabs-tab-${m}`,disabled:c=!1,autoFocus:p=!1,...T}=e,{orientation:N,activation:x,selectedIndex:g,tabs:S,panels:u}=Q("Tab"),b=pe("Tab"),R=Q("Tab"),[U,P]=f.useState(null),_=f.useRef(null),I=se(_,t,P);le(()=>b.registerTab(_),[b,_]);let O=we("tabs"),M=S.indexOf(_);M===-1&&(M=O);let F=M===g,G=J(j=>{var r;let o=j();if(o===ne.Success&&x==="auto"){let i=(r=ke(_))==null?void 0:r.activeElement,d=R.tabs.findIndex(l=>l.current===i);d!==-1&&b.change(d)}return o}),ee=J(j=>{let r=S.map(o=>o.current).filter(Boolean);if(j.key===L.Space||j.key===L.Enter){j.preventDefault(),j.stopPropagation(),b.change(M);return}switch(j.key){case L.Home:case L.PageUp:return j.preventDefault(),j.stopPropagation(),G(()=>V(r,A.First));case L.End:case L.PageDown:return j.preventDefault(),j.stopPropagation(),G(()=>V(r,A.Last))}if(G(()=>ae(N,{vertical(){return j.key===L.ArrowUp?V(r,A.Previous|A.WrapAround):j.key===L.ArrowDown?V(r,A.Next|A.WrapAround):ne.Error},horizontal(){return j.key===L.ArrowLeft?V(r,A.Previous|A.WrapAround):j.key===L.ArrowRight?V(r,A.Next|A.WrapAround):ne.Error}}))===ne.Success)return j.preventDefault()}),B=f.useRef(!1),E=J(()=>{var j;B.current||(B.current=!0,(j=_.current)==null||j.focus({preventScroll:!0}),b.change(M),Oe(()=>{B.current=!1}))}),D=J(j=>{j.preventDefault()}),{isFocusVisible:H,focusProps:W}=ve({autoFocus:p}),{isHovered:te,hoverProps:ue}=Me({isDisabled:c}),{pressed:oe,pressProps:de}=Fe({disabled:c}),ce=f.useMemo(()=>({selected:F,hover:te,active:oe,focus:H,autofocus:p,disabled:c}),[F,te,H,oe,p,c]),me=ye({ref:I,onKeyDown:ee,onMouseDown:D,onClick:E,id:h,role:"tab",type:Ce(e,U),"aria-controls":(a=(s=u[M])==null?void 0:s.current)==null?void 0:a.id,"aria-selected":F,tabIndex:F?0:-1,disabled:c||void 0,autoFocus:p},W,ue,de);return Y()({ourProps:me,theirProps:T,slot:ce,defaultTag:it,name:"Tabs.Tab"})}let ut="div";function dt(e,t){let{selectedIndex:s}=Q("Tab.Panels"),a=se(t),m=f.useMemo(()=>({selectedIndex:s}),[s]),h=e,c={ref:a};return Y()({ourProps:c,theirProps:h,slot:m,defaultTag:ut,name:"Tabs.Panels"})}let ct="div",mt=ge.RenderStrategy|ge.Static;function ht(e,t){var s,a,m,h;let c=f.useId(),{id:p=`headlessui-tabs-panel-${c}`,tabIndex:T=0,...N}=e,{selectedIndex:x,tabs:g,panels:S}=Q("Tab.Panel"),u=pe("Tab.Panel"),b=f.useRef(null),R=se(b,t);le(()=>u.registerPanel(b),[u,b]);let U=we("panels"),P=S.indexOf(b);P===-1&&(P=U);let _=P===x,{isFocusVisible:I,focusProps:O}=ve(),M=f.useMemo(()=>({selected:_,focus:I}),[_,I]),F=ye({ref:R,id:p,role:"tabpanel","aria-labelledby":(a=(s=g[P])==null?void 0:s.current)==null?void 0:a.id,tabIndex:_?T:-1},O),G=Y();return!_&&((m=N.unmount)==null||m)&&!((h=N.static)!=null&&h)?z.createElement(Se,{"aria-hidden":"true",...F}):G({ourProps:F,theirProps:N,slot:M,defaultTag:ct,features:mt,visible:_,name:"Tabs.Panel"})}let ft=Z(lt),bt=Z(at),pt=Z(ot),xt=Z(dt),gt=Z(ht),q=Object.assign(ft,{Group:bt,List:pt,Panels:xt,Panel:gt});const vt=()=>[{title:"Kelas",href:"/classrooms"},{title:"Jadwal",href:""}];function Ct({classroom:e,days:t,shiftings:s,teachers:a,academicYear:m,subjectSchedulesByDay:h,subjects:c}){const{data:p,setData:T,post:N,processing:x}=Ne({days:t}),[g,S]=f.useState(()=>de(h)),[u,b]=f.useState(!1),[R,U]=f.useState(m.attendance_mode==="per-shift"?0:1),[P,_]=f.useState(null),{flash:I}=Ee().props,O=m.attendance_mode==="per-shift",M=m.attendance_mode==="per-subject",F=f.useMemo(()=>ce(a),[a]);f.useEffect(()=>{I!=null&&I.success&&re.success(I.success),I!=null&&I.error&&re.error(I.error)},[I]),f.useEffect(()=>{U(O?0:1)},[m.attendance_mode]);const G=r=>{r===0&&O||r===1&&M?U(r):re.warning(`Current attendance mode is "${m.attendance_mode}". Switch mode in Academic Year settings to access this feature.`)},ee=(r,o)=>{const i=[...p.days];i[r]={...i[r],shifting_id:o,teachers:o?i[r].teachers:[],selected_teachers:o?i[r].selected_teachers:[]},T("days",i)},B=(r,o)=>{const i=[...p.days],d=o.filter(v=>v!==null).map(Number),l=d.map(v=>{var w;return{id:v,name:((w=a.find(C=>C.id===v))==null?void 0:w.full_name)||"Unknown"}});i[r]={...i[r],teachers:d,selected_teachers:l},T("days",i)},E=(r,o)=>{const i={...g[r][o]};_({day:r,index:o,original:i})},D=(r,o)=>{P&&S(i=>{const d=[...i[r]];return d[o]=P.original,{...i,[r]:d}}),_(null)},H=r=>{S(o=>({...o,[r]:[...o[r]||[],{subject_id:null,teacher_id:null,start_hour:"",end_hour:"",editable:!0}]}))},W=(r,o,i,d)=>{S(l=>{const v={...l},w=[...v[r]||[]];let C=d;if((i==="start_hour"||i==="end_hour")&&typeof d=="string"&&d.length===5){const[$,y]=d.split(":"),k=Math.min(Math.max(parseInt($||"0",10),0),23),K=Math.min(Math.max(parseInt(y||"0",10),0),59);C=`${String(k).padStart(2,"0")}:${String(K).padStart(2,"0")}`}return w[o]={...w[o],[i]:C},v[r]=w,v})},te=(r,o)=>{S(i=>{const d=[...i[r]];return d.splice(o,1),{...i,[r]:d}})},ue=r=>{r.preventDefault(),N(route("classrooms.schedule.shift.save",e.id))},oe=r=>{r.preventDefault();const o=me(g),i=j(o);if(i.length>0){i.forEach(d=>re.error(d));return}b(!0),Te.post(route("classrooms.schedule.subject.save",e.id),{schedules:o},{onError:d=>{Object.values(d).flat().filter(v=>typeof v=="string").forEach(v=>re.error(v))},onSuccess:()=>{_(null)},onFinish:()=>{b(!1)},preserveState:!0,preserveScroll:!0})};function de(r){var i;const o={};for(let d=1;d<=7;d++)o[d]=((i=r[d])==null?void 0:i.map(l=>({id:l.id,subject_id:l.subject_id,teacher_id:l.teacher_id,start_hour:l.start_hour,end_hour:l.end_hour})))||[];return o}function ce(r){return r.map(o=>({id:o.id,name:o.full_name}))}function me(r){return Object.entries(r).flatMap(([o,i])=>i.map(d=>({id:d.id||void 0,day:parseInt(o),subject_id:d.subject_id??null,teacher_id:d.teacher_id??null,start_hour:d.start_hour??"",end_hour:d.end_hour??""}))).sort((o,i)=>o.day-i.day||o.start_hour.localeCompare(i.start_hour))}function j(r){const o=[],i={},d=/^([0-1][0-9]|2[0-3]):[0-5][0-9]$/;return r.forEach((l,v)=>{!l.day&&l.day!==0&&o.push(`Schedule at index ${v+1} is missing day`),l.subject_id||o.push(`Schedule on day ${l.day} is missing subject`),l.teacher_id||o.push(`Schedule on day ${l.day} is missing teacher`),(!l.start_hour||!l.end_hour)&&o.push(`Schedule on day ${l.day} is missing start or end time`),l.start_hour&&!d.test(l.start_hour)&&o.push(`Schedule on day ${l.day} has invalid start time format (HH:MM)`),l.end_hour&&!d.test(l.end_hour)&&o.push(`Schedule on day ${l.day} has invalid end time format (HH:MM)`),l.start_hour&&l.end_hour&&d.test(l.start_hour)&&d.test(l.end_hour)&&l.end_hour<=l.start_hour&&o.push(`Day ${l.day}: End time must be after start time`),i[l.day]||(i[l.day]=[]),i[l.day].push(l)}),Object.entries(i).forEach(([l,v])=>{const w=v;w.sort(($,y)=>$.start_hour.localeCompare(y.start_hour));for(let $=1;$<w.length;$++){const y=w[$-1],k=w[$];k.start_hour<y.end_hour&&o.push(`Day ${l}: Schedule overlaps between ${y.start_hour}-${y.end_hour} and ${k.start_hour}-${k.end_hour}`)}const C={};for(const $ of w)$.teacher_id&&(C[$.teacher_id]||(C[$.teacher_id]=[]),C[$.teacher_id].push($));Object.entries(C).forEach(([$,y])=>{y.sort((k,K)=>k.start_hour.localeCompare(K.start_hour));for(let k=1;k<y.length;k++){const K=y[k-1],he=y[k];he.start_hour<K.end_hour&&o.push(`Day ${l}: Teacher ${$} has overlapping assignments ${K.start_hour}-${K.end_hour} & ${he.start_hour}-${he.end_hour}`)}})}),o}return n.jsxs(Pe,{breadcrumbs:vt(),children:[n.jsx($e,{title:`Jadwal - ${e.name}`}),n.jsx(Ie,{position:"top-right",richColors:!0}),n.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[n.jsxs("div",{className:"mb-8 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[n.jsxs("h1",{className:"text-2xl font-bold",children:["Jadwal: ",e.name]}),n.jsx("button",{type:"submit",form:R===0?"shift-form":"subject-form",disabled:R===0?x:u,className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:cursor-pointer hover:bg-blue-700 disabled:opacity-50",children:x||u?"Menyimpan...":"Simpan Jadwal"})]}),n.jsxs(q.Group,{selectedIndex:R,onChange:G,children:[n.jsx(q.List,{className:"mb-6 flex rounded-lg bg-blue-100 p-1",children:["By Shifting","By Subject"].map(r=>n.jsx(q,{disabled:r==="By Shifting"&&!O||r==="By Subject"&&!M,className:({selected:o})=>`flex-1 rounded-lg py-3 text-center text-sm font-medium transition-all hover:cursor-pointer ${o?"bg-white text-blue-700 shadow":"text-gray-600 hover:bg-blue-200"} ${r==="By Shifting"&&!O||r==="By Subject"&&!M?"cursor-not-allowed opacity-50":""}`,children:r},r))}),n.jsxs(q.Panels,{children:[n.jsx(q.Panel,{children:n.jsx("form",{id:"shift-form",onSubmit:ue,className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:p.days.map((r,o)=>n.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[n.jsx("h3",{className:"mb-3 text-lg font-semibold text-gray-800",children:r.day_name}),n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Shifting:"}),n.jsxs("select",{value:r.shifting_id||"",onChange:i=>ee(o,i.target.value?parseInt(i.target.value):null),className:"w-full rounded-md border border-gray-300 bg-gray-50 p-2 text-sm focus:border-blue-500 focus:ring-blue-500",children:[n.jsx("option",{value:"",children:"-- No Schedule --"}),s.map(i=>n.jsxs("option",{value:i.id,children:[i.name," (",i.start_hour," - ",i.end_hour,")"]},i.id))]})]}),r.shifting_id&&n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Teacher responsible:"}),n.jsx(De,{value:r.teachers,onChange:i=>B(o,i),placeholder:"Search teachers...",options:F})]})]},r.day))})}),n.jsx(q.Panel,{children:M?n.jsx("form",{id:"subject-form",onSubmit:oe,className:"space-y-6",children:[1,2,3,4,5,6,7].map(r=>{var o,i;return n.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[n.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:["Senin","Selasa","Rabu","Kamis","Jum'at","Sabtu","Minggu"][r-1]}),n.jsx("button",{type:"button",onClick:()=>H(r),className:"inline-flex items-center rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:cursor-pointer hover:bg-green-700",children:"+ Tambah"})]}),n.jsx("div",{className:"grid gap-4 md:grid-cols-1",children:(o=g[r])==null?void 0:o.map((d,l)=>{var C,$;const v=(P==null?void 0:P.day)===r&&(P==null?void 0:P.index)===l,w=!d.id;return n.jsx("div",{className:"relative rounded-md border border-gray-300 bg-gray-50 p-4",children:n.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Jam Mulai"}),n.jsx("input",{type:"time",value:d.start_hour,onChange:y=>W(r,l,"start_hour",y.target.value),className:`mt-1 w-full rounded-md border border-gray-300 p-2 text-sm shadow-sm ${!v&&!w?"bg-gray-100":"bg-white"}`,disabled:!v&&!w})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Jam Selesai"}),n.jsx("input",{type:"time",value:d.end_hour,onChange:y=>W(r,l,"end_hour",y.target.value),className:`mt-1 w-full rounded-md border border-gray-300 p-2 text-sm shadow-sm ${!v&&!w?"bg-gray-100":"bg-white"}`,disabled:!v&&!w})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Mata Pelajaran"}),n.jsx(xe,{value:d.subject_id,onChange:y=>W(r,l,"subject_id",y),placeholder:"Pilih mata pelajaran...",endpoint:route("subjects.search"),initialOption:d.subject_id?{id:d.subject_id,full_name:((C=c.find(y=>y.id===d.subject_id))==null?void 0:C.name)||""}:void 0,showInitialOptions:!0,disabled:!v&&!w})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Pengajar"}),n.jsx(xe,{value:d.teacher_id,onChange:y=>W(r,l,"teacher_id",y),placeholder:"Select teacher...",endpoint:route("teachers.search"),initialOption:d.teacher_id?{id:d.teacher_id,full_name:(($=a.find(y=>y.id===d.teacher_id))==null?void 0:$.full_name)||""}:void 0,showInitialOptions:!0,disabled:!v&&!w})]}),n.jsx("div",{className:"mt-1 flex h-full items-center justify-start space-x-2 pt-6 md:pt-0",children:w?n.jsx(n.Fragment,{children:n.jsx("button",{type:"button",onClick:()=>te(r,l),className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:cursor-pointer hover:bg-gray-50",children:"Batal"})}):v?n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>D(r,l),className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:cursor-pointer hover:bg-gray-50",children:"Batal"}),n.jsx("button",{type:"button",onClick:()=>_(null),className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:cursor-pointer",children:"Selesai"})]}):n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>E(r,l),className:"rounded-md bg-yellow-400 px-4 py-2 text-sm font-medium text-white hover:cursor-pointer hover:bg-yellow-600",children:"Edit"}),n.jsx("button",{type:"button",onClick:()=>te(r,l),className:"rounded-md bg-red-500 px-4 py-2 text-sm font-medium text-white hover:cursor-pointer hover:bg-red-700",children:"Hapus"})]})})]})},l)})}),((i=g[r])==null?void 0:i.length)===0&&n.jsx("div",{className:"py-4 text-center text-gray-500",children:"Tidak ada jadwal mata pelajaran untuk hari ini"})]},r)})}):n.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-8 text-center",children:n.jsxs("div",{className:"mx-auto max-w-md",children:[n.jsx("div",{className:"mb-4 text-5xl",children:"⚠️"}),n.jsx("h3",{className:"mb-2 text-xl font-semibold",children:"Attendance Mode Mismatch"}),n.jsx("p",{className:"text-gray-600",children:'Saat ini attendance mode yang aktif adalah "Per Shift". Ganti ke "Per Subject" mode di setting tahun ajaran untuk dapat menggunakan fitur ini.'})]})})})]})]})]})]})}export{Ct as default};
========
import{r as f,j as n,R as z,C as Ne,u as Ee,H as $e,a as Te}from"./app-6uGljjzj.js";import{S as xe}from"./searchable-select-2OjQ1Yrc.js";import{A as Pe}from"./app-layout-DkSmV0H7.js";import{t as re,T as Ie}from"./index-U4pvGxcC.js";import{$ as ve,a as Me,w as Ce,e as Fe,o as R,b as Ae}from"./use-resolve-button-type-BriCs1Tq.js";import{K as Z,L as Y,f as Oe,y as ae,n as le,o as J,_ as ye,s as ie,O as ge,u as se,t as ke}from"./use-is-mounted-n8FTGiK4.js";/* empty css            */import"./button-B_98bQe4.js";import"./index-CTMnhQDf.js";import"./index-2XKtYTwm.js";import"./index-NI8aqM-6.js";import"./createLucideIcon-uIMYACeP.js";import"./app-logo-icon-BTIryjTO.js";function De({value:e,onChange:t,placeholder:a="Search...",options:s}){const[m,h]=f.useState(""),[c,p]=f.useState(!1),T=f.useRef(null),N=s.filter(u=>u.name.toLowerCase().includes(m.toLowerCase())&&!e.includes(u.id)),x=s.filter(u=>e.includes(u.id));f.useEffect(()=>{const u=b=>{T.current&&!T.current.contains(b.target)&&p(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const g=u=>{t([...e,u.id]),h(""),p(!1)},S=u=>{t(e.filter(b=>b!==u))};return n.jsxs("div",{className:"relative",ref:T,children:[n.jsx("div",{className:"flex flex-wrap gap-1 mb-1",children:x.map(u=>n.jsxs("div",{className:"flex items-center rounded bg-blue-100 px-2 py-1 text-xs font-medium text-blue-800",children:[n.jsx("span",{children:u.name}),n.jsx("button",{type:"button",onClick:()=>S(u.id),className:"ml-1 text-gray-500 hover:text-red-500 hover:cursor-pointer",children:"×"})]},u.id))}),n.jsx("div",{className:"flex border border-gray-300 rounded",children:n.jsx("input",{type:"text",value:m,onChange:u=>h(u.target.value),placeholder:a,className:"flex-1 px-3 py-2 outline-none",onFocus:()=>p(!0)})}),c&&n.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md border max-h-60 overflow-auto",children:N.length===0?n.jsx("div",{className:"py-2 px-3 text-gray-500",children:"Tidak ditemukan"}):N.map(u=>n.jsx("div",{onClick:()=>g(u),className:"px-3 py-2 hover:bg-gray-100 cursor-pointer",children:u.name},u.id))})]})}let Re="span";var je=(e=>(e[e.None=1]="None",e[e.Focusable=2]="Focusable",e[e.Hidden=4]="Hidden",e))(je||{});function Le(e,t){var a;let{features:s=1,...m}=e,h={ref:t,"aria-hidden":(s&2)===2?!0:(a=m["aria-hidden"])!=null?a:void 0,hidden:(s&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(s&4)===4&&(s&2)!==2&&{display:"none"}}};return Y()({ourProps:h,theirProps:m,slot:{},defaultTag:Re,name:"Hidden"})}let Se=Z(Le),Ge=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(e=>`${e}:not([tabindex='-1'])`).join(","),He=["[data-autofocus]"].map(e=>`${e}:not([tabindex='-1'])`).join(",");var O=(e=>(e[e.First=1]="First",e[e.Previous=2]="Previous",e[e.Next=4]="Next",e[e.Last=8]="Last",e[e.WrapAround=16]="WrapAround",e[e.NoScroll=32]="NoScroll",e[e.AutoFocus=64]="AutoFocus",e))(O||{}),ne=(e=>(e[e.Error=0]="Error",e[e.Overflow=1]="Overflow",e[e.Success=2]="Success",e[e.Underflow=3]="Underflow",e))(ne||{}),Ue=(e=>(e[e.Previous=-1]="Previous",e[e.Next=1]="Next",e))(Ue||{});function Ke(e=document.body){return e==null?[]:Array.from(e.querySelectorAll(Ge)).sort((t,a)=>Math.sign((t.tabIndex||Number.MAX_SAFE_INTEGER)-(a.tabIndex||Number.MAX_SAFE_INTEGER)))}function Be(e=document.body){return e==null?[]:Array.from(e.querySelectorAll(He)).sort((t,a)=>Math.sign((t.tabIndex||Number.MAX_SAFE_INTEGER)-(a.tabIndex||Number.MAX_SAFE_INTEGER)))}var Je=(e=>(e[e.Strict=0]="Strict",e[e.Loose=1]="Loose",e))(Je||{}),We=(e=>(e[e.Keyboard=0]="Keyboard",e[e.Mouse=1]="Mouse",e))(We||{});typeof window<"u"&&typeof document<"u"&&(document.addEventListener("keydown",e=>{e.metaKey||e.altKey||e.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",e=>{e.detail===1?delete document.documentElement.dataset.headlessuiFocusVisible:e.detail===0&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0));let Ve=["textarea","input"].join(",");function qe(e){var t,a;return(a=(t=e==null?void 0:e.matches)==null?void 0:t.call(e,Ve))!=null?a:!1}function X(e,t=a=>a){return e.slice().sort((a,s)=>{let m=t(a),h=t(s);if(m===null||h===null)return 0;let c=m.compareDocumentPosition(h);return c&Node.DOCUMENT_POSITION_FOLLOWING?-1:c&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function V(e,t,{sorted:a=!0,relativeTo:s=null,skipElements:m=[]}={}){let h=Array.isArray(e)?e.length>0?e[0].ownerDocument:document:e.ownerDocument,c=Array.isArray(e)?a?X(e):e:t&64?Be(e):Ke(e);m.length>0&&c.length>1&&(c=c.filter(u=>!m.some(b=>b!=null&&"current"in b?(b==null?void 0:b.current)===u:b===u))),s=s??h.activeElement;let p=(()=>{if(t&5)return 1;if(t&10)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),T=(()=>{if(t&1)return 0;if(t&2)return Math.max(0,c.indexOf(s))-1;if(t&4)return Math.max(0,c.indexOf(s))+1;if(t&8)return c.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),N=t&32?{preventScroll:!0}:{},x=0,g=c.length,S;do{if(x>=g||x+g<=0)return 0;let u=T+x;if(t&16)u=(u+g)%g;else{if(u<0)return 3;if(u>=g)return 1}S=c[u],S==null||S.focus(N),x+=p}while(S!==h.activeElement);return t&6&&qe(S)&&S.select(),2}function ze({onFocus:e}){let[t,a]=f.useState(!0),s=Oe();return t?z.createElement(Se,{as:"button",type:"button",features:je.Focusable,onFocus:m=>{m.preventDefault();let h,c=50;function p(){if(c--<=0){h&&cancelAnimationFrame(h);return}if(e()){if(cancelAnimationFrame(h),!s.current)return;a(!1);return}h=requestAnimationFrame(p)}h=requestAnimationFrame(p)}}):null}const _e=f.createContext(null);function Xe(){return{groups:new Map,get(e,t){var a;let s=this.groups.get(e);s||(s=new Map,this.groups.set(e,s));let m=(a=s.get(t))!=null?a:0;s.set(t,m+1);let h=Array.from(s.keys()).indexOf(t);function c(){let p=s.get(t);p>1?s.set(t,p-1):s.delete(t)}return[h,c]}}}function Qe({children:e}){let t=f.useRef(Xe());return f.createElement(_e.Provider,{value:t},e)}function we(e){let t=f.useContext(_e);if(!t)throw new Error("You must wrap your component in a <StableCollection>");let a=f.useId(),[s,m]=t.current.get(e,a);return f.useEffect(()=>m,[]),s}var Ze=(e=>(e[e.Forwards=0]="Forwards",e[e.Backwards=1]="Backwards",e))(Ze||{}),Ye=(e=>(e[e.Less=-1]="Less",e[e.Equal=0]="Equal",e[e.Greater=1]="Greater",e))(Ye||{}),et=(e=>(e[e.SetSelectedIndex=0]="SetSelectedIndex",e[e.RegisterTab=1]="RegisterTab",e[e.UnregisterTab=2]="UnregisterTab",e[e.RegisterPanel=3]="RegisterPanel",e[e.UnregisterPanel=4]="UnregisterPanel",e))(et||{});let tt={0(e,t){var a;let s=X(e.tabs,x=>x.current),m=X(e.panels,x=>x.current),h=s.filter(x=>{var g;return!((g=x.current)!=null&&g.hasAttribute("disabled"))}),c={...e,tabs:s,panels:m};if(t.index<0||t.index>s.length-1){let x=se(Math.sign(t.index-e.selectedIndex),{[-1]:()=>1,0:()=>se(Math.sign(t.index),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0});if(h.length===0)return c;let g=se(x,{0:()=>s.indexOf(h[0]),1:()=>s.indexOf(h[h.length-1])});return{...c,selectedIndex:g===-1?e.selectedIndex:g}}let p=s.slice(0,t.index),T=[...s.slice(t.index),...p].find(x=>h.includes(x));if(!T)return c;let N=(a=s.indexOf(T))!=null?a:e.selectedIndex;return N===-1&&(N=e.selectedIndex),{...c,selectedIndex:N}},1(e,t){if(e.tabs.includes(t.tab))return e;let a=e.tabs[e.selectedIndex],s=X([...e.tabs,t.tab],h=>h.current),m=e.selectedIndex;return e.info.current.isControlled||(m=s.indexOf(a),m===-1&&(m=e.selectedIndex)),{...e,tabs:s,selectedIndex:m}},2(e,t){return{...e,tabs:e.tabs.filter(a=>a!==t.tab)}},3(e,t){return e.panels.includes(t.panel)?e:{...e,panels:X([...e.panels,t.panel],a=>a.current)}},4(e,t){return{...e,panels:e.panels.filter(a=>a!==t.panel)}}},fe=f.createContext(null);fe.displayName="TabsDataContext";function Q(e){let t=f.useContext(fe);if(t===null){let a=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(a,Q),a}return t}let be=f.createContext(null);be.displayName="TabsActionsContext";function pe(e){let t=f.useContext(be);if(t===null){let a=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(a,pe),a}return t}function rt(e,t){return se(t.type,tt,e,t)}let nt="div";function st(e,t){let{defaultIndex:a=0,vertical:s=!1,manual:m=!1,onChange:h,selectedIndex:c=null,...p}=e;const T=s?"vertical":"horizontal",N=m?"manual":"auto";let x=c!==null,g=ie({isControlled:x}),S=ae(t),[u,b]=f.useReducer(rt,{info:g,selectedIndex:c??a,tabs:[],panels:[]}),L=f.useMemo(()=>({selectedIndex:u.selectedIndex}),[u.selectedIndex]),U=ie(h||(()=>{})),P=ie(u.tabs),_=f.useMemo(()=>({orientation:T,activation:N,...u}),[T,N,u]),I=J(E=>(b({type:1,tab:E}),()=>b({type:2,tab:E}))),k=J(E=>(b({type:3,panel:E}),()=>b({type:4,panel:E}))),M=J(E=>{C.current!==E&&U.current(E),x||b({type:0,index:E})}),C=ie(x?e.selectedIndex:u.selectedIndex),G=f.useMemo(()=>({registerTab:I,registerPanel:k,change:M}),[]);le(()=>{b({type:0,index:c??a})},[c]),le(()=>{if(C.current===void 0||u.tabs.length<=0)return;let E=X(u.tabs,D=>D.current);E.some((D,H)=>u.tabs[H]!==D)&&M(E.indexOf(u.tabs[C.current]))});let ee={ref:S},K=Y();return z.createElement(Qe,null,z.createElement(be.Provider,{value:G},z.createElement(fe.Provider,{value:_},_.tabs.length<=0&&z.createElement(ze,{onFocus:()=>{var E,D;for(let H of P.current)if(((E=H.current)==null?void 0:E.tabIndex)===0)return(D=H.current)==null||D.focus(),!0;return!1}}),K({ourProps:ee,theirProps:p,slot:L,defaultTag:nt,name:"Tabs"}))))}let at="div";function ot(e,t){let{orientation:a,selectedIndex:s}=Q("Tab.List"),m=ae(t),h=f.useMemo(()=>({selectedIndex:s}),[s]),c=e,p={ref:m,role:"tablist","aria-orientation":a};return Y()({ourProps:p,theirProps:c,slot:h,defaultTag:at,name:"Tabs.List"})}let it="button";function lt(e,t){var a,s;let m=f.useId(),{id:h=`headlessui-tabs-tab-${m}`,disabled:c=!1,autoFocus:p=!1,...T}=e,{orientation:N,activation:x,selectedIndex:g,tabs:S,panels:u}=Q("Tab"),b=pe("Tab"),L=Q("Tab"),[U,P]=f.useState(null),_=f.useRef(null),I=ae(_,t,P);le(()=>b.registerTab(_),[b,_]);let k=we("tabs"),M=S.indexOf(_);M===-1&&(M=k);let C=M===g,G=J(j=>{var r;let o=j();if(o===ne.Success&&x==="auto"){let i=(r=Ae(_))==null?void 0:r.activeElement,d=L.tabs.findIndex(l=>l.current===i);d!==-1&&b.change(d)}return o}),ee=J(j=>{let r=S.map(o=>o.current).filter(Boolean);if(j.key===R.Space||j.key===R.Enter){j.preventDefault(),j.stopPropagation(),b.change(M);return}switch(j.key){case R.Home:case R.PageUp:return j.preventDefault(),j.stopPropagation(),G(()=>V(r,O.First));case R.End:case R.PageDown:return j.preventDefault(),j.stopPropagation(),G(()=>V(r,O.Last))}if(G(()=>se(N,{vertical(){return j.key===R.ArrowUp?V(r,O.Previous|O.WrapAround):j.key===R.ArrowDown?V(r,O.Next|O.WrapAround):ne.Error},horizontal(){return j.key===R.ArrowLeft?V(r,O.Previous|O.WrapAround):j.key===R.ArrowRight?V(r,O.Next|O.WrapAround):ne.Error}}))===ne.Success)return j.preventDefault()}),K=f.useRef(!1),E=J(()=>{var j;K.current||(K.current=!0,(j=_.current)==null||j.focus({preventScroll:!0}),b.change(M),ke(()=>{K.current=!1}))}),D=J(j=>{j.preventDefault()}),{isFocusVisible:H,focusProps:W}=ve({autoFocus:p}),{isHovered:te,hoverProps:ue}=Me({isDisabled:c}),{pressed:oe,pressProps:de}=Ce({disabled:c}),ce=f.useMemo(()=>({selected:C,hover:te,active:oe,focus:H,autofocus:p,disabled:c}),[C,te,H,oe,p,c]),me=ye({ref:I,onKeyDown:ee,onMouseDown:D,onClick:E,id:h,role:"tab",type:Fe(e,U),"aria-controls":(s=(a=u[M])==null?void 0:a.current)==null?void 0:s.id,"aria-selected":C,tabIndex:C?0:-1,disabled:c||void 0,autoFocus:p},W,ue,de);return Y()({ourProps:me,theirProps:T,slot:ce,defaultTag:it,name:"Tabs.Tab"})}let ut="div";function dt(e,t){let{selectedIndex:a}=Q("Tab.Panels"),s=ae(t),m=f.useMemo(()=>({selectedIndex:a}),[a]),h=e,c={ref:s};return Y()({ourProps:c,theirProps:h,slot:m,defaultTag:ut,name:"Tabs.Panels"})}let ct="div",mt=ge.RenderStrategy|ge.Static;function ht(e,t){var a,s,m,h;let c=f.useId(),{id:p=`headlessui-tabs-panel-${c}`,tabIndex:T=0,...N}=e,{selectedIndex:x,tabs:g,panels:S}=Q("Tab.Panel"),u=pe("Tab.Panel"),b=f.useRef(null),L=ae(b,t);le(()=>u.registerPanel(b),[u,b]);let U=we("panels"),P=S.indexOf(b);P===-1&&(P=U);let _=P===x,{isFocusVisible:I,focusProps:k}=ve(),M=f.useMemo(()=>({selected:_,focus:I}),[_,I]),C=ye({ref:L,id:p,role:"tabpanel","aria-labelledby":(s=(a=g[P])==null?void 0:a.current)==null?void 0:s.id,tabIndex:_?T:-1},k),G=Y();return!_&&((m=N.unmount)==null||m)&&!((h=N.static)!=null&&h)?z.createElement(Se,{"aria-hidden":"true",...C}):G({ourProps:C,theirProps:N,slot:M,defaultTag:ct,features:mt,visible:_,name:"Tabs.Panel"})}let ft=Z(lt),bt=Z(st),pt=Z(ot),xt=Z(dt),gt=Z(ht),q=Object.assign(ft,{Group:bt,List:pt,Panels:xt,Panel:gt});const vt=()=>[{title:"Kelas",href:"/classrooms"},{title:"Jadwal",href:""}];function Ft({classroom:e,days:t,shiftings:a,teachers:s,academicYear:m,subjectSchedulesByDay:h,subjects:c}){const{data:p,setData:T,post:N,processing:x}=Ne({days:t}),[g,S]=f.useState(()=>de(h)),[u,b]=f.useState(!1),[L,U]=f.useState(m.attendance_mode==="per-shift"?0:1),[P,_]=f.useState(null),{flash:I}=Ee().props,k=m.attendance_mode==="per-shift",M=m.attendance_mode==="per-subject",C=f.useMemo(()=>ce(s),[s]);f.useEffect(()=>{I!=null&&I.success&&re.success(I.success),I!=null&&I.error&&re.error(I.error)},[I]),f.useEffect(()=>{U(k?0:1)},[m.attendance_mode]);const G=r=>{r===0&&k||r===1&&M?U(r):re.warning(`Current attendance mode is "${m.attendance_mode}". Switch mode in Academic Year settings to access this feature.`)},ee=(r,o)=>{const i=[...p.days];i[r]={...i[r],shifting_id:o,teachers:o?i[r].teachers:[],selected_teachers:o?i[r].selected_teachers:[]},T("days",i)},K=(r,o)=>{const i=[...p.days],d=o.filter(v=>v!==null).map(Number),l=d.map(v=>{var w;return{id:v,name:((w=s.find(F=>F.id===v))==null?void 0:w.full_name)||"Unknown"}});i[r]={...i[r],teachers:d,selected_teachers:l},T("days",i)},E=(r,o)=>{const i={...g[r][o]};_({day:r,index:o,original:i})},D=(r,o)=>{P&&S(i=>{const d=[...i[r]];return d[o]=P.original,{...i,[r]:d}}),_(null)},H=r=>{S(o=>({...o,[r]:[...o[r]||[],{subject_id:null,teacher_id:null,start_hour:"",end_hour:"",editable:!0}]}))},W=(r,o,i,d)=>{S(l=>{const v={...l},w=[...v[r]||[]];let F=d;if((i==="start_hour"||i==="end_hour")&&typeof d=="string"&&d.length===5){const[$,y]=d.split(":"),A=Math.min(Math.max(parseInt($||"0",10),0),23),B=Math.min(Math.max(parseInt(y||"0",10),0),59);F=`${String(A).padStart(2,"0")}:${String(B).padStart(2,"0")}`}return w[o]={...w[o],[i]:F},v[r]=w,v})},te=(r,o)=>{S(i=>{const d=[...i[r]];return d.splice(o,1),{...i,[r]:d}})},ue=r=>{r.preventDefault(),N(route("classrooms.schedule.shift.save",e.id))},oe=r=>{r.preventDefault();const o=me(g),i=j(o);if(i.length>0){i.forEach(d=>re.error(d));return}b(!0),Te.post(route("classrooms.schedule.subject.save",e.id),{schedules:o},{onError:d=>{Object.values(d).flat().filter(v=>typeof v=="string").forEach(v=>re.error(v))},onSuccess:()=>{_(null)},onFinish:()=>{b(!1)},preserveState:!0,preserveScroll:!0})};function de(r){var i;const o={};for(let d=1;d<=7;d++)o[d]=((i=r[d])==null?void 0:i.map(l=>({id:l.id,subject_id:l.subject_id,teacher_id:l.teacher_id,start_hour:l.start_hour,end_hour:l.end_hour})))||[];return o}function ce(r){return r.map(o=>({id:o.id,name:o.full_name}))}function me(r){return Object.entries(r).flatMap(([o,i])=>i.map(d=>({id:d.id||void 0,day:parseInt(o),subject_id:d.subject_id??null,teacher_id:d.teacher_id??null,start_hour:d.start_hour??"",end_hour:d.end_hour??""}))).sort((o,i)=>o.day-i.day||o.start_hour.localeCompare(i.start_hour))}function j(r){const o=[],i={},d=/^([0-1][0-9]|2[0-3]):[0-5][0-9]$/;return r.forEach((l,v)=>{!l.day&&l.day!==0&&o.push(`Schedule at index ${v+1} is missing day`),l.subject_id||o.push(`Schedule on day ${l.day} is missing subject`),l.teacher_id||o.push(`Schedule on day ${l.day} is missing teacher`),(!l.start_hour||!l.end_hour)&&o.push(`Schedule on day ${l.day} is missing start or end time`),l.start_hour&&!d.test(l.start_hour)&&o.push(`Schedule on day ${l.day} has invalid start time format (HH:MM)`),l.end_hour&&!d.test(l.end_hour)&&o.push(`Schedule on day ${l.day} has invalid end time format (HH:MM)`),l.start_hour&&l.end_hour&&d.test(l.start_hour)&&d.test(l.end_hour)&&l.end_hour<=l.start_hour&&o.push(`Day ${l.day}: End time must be after start time`),i[l.day]||(i[l.day]=[]),i[l.day].push(l)}),Object.entries(i).forEach(([l,v])=>{const w=v;w.sort(($,y)=>$.start_hour.localeCompare(y.start_hour));for(let $=1;$<w.length;$++){const y=w[$-1],A=w[$];A.start_hour<y.end_hour&&o.push(`Day ${l}: Schedule overlaps between ${y.start_hour}-${y.end_hour} and ${A.start_hour}-${A.end_hour}`)}const F={};for(const $ of w)$.teacher_id&&(F[$.teacher_id]||(F[$.teacher_id]=[]),F[$.teacher_id].push($));Object.entries(F).forEach(([$,y])=>{y.sort((A,B)=>A.start_hour.localeCompare(B.start_hour));for(let A=1;A<y.length;A++){const B=y[A-1],he=y[A];he.start_hour<B.end_hour&&o.push(`Day ${l}: Teacher ${$} has overlapping assignments ${B.start_hour}-${B.end_hour} & ${he.start_hour}-${he.end_hour}`)}})}),o}return n.jsxs(Pe,{breadcrumbs:vt(),children:[n.jsx($e,{title:`Jadwal - ${e.name}`}),n.jsx(Ie,{position:"top-right",richColors:!0}),n.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[n.jsxs("div",{className:"mb-8 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[n.jsxs("h1",{className:"text-2xl font-bold",children:["Jadwal: ",e.name]}),n.jsx("button",{type:"submit",form:L===0?"shift-form":"subject-form",disabled:L===0?x:u,className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:cursor-pointer hover:bg-blue-700 disabled:opacity-50",children:x||u?"Menyimpan...":"Simpan Jadwal"})]}),n.jsxs(q.Group,{selectedIndex:L,onChange:G,children:[n.jsx(q.List,{className:"mb-6 flex rounded-lg bg-blue-100 p-1",children:["By Shifting","By Subject"].map(r=>n.jsx(q,{disabled:r==="By Shifting"&&!k||r==="By Subject"&&!M,className:({selected:o})=>`flex-1 rounded-lg py-3 text-center text-sm font-medium transition-all hover:cursor-pointer ${o?"bg-white text-blue-700 shadow":"text-gray-600 hover:bg-blue-200"} ${r==="By Shifting"&&!k||r==="By Subject"&&!M?"cursor-not-allowed opacity-50":""}`,children:r},r))}),n.jsxs(q.Panels,{children:[n.jsx(q.Panel,{children:n.jsx("form",{id:"shift-form",onSubmit:ue,className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:p.days.map((r,o)=>n.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[n.jsx("h3",{className:"mb-3 text-lg font-semibold text-gray-800",children:r.day_name}),n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Shifting:"}),n.jsxs("select",{value:r.shifting_id||"",onChange:i=>ee(o,i.target.value?parseInt(i.target.value):null),className:"w-full rounded-md border border-gray-300 bg-gray-50 p-2 text-sm focus:border-blue-500 focus:ring-blue-500",children:[n.jsx("option",{value:"",children:"-- No Schedule --"}),a.map(i=>n.jsxs("option",{value:i.id,children:[i.name," (",i.start_hour," - ",i.end_hour,")"]},i.id))]})]}),r.shifting_id&&n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Teacher responsible:"}),n.jsx(De,{value:r.teachers,onChange:i=>K(o,i),placeholder:"Search teachers...",options:C})]})]},r.day))})}),n.jsx(q.Panel,{children:M?n.jsx("form",{id:"subject-form",onSubmit:oe,className:"space-y-6",children:[1,2,3,4,5,6,7].map(r=>{var o,i;return n.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:[n.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:["Senin","Selasa","Rabu","Kamis","Jum'at","Sabtu","Minggu"][r-1]}),n.jsx("button",{type:"button",onClick:()=>H(r),className:"inline-flex items-center rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:cursor-pointer hover:bg-green-700",children:"+ Tambah"})]}),n.jsx("div",{className:"grid gap-4 md:grid-cols-1",children:(o=g[r])==null?void 0:o.map((d,l)=>{var F,$;const v=(P==null?void 0:P.day)===r&&(P==null?void 0:P.index)===l,w=!d.id;return n.jsx("div",{className:"relative rounded-md border border-gray-300 bg-gray-50 p-4",children:n.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Jam Mulai"}),n.jsx("input",{type:"time",value:d.start_hour,onChange:y=>W(r,l,"start_hour",y.target.value),className:`mt-1 w-full rounded-md border border-gray-300 p-2 text-sm shadow-sm ${!v&&!w?"bg-gray-100":"bg-white"}`,disabled:!v&&!w})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Jam Selesai"}),n.jsx("input",{type:"time",value:d.end_hour,onChange:y=>W(r,l,"end_hour",y.target.value),className:`mt-1 w-full rounded-md border border-gray-300 p-2 text-sm shadow-sm ${!v&&!w?"bg-gray-100":"bg-white"}`,disabled:!v&&!w})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Mata Pelajaran"}),n.jsx(xe,{value:d.subject_id,onChange:y=>W(r,l,"subject_id",y),placeholder:"Pilih mata pelajaran...",endpoint:route("subjects.search"),initialOption:d.subject_id?{id:d.subject_id,full_name:((F=c.find(y=>y.id===d.subject_id))==null?void 0:F.name)||""}:void 0,showInitialOptions:!0,disabled:!v&&!w})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Pengajar"}),n.jsx(xe,{value:d.teacher_id,onChange:y=>W(r,l,"teacher_id",y),placeholder:"Select teacher...",endpoint:route("teachers.search"),initialOption:d.teacher_id?{id:d.teacher_id,full_name:(($=s.find(y=>y.id===d.teacher_id))==null?void 0:$.full_name)||""}:void 0,showInitialOptions:!0,disabled:!v&&!w})]}),n.jsx("div",{className:"mt-1 flex h-full items-center justify-start space-x-2 pt-6 md:pt-0",children:w?n.jsx(n.Fragment,{children:n.jsx("button",{type:"button",onClick:()=>te(r,l),className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:cursor-pointer hover:bg-gray-50",children:"Cancel"})}):v?n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>D(r,l),className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:cursor-pointer hover:bg-gray-50",children:"Cancel"}),n.jsx("button",{type:"button",onClick:()=>_(null),className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:cursor-pointer",children:"Done"})]}):n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>E(r,l),className:"rounded-md bg-yellow-400 px-4 py-2 text-sm font-medium text-white hover:cursor-pointer hover:bg-yellow-600",children:"Edit"}),n.jsx("button",{type:"button",onClick:()=>te(r,l),className:"rounded-md bg-red-500 px-4 py-2 text-sm font-medium text-white hover:cursor-pointer hover:bg-red-700",children:"Remove"})]})})]})},l)})}),((i=g[r])==null?void 0:i.length)===0&&n.jsx("div",{className:"py-4 text-center text-gray-500",children:"No subjects scheduled for this day"})]},r)})}):n.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-8 text-center",children:n.jsxs("div",{className:"mx-auto max-w-md",children:[n.jsx("div",{className:"mb-4 text-5xl",children:"⚠️"}),n.jsx("h3",{className:"mb-2 text-xl font-semibold",children:"Attendance Mode Mismatch"}),n.jsx("p",{className:"text-gray-600",children:'Currently active attendance mode is "Per Shift". Switch to "Per Subject" mode in Academic Year settings to use this feature.'})]})})})]})]})]})]})}export{Ft as default};
>>>>>>>> 29ae11e9c19a2dcef45cfaec61ce114727ce3ea1:public/build/assets/schedule-B6P5Er3O.js
