import{j as e,u as O,r as p,H as A,a as j}from"./app-CMV-yYZ_.js";import{m as S}from"./proxy-Bg4PB9rr.js";import{A as B}from"./app-layout-DNRiKue-.js";import{t as y,T as E}from"./index-CfTTW-PA.js";/* empty css            */import"./button-CC3FwLZQ.js";import"./index-Bha_FR3o.js";import"./index-DSk08Zci.js";import"./index-DSfEvC60.js";import"./createLucideIcon-BVVfRUjU.js";import"./app-logo-icon-CRXqWH6Q.js";function k({isOpen:d,title:s,message:n,onConfirm:c,onCancel:x}){return d?e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm",children:e.jsxs(S.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.1},className:"w-full max-w-xl rounded-lg bg-white p-6 shadow-xl",children:[e.jsx("h2",{className:"mb-4 text-lg font-bold",children:s}),e.jsx("p",{className:"mb-4",children:n}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:x,className:"rounded bg-gray-300 px-4 py-2 hover:cursor-pointer",children:"Cancel"}),e.jsx("button",{onClick:c,className:"rounded bg-blue-600 px-4 py-2 text-white hover:cursor-pointer",children:"Confirm"})]})]})}):null}const K=d=>[{title:"Tagihan",href:"/payments"},{title:d}];function G({transaction:d,payment:s}){const{flash:n}=O().props,[c,x]=p.useState({}),[w,h]=p.useState(!1),[C,g]=p.useState(!1);n!=null&&n.success&&y.success(n.success),n!=null&&n.error&&y.error(n.error);const T=d.filter(t=>t.student!==null),N=s.assignments.map(t=>{const a=t.student,i=T.find(r=>r.student&&r.student.id===a.id);return{student:a,transaction:i||{id:0,student:a,payment:s,payment_date:null}}}),[b,f]=p.useState(!1),L=()=>{var a;h(!1),f(!0);const t=Object.entries(c).map(([i,r])=>({id:Number(i),status:r}));j.patch(route("payments.updateTransactions",s.id),{transaction_ids:t.map(i=>i.id),status:(a=t[0])==null?void 0:a.status},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{x({}),y.success("Perubahan berhasil disimpan")},onError:()=>f(!1),onFinish:()=>f(!1)})},_=()=>{g(!1),j.visit(route("payments.index"))},D=()=>{const t=["Nama","NIS","Kelas","Tanggal Pembayaran","Status"],a=N.map(({student:o,transaction:u})=>{var v;const P=u.payment_date?"Lunas":"Belum Lunas";return[o.full_name,o.nis||"-",((v=o.classroom)==null?void 0:v.name)||"-",u.payment_date||"-",P]}),i=[t,...a].map(o=>o.map(u=>`"${u}"`).join(",")).join(`
`),r=new Blob([i],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(r),l=document.createElement("a");l.href=m,l.setAttribute("download",`payment_${s.id}.csv`),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(m)};return e.jsxs(B,{breadcrumbs:K(s.title),children:[e.jsx(A,{title:`Detail Tagihan - ${s.title}`}),e.jsx(E,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h1",{className:"mb-4 text-2xl font-bold",children:s.title}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Tenggat Pembayaran"}),e.jsx("p",{className:"mt-1",children:new Date(s.due_date).toLocaleDateString("id-ID")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Nominal"}),e.jsxs("p",{className:"mt-1",children:["Rp ",s.nominal.toLocaleString("id-ID")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Deskripsi"}),e.jsx("p",{className:"mt-1",children:s.description||"-"})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Daftar Pembayaran"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",s.assignments.length," peserta"]}),e.jsx("button",{onClick:D,className:"rounded bg-green-500 px-3 py-1 text-sm font-medium text-white hover:bg-green-600",children:"Ekspor CSV"})]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tanggal Pembayaran"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:N.map(({student:t,transaction:a})=>{var l;const i=a.payment_date?"lunas":"belum",r=c[a.id],m=r??i;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.full_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:((l=t.classroom)==null?void 0:l.name)||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:a.payment_date||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("select",{value:m,onChange:o=>x({...c,[a.id]:o.target.value}),className:`rounded border px-2 py-1 text-sm ${m==="lunas"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("option",{value:"belum",children:"Belum Lunas"}),e.jsx("option",{value:"lunas",children:"Lunas"})]}),r&&r!==i&&e.jsx("span",{className:"mt-1 text-xs text-orange-600",children:"Perubahan belum disimpan"})]})})]},t.id)})})]}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[Object.keys(c).length>0&&e.jsx("button",{disabled:b,onClick:()=>h(!0),className:`rounded px-4 py-2 text-white ${b?"bg-gray-400":"bg-blue-500 hover:bg-blue-600"}`,children:b?"Menyimpan...":"Simpan Perubahan"}),e.jsx("button",{onClick:()=>{Object.keys(c).length>0?g(!0):j.visit(route("payments.index"))},className:"rounded bg-gray-200 px-4 py-2 text-sm font-medium text-gray-800 hover:bg-gray-300",children:"Kembali ke Daftar"})]})]})]})]}),e.jsx(k,{isOpen:w,title:"Konfirmasi Simpan",message:"Apakah Anda yakin ingin menyimpan perubahan ini?",onConfirm:L,onCancel:()=>h(!1)}),e.jsx(k,{isOpen:C,title:"Konfirmasi Kembali",message:"Ada perubahan yang belum disimpan. Yakin mau kembali ke daftar?",onConfirm:_,onCancel:()=>g(!1)})]})}export{G as default};
