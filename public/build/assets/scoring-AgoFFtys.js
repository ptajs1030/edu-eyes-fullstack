import{r as o,u as F,j as e,H as D,a as j}from"./app-BzKYgBxa.js";import{A as B}from"./app-layout-DX89PgYj.js";import{g as k,i as K}from"./academic-year-utils-Dz9eUY6J.js";import{t as n,T as I}from"./index-CnCne7kX.js";/* empty css            */import"./button-Q9f5iEUD.js";import"./index-DlZYCNEA.js";import"./index-Sdn9Utbz.js";import"./index-Bw8fiE-Z.js";import"./createLucideIcon-JlmXJkrd.js";import"./app-logo-icon-D3j9zkke.js";function Q({exam:i,academicYears:h}){const[p,g]=o.useState({}),[c,x]=o.useState({}),[b,f]=o.useState({}),{flash:l}=F().props,S=(t,s)=>{const r=k(s);return!K(t,r)},m=h.find(t=>t.id===i.academic_year_id),u=S(m,h),y=k(h),w=[{title:"Ujian",href:"/exams"},{title:"Penilaian",href:""}];o.useEffect(()=>{l!=null&&l.success&&n.success(l.success),l!=null&&l.error&&n.error(l.error)},[l]),o.useEffect(()=>{const t={};i.student_assignments.forEach(s=>{var r;t[s.id]=((r=s.score)==null?void 0:r.toString())||""}),g(t)},[i.student_assignments]);const E=(t,s)=>{(s===""||/^\d*\.?\d*$/.test(s))&&g(r=>({...r,[t]:s}))},_=t=>{x(s=>({...s,[t]:!0}))},N=t=>{var r;const s=(r=i.student_assignments.find(a=>a.id===t))==null?void 0:r.score;g(a=>({...a,[t]:(s==null?void 0:s.toString())||""})),x(a=>({...a,[t]:!1}))},C=async t=>{const s=p[t];if(s===""){n.error("Nilai tidak boleh kosong");return}const r=parseFloat(s);if(isNaN(r)||r<0||r>100){n.error("Nilai harus antara 0-100");return}f(a=>({...a,[t]:!0})),j.put(`/exams/${i.id}/assignments/${t}/score`,{score:r},{onSuccess:()=>{x(d=>({...d,[t]:!1}));const a=i.student_assignments.findIndex(d=>d.id===t);a!==-1&&(i.student_assignments[a].score=r)},onError:a=>{console.error("Error saving score:",a),n.error("Gagal menyimpan nilai"),N(t)},onFinish:()=>{f(a=>({...a,[t]:!1}))}})},A=async()=>{const t=Object.entries(p).filter(([r,a])=>{const d=parseFloat(a);return!isNaN(d)&&d>=0&&d<=100}).map(([r,a])=>({assignment_id:parseInt(r),score:parseFloat(a)}));if(t.length===0){n.error("Tidak ada nilai valid untuk disimpan");return}const s=n.loading("Menyimpan semua nilai...");j.put(`/exams/${i.id}/scores/bulk`,{scores:t},{onSuccess:r=>{n.dismiss(s),x({}),t.forEach(({assignment_id:a,score:d})=>{const v=i.student_assignments.findIndex(L=>L.id===a);v!==-1&&(i.student_assignments[v].score=d)})},onError:r=>{n.dismiss(s),console.error("Error saving bulk scores:",r),n.error("Gagal menyimpan nilai")},onFinish:()=>{n.dismiss(s)}})},T=t=>t===null?"text-gray-400":t>=80?"text-green-600":t>=60?"text-yellow-600":"text-red-600",P=t=>t===null?"Belum dinilai":"Sudah Dinilai",$=Object.keys(c).some(t=>c[parseInt(t)]);return e.jsxs(B,{breadcrumbs:w,children:[e.jsx(D,{title:`Penilaian - ${i.name}`}),e.jsx(I,{position:"top-right",richColors:!0}),!u&&e.jsx("div",{className:"m-6 mb-4 rounded-lg border border-yellow-200 bg-yellow-50 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"mr-2 h-5 w-5 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.99-.833-2.46 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium text-yellow-800",children:["Tahun ajaran ",m==null?void 0:m.title," sudah lewat dari tahun ajaran aktif (",y==null?void 0:y.title,")."]}),e.jsx("p",{className:"mt-1 text-sm text-yellow-700",children:"Penilaian hanya dapat dilihat dan tidak dapat diperbarui."})]})]})}),e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-6 border-b pb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:i.name}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tahun Ajaran"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:i.academic_year.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Mata Pelajaran"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:i.subject.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tipe"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:i.type||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tanggal Pelaksanaan"}),e.jsx("div",{className:"mt-1 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-sm text-gray-600",children:new Date(i.date).toLocaleDateString("id-ID")})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Student Assignments"}),u&&$&&e.jsx("button",{onClick:A,className:"rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:"Simpan Semua Nilai"})]}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-200",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Nama"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"NIS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900",children:"Kelas"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"NILAI"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900",children:"Action"})]})}),e.jsx("tbody",{children:i.student_assignments.map(t=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.student_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.nis||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.class_name}),e.jsx("td",{className:"px-4 py-3 text-center",children:c[t.id]?e.jsx("input",{type:"text",value:p[t.id]||"",onChange:s=>E(t.id,s.target.value),className:"w-16 rounded border border-gray-300 px-2 py-1 text-center text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none",placeholder:"0-100",autoFocus:!0}):e.jsx("span",{className:`text-sm font-medium ${T(t.score)}`,children:t.score!==null?t.score:"-"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${t.score===null?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800"}`,children:P(t.score)})}),e.jsx("td",{className:"px-4 py-3 text-center",children:c[t.id]?e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsx("button",{onClick:()=>C(t.id),disabled:b[t.id],className:"rounded bg-blue-500 px-2 py-1 text-xs text-white hover:bg-blue-600 disabled:opacity-50",children:b[t.id]?"...":"Simpan"}),e.jsx("button",{onClick:()=>N(t.id),disabled:b[t.id],className:"rounded bg-gray-500 px-2 py-1 text-xs text-white hover:bg-gray-600 disabled:opacity-50",children:"Batal"})]}):e.jsx("button",{onClick:()=>_(t.id),className:`rounded px-3 py-1 text-xs text-white ${u?"bg-yellow-500 hover:bg-yellow-600":"bg-yellow-500 disabled:opacity-50 cursor-not-allowed"}`,disabled:!u,children:"Edit"})})]},t.id))})]})})]}),e.jsxs("div",{className:"rounded-lg bg-blue-50 p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900",children:"Petunjuk:"}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-800",children:[e.jsx("li",{children:'• Klik tombol "Edit" untuk memperbarui nilai siswa'}),e.jsx("li",{children:"• Nilai harus antara 0-100"}),e.jsx("li",{children:'• Klik "Simpan" untuk menyimpan nilai atau "Batal" untuk membatalkan'}),e.jsx("li",{children:'• Jika ada beberapa perubahan, gunakan tombol "Simpan Semua Nilai" untuk menyimpan sekaligus'})]})]}),e.jsx("div",{className:"mt-6 flex justify-end border-t pt-6",children:e.jsx("button",{onClick:()=>j.get("/exams"),className:"rounded-lg border border-gray-300 bg-white px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Kembali ke Daftar Exam"})})]})]})}export{Q as default};
