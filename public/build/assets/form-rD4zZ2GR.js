import{r as l,u as G,j as e,H,L as R,a as K}from"./app-CMV-yYZ_.js";import{A as M}from"./app-layout-DNRiKue-.js";import{t as c,T as W}from"./index-CfTTW-PA.js";/* empty css            */import"./button-CC3FwLZQ.js";import"./index-Bha_FR3o.js";import"./index-DSk08Zci.js";import"./index-DSfEvC60.js";import"./createLucideIcon-BVVfRUjU.js";import"./app-logo-icon-CRXqWH6Q.js";const J=[{title:"Tugas",href:"/tasks"},{title:"Buat Tugas Baru"}];function te({academicYears:j,selectedStudents:S,classrooms:y,subjects:_}){var k;const h=j.find(t=>t.status==="active"),[r,o]=l.useState({title:"",academic_year_id:(h==null?void 0:h.id)||0,description:"",due_date:"",due_time:"",attachments:[],subject_id:""}),[m,C]=l.useState(null),[n,x]=l.useState([]),[i,g]=l.useState(S||[]),[v,p]=l.useState([]),[T,N]=l.useState(!1),{flash:d}=G().props,[u,b]=l.useState([]);l.useEffect(()=>{d!=null&&d.success&&c.success(d.success),d!=null&&d.error&&c.error(d.error)},[d]),l.useEffect(()=>{m&&A(m)},[m]),l.useEffect(()=>{i.length>0?B(i):p([])},[i]);const A=async t=>{N(!0);try{const s=await fetch(route("students.by-class",t));if(!s.ok)throw new Error("Failed to fetch students");const a=await s.json();x(a)}catch{c.error("Gagal memuat data siswa"),x([])}finally{N(!1)}},B=async t=>{try{const s=await fetch(route("students.get-by-ids",{ids:t.join(",")}));if(!s.ok)throw new Error("Failed to fetch student info");const a=await s.json();p(a)}catch{c.error("Gagal memuat data siswa terpilih"),p([])}},P=t=>{C(t),x([])},w=t=>{g(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},E=t=>{if(t)g(n.map(s=>s.id));else{const s=n.map(a=>a.id);g(a=>a.filter(f=>!s.includes(f)))}},F=()=>{b([...u,{url:""}])},L=t=>{const s=[...u];s.splice(t,1),b(s)},I=(t,s)=>{const a=[...u];a[t].url=s,b(a)},q=t=>{if(t.preventDefault(),i.length===0){c.error("Pilih minimal 1 peserta");return}K.post("/tasks",{...r,student_ids:i,attachments:u.map(s=>({url:s.url}))},{onSuccess:()=>c.success("Tugas berhasil dibuat"),onError:()=>c.error("Gagal membuat tugas")})},D=n.length>0&&n.every(t=>i.includes(t.id));return e.jsxs(M,{breadcrumbs:J,children:[e.jsx(H,{title:"Buat Tugas Baru"}),e.jsx(W,{position:"top-right",richColors:!0}),e.jsxs("div",{className:"flex flex-col gap-6 rounded-xl bg-white p-6 text-black shadow-lg",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Buat Tugas Baru"}),e.jsxs("form",{onSubmit:q,className:"flex flex-col gap-6",children:[e.jsx("div",{className:"rounded-lg border p-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Nama Tugas*"}),e.jsx("input",{id:"title",type:"text",maxLength:70,value:r.title,onChange:t=>o({...r,title:t.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Tahun Ajaran*"}),e.jsx("input",{type:"text",value:((k=j.find(t=>t.id===r.academic_year_id))==null?void 0:k.title)||"",disabled:!0,className:"w-full rounded-lg border border-gray-300 bg-gray-100 px-4 py-2 text-gray-600"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"due_date",className:"block text-sm font-medium text-gray-700",children:"Batas Waktu*"}),e.jsx("input",{id:"due_date",type:"date",value:r.due_date,onChange:t=>o({...r,due_date:t.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"due_time",className:"block text-sm font-medium text-gray-700",children:"Batas Waktu (Jam)*"}),e.jsx("input",{id:"due_time",type:"time",value:r.due_time,onChange:t=>o({...r,due_time:t.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"subject",className:"block text-sm font-medium text-gray-700",children:"Mata Pelajaran*"}),e.jsxs("select",{id:"subject",value:r.subject_id,onChange:t=>o({...r,subject_id:t.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",required:!0,children:[e.jsx("option",{value:"",children:"Pilih Mata Pelajaran"}),_.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Deskripsi"}),e.jsx("textarea",{id:"description",value:r.description,onChange:t=>o({...r,description:t.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm",rows:4})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Lampiran"}),u.map((t,s)=>e.jsxs("div",{className:"mb-2 flex items-center",children:[e.jsx("input",{type:"url",value:t.url,onChange:a=>I(s,a.target.value),placeholder:"https://example.com/file.pdf",className:"block w-full flex-1 rounded-md border border-gray-300 p-2 shadow-sm"}),e.jsx("button",{type:"button",onClick:()=>L(s),className:"ml-2 rounded-md bg-red-100 px-3 py-2 text-sm font-medium text-red-700 hover:bg-red-200",children:"Hapus"})]},s)),e.jsx("button",{type:"button",onClick:F,className:"rounded-md bg-sky-500 px-3 py-2 text-sm font-medium text-white hover:bg-sky-600",children:"Tambah Lampiran"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Pilih Peserta"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Kelas"}),e.jsxs("select",{value:m||"",onChange:t=>P(Number(t.target.value)),className:"w-full rounded border p-2",children:[e.jsx("option",{value:"",children:"Pilih Kelas"}),y.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),T?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-blue-500 border-t-transparent"})}):n.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[n.length," siswa ditemukan"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:t=>E(t.target.checked),className:"rounded border-gray-300 text-indigo-600"}),"Pilih Semua"]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto rounded-lg border",children:e.jsx("div",{className:"divide-y divide-gray-200",children:n.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.full_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["NIS: ",t.nis||"-"]})]}),e.jsx("input",{type:"checkbox",checked:i.includes(t.id),onChange:()=>w(t.id),className:"h-4 w-4 rounded border-gray-300 text-indigo-600"})]},t.id))})})]}):e.jsx("div",{className:"rounded-lg border bg-gray-50 p-6 text-center text-gray-400",children:m?"Tidak ada siswa di kelas ini":"Pilih kelas untuk melihat siswa"})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("h2",{className:"mb-4 text-lg font-semibold",children:["Peserta Terpilih (",i.length,")"]}),v.length>0?e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"max-h-96 divide-y divide-gray-200 overflow-y-auto rounded-lg border",children:v.map(t=>{var s,a;return e.jsxs("div",{className:"flex items-center justify-between bg-white p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.full_name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsx("span",{children:((s=y.find(f=>f.id===t.class_id))==null?void 0:s.name)||((a=t.classroom)==null?void 0:a.name)||"-"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["NIS: ",t.nis||"-"]})]})]}),e.jsx("button",{type:"button",onClick:()=>w(t.id),className:"text-red-500 hover:text-red-700",children:"✕"})]},t.id)})})}):e.jsx("div",{className:"rounded-lg border bg-gray-50 p-6 text-center text-gray-400",children:"Belum ada peserta terpilih"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(R,{href:route("tasks.index"),className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"submit",className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700",children:"Simpan"})]})]})]})]})}export{te as default};
